<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Da Vinci Firmware: Davinci_2/Core/Inc/optimalAngle.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="PRT-logo-horizontal-dark-resized.png"/></td>
  <td id="projectalign">
   <div id="projectname">Da Vinci Firmware<span id="projectnumber">&#160;1</span>
   </div>
   <div id="projectbrief">Firmware for the DaVinci-M rocket avionics board.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('optimal_angle_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">optimalAngle.h File Reference<div class="ingroups"><a class="el" href="group___flight_logic.html">Core Flight Logic</a> &raquo; <a class="el" href="group___control_algorithms.html">Control Algorithms</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>Model Predictive Controller (MPC) to determine the optimal airbrake angle.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="rtwtypes_8h_source.html">rtwtypes.h</a>&quot;</code><br />
<code>#include &lt;stddef.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for optimalAngle.h:</div>
<div class="dyncontent">
<div class="center"><img src="optimal_angle_8h__incl.png" border="0" usemap="#a_davinci__2_2_core_2_inc_2optimal_angle_8h" alt=""/></div>
<map name="a_davinci__2_2_core_2_inc_2optimal_angle_8h" id="a_davinci__2_2_core_2_inc_2optimal_angle_8h">
<area shape="rect" title="Model Predictive Controller (MPC) to determine the optimal airbrake angle." alt="" coords="80,5,213,48"/>
<area shape="rect" href="rtwtypes_8h.html" title="Defines standard data types for code generated by MATLAB Coder." alt="" coords="5,96,88,123"/>
<area shape="poly" title=" " alt="" coords="122,51,76,88,72,84,119,47"/>
<area shape="rect" title=" " alt="" coords="112,96,181,123"/>
<area shape="poly" title=" " alt="" coords="149,49,149,80,144,80,144,49"/>
<area shape="rect" title=" " alt="" coords="204,96,268,123"/>
<area shape="poly" title=" " alt="" coords="171,47,212,83,209,87,168,51"/>
<area shape="rect" title=" " alt="" coords="9,171,84,197"/>
<area shape="poly" title=" " alt="" coords="49,123,49,155,44,155,44,123"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="optimal_angle_8h__dep__incl.png" border="0" usemap="#a_davinci__2_2_core_2_inc_2optimal_angle_8hdep" alt=""/></div>
<map name="a_davinci__2_2_core_2_inc_2optimal_angle_8hdep" id="a_davinci__2_2_core_2_inc_2optimal_angle_8hdep">
<area shape="rect" title="Model Predictive Controller (MPC) to determine the optimal airbrake angle." alt="" coords="86,5,220,48"/>
<area shape="rect" href="main_8c.html" title=": Main program body for the flight computer. Initializes hardware, RTOS, and starts all application t..." alt="" coords="5,96,141,139"/>
<area shape="poly" title=" " alt="" coords="126,61,93,97,89,94,122,58"/>
<area shape="rect" href="optimal_angle_8c.html" title=" " alt="" coords="165,96,301,139"/>
<area shape="poly" title=" " alt="" coords="184,58,217,94,213,97,180,61"/>
</map>
</div>
</div>
<p><a href="optimal_angle_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aae2f8a89388a2bfd4292c2d78da13e3a"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="optimal_angle_8h.html#aae2f8a89388a2bfd4292c2d78da13e3a">optimalAngle</a> (double <a class="el" href="main_8c.html#a6d73041c24f65bba028a4bbb2ce8dc39">sim_time_step</a>, double <a class="el" href="main_8c.html#a3516728342a262892154a029df3625e2">altitude</a>, double temperature, double <a class="el" href="main_8c.html#ab0a3df7e43ce8ebff885530aaa663739">velocity</a>, double pressure, double <a class="el" href="main_8c.html#a1f815d1c603fe9a188095d878f47cc88">current_delta</a>, double <a class="el" href="main_8c.html#a5983427e638d6f161cacd74ad5ccd87e">tilt_angle</a>, double <a class="el" href="main_8c.html#abde1b7f8a53a48ccd030fb861ae3b7ea">target_apogee</a>, double <a class="el" href="main_8c.html#a97eab6d709b80585fe9e8a54b1e3da27">tolerance</a>, const double <a class="el" href="main_8c.html#a2af0b0f56789fc219dd24be2bea8bfc3">mach_states</a>[5], const double <a class="el" href="main_8c.html#ac829aead4de71eb8bc9300bb0bdee08d">deployment_states</a>[6], const double <a class="el" href="main_8c.html#af01cd17669a1da62f9632736af3e77f1">cd_table</a>[30])</td></tr>
<tr class="memdesc:aae2f8a89388a2bfd4292c2d78da13e3a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the optimal constant airbrake angle to reach a target apogee.  <br /></td></tr>
<tr class="separator:aae2f8a89388a2bfd4292c2d78da13e3a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Model Predictive Controller (MPC) to determine the optimal airbrake angle. </p>
<dl class="section author"><dt>Author</dt><dd>Francesco Abate, MSA (Originally generated by MATLAB Coder) </dd></dl>
<dl class="section version"><dt>Version</dt><dd>24.2 (MATLAB Coder version) </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2025-05-06</dd></dl>
<p>This header file declares the <code>optimalAngle</code> function, which is the core of the rocket's Model Predictive Control (MPC) system for apogee control. Its primary goal is to calculate the single, constant airbrake deployment angle that, if applied from the current moment, will result in the rocket reaching a specified target apogee.</p>
<p>The function uses a combination of two main algorithms:</p><ol type="1">
<li><b>Binary Search (Bisection Method):</b> An outer loop efficiently searches for the optimal angle within a defined range [0, 173 degrees].</li>
<li><b>Trajectory Simulation:</b> For each test angle from the binary search, an inner loop simulates the rocket's entire coasting phase using a physics model and numerical integration (Heun's method) to predict the resulting apogee.</li>
</ol>
<p>This function was generated from a MATLAB model provided by the MSA subteam. </p>

<p class="definition">Definition in file <a class="el" href="optimal_angle_8h_source.html">optimalAngle.h</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="aae2f8a89388a2bfd4292c2d78da13e3a" name="aae2f8a89388a2bfd4292c2d78da13e3a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aae2f8a89388a2bfd4292c2d78da13e3a">&#9670;&#160;</a></span>optimalAngle()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double optimalAngle </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>sim_time_step</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>altitude</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>temperature</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>velocity</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>pressure</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>current_delta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>tilt_angle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>target_apogee</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>tolerance</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>mach_states</em>[5], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>deployment_states</em>[6], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>cd_table</em>[30]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates the optimal constant airbrake angle to reach a target apogee. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">sim_time_step</td><td>The duration of a single time step used inside the internal trajectory simulation, in seconds (s). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">altitude</td><td>The rocket's current altitude above ground level in meters (m). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">temperature</td><td>Current ambient air temperature in Kelvin (K). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">velocity</td><td>The rocket's current total speed (magnitude of velocity vector) in m/s. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pressure</td><td>Current ambient air pressure in Pascals (Pa). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">current_delta</td><td>The current, real-world deployment angle of the airbrakes in degrees. (Note: May not be used in this version). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tilt_angle</td><td>The angle of the rocket's velocity vector with respect to the vertical axis in radians. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">target_apogee</td><td>The desired final apogee for the rocket in meters (m). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tolerance</td><td>The desired precision for the binary search, in degrees. The search stops when <code>dep_max - dep_min &lt;= tolerance</code>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mach_states</td><td>An array of 5 discrete Mach numbers that form the x-axis of the Cd lookup table. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">deployment_states</td><td>An array of 6 discrete airbrake deployment angles that form the y-axis of the Cd lookup table. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cd_table</td><td>A 1D array of 30 Coefficient of Drag (Cd) values, representing the 6x5 lookup grid (row-major).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The calculated optimal airbrake deployment angle in degrees. </dd></dl>

<p class="definition">Definition at line <a class="el" href="optimal_angle_8c_source.html#l00086">86</a> of file <a class="el" href="optimal_angle_8c_source.html">optimalAngle.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   92</span>{</div>
<div class="line"><span class="lineno">   93</span>  <span class="keywordtype">double</span> dep_max;</div>
<div class="line"><span class="lineno">   94</span>  <span class="keywordtype">double</span> dep_min;</div>
<div class="line"><span class="lineno">   95</span>  <span class="keywordtype">double</span> max_change;</div>
<div class="line"><span class="lineno">   96</span>  <span class="keywordtype">double</span> opt_dep;</div>
<div class="line"><span class="lineno">   97</span>  <span class="comment">/* placeholder */</span></div>
<div class="line"><span class="lineno">   98</span>  dep_min = 0.0;</div>
<div class="line"><span class="lineno">   99</span>  <span class="comment">/* deg */</span></div>
<div class="line"><span class="lineno">  100</span>  dep_max = 173.0;</div>
<div class="line"><span class="lineno">  101</span>  <span class="comment">/* deg */</span></div>
<div class="line"><span class="lineno">  102</span>  max_change = 182.6 * <a class="code hl_variable" href="main_8c.html#a6d73041c24f65bba028a4bbb2ce8dc39">sim_time_step</a>;</div>
<div class="line"><span class="lineno">  103</span>  <span class="keywordflow">while</span> (dep_max - dep_min &gt; <a class="code hl_variable" href="main_8c.html#a97eab6d709b80585fe9e8a54b1e3da27">tolerance</a>) {</div>
<div class="line"><span class="lineno">  104</span>    <span class="keywordtype">double</span> delta;</div>
<div class="line"><span class="lineno">  105</span>    <span class="keywordtype">double</span> elapsed_time;</div>
<div class="line"><span class="lineno">  106</span>    <span class="keywordtype">double</span> pressure_current;</div>
<div class="line"><span class="lineno">  107</span>    <span class="keywordtype">double</span> temperature_current;</div>
<div class="line"><span class="lineno">  108</span>    <span class="keywordtype">double</span> test_delta;</div>
<div class="line"><span class="lineno">  109</span>    <span class="keywordtype">double</span> v_current;</div>
<div class="line"><span class="lineno">  110</span>    <span class="keywordtype">double</span> x_dot_predicted;</div>
<div class="line"><span class="lineno">  111</span>    <span class="keywordtype">double</span> y_current;</div>
<div class="line"><span class="lineno">  112</span>    <span class="keywordtype">double</span> y_dot_current;</div>
<div class="line"><span class="lineno">  113</span>    test_delta = (dep_max + dep_min) / 2.0;</div>
<div class="line"><span class="lineno">  114</span>    delta = <a class="code hl_variable" href="main_8c.html#a1f815d1c603fe9a188095d878f47cc88">current_delta</a>;</div>
<div class="line"><span class="lineno">  115</span>    elapsed_time = 0.0;</div>
<div class="line"><span class="lineno">  116</span>    temperature_current = temperature;</div>
<div class="line"><span class="lineno">  117</span>    pressure_current = pressure;</div>
<div class="line"><span class="lineno">  118</span>    y_current = <a class="code hl_variable" href="main_8c.html#a3516728342a262892154a029df3625e2">altitude</a>;</div>
<div class="line"><span class="lineno">  119</span>    v_current = <a class="code hl_variable" href="main_8c.html#ab0a3df7e43ce8ebff885530aaa663739">velocity</a>;</div>
<div class="line"><span class="lineno">  120</span>    x_dot_predicted = <a class="code hl_variable" href="main_8c.html#ab0a3df7e43ce8ebff885530aaa663739">velocity</a> * sin(<a class="code hl_variable" href="main_8c.html#a5983427e638d6f161cacd74ad5ccd87e">tilt_angle</a>);</div>
<div class="line"><span class="lineno">  121</span>    y_dot_current = <a class="code hl_variable" href="main_8c.html#ab0a3df7e43ce8ebff885530aaa663739">velocity</a> * cos(<a class="code hl_variable" href="main_8c.html#a5983427e638d6f161cacd74ad5ccd87e">tilt_angle</a>);</div>
<div class="line"><span class="lineno">  122</span>    <span class="keywordflow">while</span> (y_dot_current &gt; 0.0) {</div>
<div class="line"><span class="lineno">  123</span>      <span class="keywordtype">double</span> speed_of_sound;</div>
<div class="line"><span class="lineno">  124</span>      <span class="keywordtype">double</span> x_dotdot;</div>
<div class="line"><span class="lineno">  125</span>      <span class="keywordtype">double</span> y_dotdot;</div>
<div class="line"><span class="lineno">  126</span>      <span class="keywordflow">if</span> (elapsed_time &gt; 0.1) {</div>
<div class="line"><span class="lineno">  127</span>        opt_dep = test_delta - delta;</div>
<div class="line"><span class="lineno">  128</span>        <span class="keywordflow">if</span> (fabs(opt_dep) &gt; max_change) {</div>
<div class="line"><span class="lineno">  129</span>          <span class="keywordflow">if</span> (<a class="code hl_function" href="group___non_finite___functions.html#ga77a37b8e06f4c4ce363a03fe4099aad8">rtIsNaN</a>(opt_dep)) {</div>
<div class="line"><span class="lineno">  130</span>            opt_dep = <a class="code hl_variable" href="group___non_finite___globals.html#ga3da5a3999caf769c738fda1934922ff8">rtNaN</a>;</div>
<div class="line"><span class="lineno">  131</span>          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (opt_dep &lt; 0.0) {</div>
<div class="line"><span class="lineno">  132</span>            opt_dep = -1.0;</div>
<div class="line"><span class="lineno">  133</span>          } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  134</span>            opt_dep = (opt_dep &gt; 0.0);</div>
<div class="line"><span class="lineno">  135</span>          }</div>
<div class="line"><span class="lineno">  136</span>          delta += opt_dep * max_change;</div>
<div class="line"><span class="lineno">  137</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  138</span>          delta = test_delta;</div>
<div class="line"><span class="lineno">  139</span>        }</div>
<div class="line"><span class="lineno">  140</span>      }</div>
<div class="line"><span class="lineno">  141</span>      speed_of_sound = sqrt(401.79999999999995 * temperature_current);</div>
<div class="line"><span class="lineno">  142</span>      pressure_current = 0.5 *</div>
<div class="line"><span class="lineno">  143</span>                         (pressure_current / (287.0 * temperature_current)) *</div>
<div class="line"><span class="lineno">  144</span>                         0.014102609421964583;</div>
<div class="line"><span class="lineno">  145</span>      opt_dep = pressure_current * <a class="code hl_function" href="cd_evaluation_8c.html#a69f7fd2df34d5dbea75a4f8e560dd51f">cdEvaluation</a>(<a class="code hl_variable" href="main_8c.html#ac829aead4de71eb8bc9300bb0bdee08d">deployment_states</a>, <a class="code hl_variable" href="main_8c.html#a2af0b0f56789fc219dd24be2bea8bfc3">mach_states</a>,</div>
<div class="line"><span class="lineno">  146</span>                                                <a class="code hl_variable" href="main_8c.html#af01cd17669a1da62f9632736af3e77f1">cd_table</a>, delta,</div>
<div class="line"><span class="lineno">  147</span>                                                v_current / speed_of_sound);</div>
<div class="line"><span class="lineno">  148</span>      x_dotdot = -opt_dep * x_dot_predicted * v_current / 23.458000008756152;</div>
<div class="line"><span class="lineno">  149</span>      y_dotdot =</div>
<div class="line"><span class="lineno">  150</span>          -opt_dep * y_dot_current * v_current / 23.458000008756152 - 9.81;</div>
<div class="line"><span class="lineno">  151</span>      opt_dep = x_dot_predicted + x_dotdot * <a class="code hl_variable" href="main_8c.html#a6d73041c24f65bba028a4bbb2ce8dc39">sim_time_step</a>;</div>
<div class="line"><span class="lineno">  152</span>      temperature_current = y_dot_current + y_dotdot * <a class="code hl_variable" href="main_8c.html#a6d73041c24f65bba028a4bbb2ce8dc39">sim_time_step</a>;</div>
<div class="line"><span class="lineno">  153</span>      v_current =</div>
<div class="line"><span class="lineno">  154</span>          sqrt(opt_dep * opt_dep + temperature_current * temperature_current);</div>
<div class="line"><span class="lineno">  155</span>      opt_dep = pressure_current * <a class="code hl_function" href="cd_evaluation_8c.html#a69f7fd2df34d5dbea75a4f8e560dd51f">cdEvaluation</a>(<a class="code hl_variable" href="main_8c.html#ac829aead4de71eb8bc9300bb0bdee08d">deployment_states</a>, <a class="code hl_variable" href="main_8c.html#a2af0b0f56789fc219dd24be2bea8bfc3">mach_states</a>,</div>
<div class="line"><span class="lineno">  156</span>                                                <a class="code hl_variable" href="main_8c.html#af01cd17669a1da62f9632736af3e77f1">cd_table</a>, delta,</div>
<div class="line"><span class="lineno">  157</span>                                                v_current / speed_of_sound);</div>
<div class="line"><span class="lineno">  158</span>      x_dot_predicted += 0.5 *</div>
<div class="line"><span class="lineno">  159</span>                         (x_dotdot + -opt_dep * x_dot_predicted * v_current /</div>
<div class="line"><span class="lineno">  160</span>                                         23.458000008756152) *</div>
<div class="line"><span class="lineno">  161</span>                         <a class="code hl_variable" href="main_8c.html#a6d73041c24f65bba028a4bbb2ce8dc39">sim_time_step</a>;</div>
<div class="line"><span class="lineno">  162</span>      opt_dep =</div>
<div class="line"><span class="lineno">  163</span>          y_dot_current + 0.5 *</div>
<div class="line"><span class="lineno">  164</span>                              (y_dotdot + (-opt_dep * y_dot_current *</div>
<div class="line"><span class="lineno">  165</span>                                               v_current / 23.458000008756152 -</div>
<div class="line"><span class="lineno">  166</span>                                           9.81)) *</div>
<div class="line"><span class="lineno">  167</span>                              <a class="code hl_variable" href="main_8c.html#a6d73041c24f65bba028a4bbb2ce8dc39">sim_time_step</a>;</div>
<div class="line"><span class="lineno">  168</span>      y_current += 0.5 * (y_dot_current + opt_dep) * <a class="code hl_variable" href="main_8c.html#a6d73041c24f65bba028a4bbb2ce8dc39">sim_time_step</a>;</div>
<div class="line"><span class="lineno">  169</span>      y_dot_current = opt_dep;</div>
<div class="line"><span class="lineno">  170</span>      v_current = sqrt(x_dot_predicted * x_dot_predicted + opt_dep * opt_dep);</div>
<div class="line"><span class="lineno">  171</span>      temperature_current = temperature - 0.00649 * (y_current - <a class="code hl_variable" href="main_8c.html#a3516728342a262892154a029df3625e2">altitude</a>);</div>
<div class="line"><span class="lineno">  172</span>      pressure_current =</div>
<div class="line"><span class="lineno">  173</span>          pressure * <a class="code hl_function" href="optimal_angle_8c.html#aec012aeba63ea4ffcdc8bcede27b6847">rt_powd_snf</a>(temperature_current / temperature, 5.2561);</div>
<div class="line"><span class="lineno">  174</span>      elapsed_time += <a class="code hl_variable" href="main_8c.html#a6d73041c24f65bba028a4bbb2ce8dc39">sim_time_step</a>;</div>
<div class="line"><span class="lineno">  175</span>    }</div>
<div class="line"><span class="lineno">  176</span>    <span class="keywordflow">if</span> (y_current &gt; <a class="code hl_variable" href="main_8c.html#abde1b7f8a53a48ccd030fb861ae3b7ea">target_apogee</a>) {</div>
<div class="line"><span class="lineno">  177</span>      dep_min = test_delta;</div>
<div class="line"><span class="lineno">  178</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  179</span>      dep_max = test_delta;</div>
<div class="line"><span class="lineno">  180</span>    }</div>
<div class="line"><span class="lineno">  181</span>  }</div>
<div class="line"><span class="lineno">  182</span>  <span class="keywordflow">return</span> 180 - ((dep_min + dep_max) / 2.0);</div>
<div class="line"><span class="lineno">  183</span>}</div>
<div class="ttc" id="acd_evaluation_8c_html_a69f7fd2df34d5dbea75a4f8e560dd51f"><div class="ttname"><a href="cd_evaluation_8c.html#a69f7fd2df34d5dbea75a4f8e560dd51f">cdEvaluation</a></div><div class="ttdeci">double cdEvaluation(const double dep_states[6], const double mach_states[5], const double cd_table[30], double dep, double mach)</div><div class="ttdoc">Estimates the coefficient of drag (Cd) via 2D bilinear interpolation.</div><div class="ttdef"><b>Definition</b> <a href="cd_evaluation_8c_source.html#l00030">cdEvaluation.c:30</a></div></div>
<div class="ttc" id="agroup___non_finite___functions_html_ga77a37b8e06f4c4ce363a03fe4099aad8"><div class="ttname"><a href="group___non_finite___functions.html#ga77a37b8e06f4c4ce363a03fe4099aad8">rtIsNaN</a></div><div class="ttdeci">boolean_T rtIsNaN(real_T value)</div><div class="ttdoc">Checks if a double-precision value is Not-a-Number (NaN).</div><div class="ttdef"><b>Definition</b> <a href="rt__nonfinite_8c_source.html#l00060">rt_nonfinite.c:60</a></div></div>
<div class="ttc" id="agroup___non_finite___globals_html_ga3da5a3999caf769c738fda1934922ff8"><div class="ttname"><a href="group___non_finite___globals.html#ga3da5a3999caf769c738fda1934922ff8">rtNaN</a></div><div class="ttdeci">real_T rtNaN</div><div class="ttdoc">Global constant for Not-a-Number (double precision).</div><div class="ttdef"><b>Definition</b> <a href="rt__nonfinite_8c_source.html#l00024">rt_nonfinite.c:24</a></div></div>
<div class="ttc" id="amain_8c_html_a1f815d1c603fe9a188095d878f47cc88"><div class="ttname"><a href="main_8c.html#a1f815d1c603fe9a188095d878f47cc88">current_delta</a></div><div class="ttdeci">double current_delta</div><div class="ttdef"><b>Definition</b> <a href="main_8c_source.html#l00257">main.c:257</a></div></div>
<div class="ttc" id="amain_8c_html_a2af0b0f56789fc219dd24be2bea8bfc3"><div class="ttname"><a href="main_8c.html#a2af0b0f56789fc219dd24be2bea8bfc3">mach_states</a></div><div class="ttdeci">const double mach_states[]</div><div class="ttdef"><b>Definition</b> <a href="main_8c_source.html#l00261">main.c:261</a></div></div>
<div class="ttc" id="amain_8c_html_a3516728342a262892154a029df3625e2"><div class="ttname"><a href="main_8c.html#a3516728342a262892154a029df3625e2">altitude</a></div><div class="ttdeci">float_t altitude</div><div class="ttdef"><b>Definition</b> <a href="main_8c_source.html#l00224">main.c:224</a></div></div>
<div class="ttc" id="amain_8c_html_a5983427e638d6f161cacd74ad5ccd87e"><div class="ttname"><a href="main_8c.html#a5983427e638d6f161cacd74ad5ccd87e">tilt_angle</a></div><div class="ttdeci">double tilt_angle</div><div class="ttdef"><b>Definition</b> <a href="main_8c_source.html#l00260">main.c:260</a></div></div>
<div class="ttc" id="amain_8c_html_a6d73041c24f65bba028a4bbb2ce8dc39"><div class="ttname"><a href="main_8c.html#a6d73041c24f65bba028a4bbb2ce8dc39">sim_time_step</a></div><div class="ttdeci">double sim_time_step</div><div class="ttdef"><b>Definition</b> <a href="main_8c_source.html#l00256">main.c:256</a></div></div>
<div class="ttc" id="amain_8c_html_a97eab6d709b80585fe9e8a54b1e3da27"><div class="ttname"><a href="main_8c.html#a97eab6d709b80585fe9e8a54b1e3da27">tolerance</a></div><div class="ttdeci">double tolerance</div><div class="ttdef"><b>Definition</b> <a href="main_8c_source.html#l00259">main.c:259</a></div></div>
<div class="ttc" id="amain_8c_html_ab0a3df7e43ce8ebff885530aaa663739"><div class="ttname"><a href="main_8c.html#ab0a3df7e43ce8ebff885530aaa663739">velocity</a></div><div class="ttdeci">float_t velocity</div><div class="ttdef"><b>Definition</b> <a href="main_8c_source.html#l00225">main.c:225</a></div></div>
<div class="ttc" id="amain_8c_html_abde1b7f8a53a48ccd030fb861ae3b7ea"><div class="ttname"><a href="main_8c.html#abde1b7f8a53a48ccd030fb861ae3b7ea">target_apogee</a></div><div class="ttdeci">double target_apogee</div><div class="ttdef"><b>Definition</b> <a href="main_8c_source.html#l00258">main.c:258</a></div></div>
<div class="ttc" id="amain_8c_html_ac829aead4de71eb8bc9300bb0bdee08d"><div class="ttname"><a href="main_8c.html#ac829aead4de71eb8bc9300bb0bdee08d">deployment_states</a></div><div class="ttdeci">const double deployment_states[]</div><div class="ttdef"><b>Definition</b> <a href="main_8c_source.html#l00262">main.c:262</a></div></div>
<div class="ttc" id="amain_8c_html_af01cd17669a1da62f9632736af3e77f1"><div class="ttname"><a href="main_8c.html#af01cd17669a1da62f9632736af3e77f1">cd_table</a></div><div class="ttdeci">static double cd_table[]</div><div class="ttdef"><b>Definition</b> <a href="main_8c_source.html#l00263">main.c:263</a></div></div>
<div class="ttc" id="aoptimal_angle_8c_html_aec012aeba63ea4ffcdc8bcede27b6847"><div class="ttname"><a href="optimal_angle_8c.html#aec012aeba63ea4ffcdc8bcede27b6847">rt_powd_snf</a></div><div class="ttdeci">static double rt_powd_snf(double u0, double u1)</div><div class="ttdef"><b>Definition</b> <a href="optimal_angle_8c_source.html#l00027">optimalAngle.c:27</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="main_8c_source.html#l00224">altitude</a>, <a class="el" href="main_8c_source.html#l00263">cd_table</a>, <a class="el" href="cd_evaluation_8c_source.html#l00030">cdEvaluation()</a>, <a class="el" href="main_8c_source.html#l00257">current_delta</a>, <a class="el" href="main_8c_source.html#l00262">deployment_states</a>, <a class="el" href="main_8c_source.html#l00261">mach_states</a>, <a class="el" href="optimal_angle_8c_source.html#l00027">rt_powd_snf()</a>, <a class="el" href="rt__nonfinite_8c_source.html#l00060">rtIsNaN()</a>, <a class="el" href="rt__nonfinite_8c_source.html#l00024">rtNaN</a>, <a class="el" href="main_8c_source.html#l00256">sim_time_step</a>, <a class="el" href="main_8c_source.html#l00258">target_apogee</a>, <a class="el" href="main_8c_source.html#l00260">tilt_angle</a>, <a class="el" href="main_8c_source.html#l00259">tolerance</a>, and <a class="el" href="main_8c_source.html#l00225">velocity</a>.</p>

<p class="reference">Referenced by <a class="el" href="main_8c_source.html#l01837">StartMPC_Task()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="optimal_angle_8h_aae2f8a89388a2bfd4292c2d78da13e3a_cgraph.png" border="0" usemap="#aoptimal_angle_8h_aae2f8a89388a2bfd4292c2d78da13e3a_cgraph" alt=""/></div>
<map name="aoptimal_angle_8h_aae2f8a89388a2bfd4292c2d78da13e3a_cgraph" id="aoptimal_angle_8h_aae2f8a89388a2bfd4292c2d78da13e3a_cgraph">
<area shape="rect" title="Calculates the optimal constant airbrake angle to reach a target apogee." alt="" coords="5,259,102,285"/>
<area shape="rect" href="cd_evaluation_8c.html#a69f7fd2df34d5dbea75a4f8e560dd51f" title="Estimates the coefficient of drag (Cd) via 2D bilinear interpolation." alt="" coords="150,132,246,159"/>
<area shape="poly" title=" " alt="" coords="68,256,168,167,172,171,72,260"/>
<area shape="rect" href="optimal_angle_8c.html#aec012aeba63ea4ffcdc8bcede27b6847" title=" " alt="" coords="152,259,244,285"/>
<area shape="poly" title=" " alt="" coords="102,269,136,269,136,275,102,275"/>
<area shape="rect" href="group___non_finite___functions.html#ga77a37b8e06f4c4ce363a03fe4099aad8" title="Checks if a double&#45;precision value is Not&#45;a&#45;Number (NaN)." alt="" coords="324,309,391,336"/>
<area shape="poly" title=" " alt="" coords="102,283,150,295,234,308,308,316,308,321,233,313,149,300,101,289"/>
<area shape="rect" href="find_8c.html#a7b5c2b3712db27eb37ff2480cb06e58e" title="Finds the index of the last true element in a 5&#45;element boolean array." alt="" coords="315,5,399,32"/>
<area shape="poly" title=" " alt="" coords="207,130,242,87,266,63,292,42,300,37,303,42,296,46,269,67,246,91,211,133"/>
<area shape="rect" href="eml__mtimes__helper_8c.html#a6dfa07980827284784a4e944d9f12a0b" title="Performs a fused set of element&#45;wise operations for 2D interpolation." alt="" coords="294,56,420,83"/>
<area shape="poly" title=" " alt="" coords="222,129,293,92,305,87,307,92,295,97,225,134"/>
<area shape="rect" href="find_8c.html#aa6e9d8d524731c81277ed384b0771f2c" title="Finds the index of the last true element in a 6&#45;element boolean array." alt="" coords="322,107,392,133"/>
<area shape="poly" title=" " alt="" coords="246,135,306,125,307,131,247,140"/>
<area shape="rect" href="mrdivide__helper_8c.html#aa64ae8bd98fefc483183622c330cc62c" title="Performs element&#45;wise division of a scalar by each element of a matrix." alt="" coords="324,157,391,184"/>
<area shape="poly" title=" " alt="" coords="247,150,309,160,308,166,246,156"/>
<area shape="rect" href="mtimes_8c.html#a23754b43ebfe5c68d2918ea22a418718" title="Performs matrix multiplication: C = A * B." alt="" coords="325,208,389,235"/>
<area shape="poly" title=" " alt="" coords="225,157,295,194,312,201,310,206,293,198,222,162"/>
<area shape="rect" href="group___non_finite___functions.html#ga5cb8bd309556e80b24b7e67a0718a0c5" title="Checks if a double&#45;precision value is positive or negative infinity." alt="" coords="330,259,385,285"/>
<area shape="poly" title=" " alt="" coords="244,269,314,269,314,275,244,275"/>
<area shape="poly" title=" " alt="" coords="243,283,309,305,308,310,242,289"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="optimal_angle_8h_aae2f8a89388a2bfd4292c2d78da13e3a_icgraph.png" border="0" usemap="#aoptimal_angle_8h_aae2f8a89388a2bfd4292c2d78da13e3a_icgraph" alt=""/></div>
<map name="aoptimal_angle_8h_aae2f8a89388a2bfd4292c2d78da13e3a_icgraph" id="aoptimal_angle_8h_aae2f8a89388a2bfd4292c2d78da13e3a_icgraph">
<area shape="rect" title="Calculates the optimal constant airbrake angle to reach a target apogee." alt="" coords="265,5,361,32"/>
<area shape="rect" href="group___r_t_o_s___tasks.html#ga66e1e49e54f627fbc12b6f818505c70c" title="Function implementing the MPC_Task thread." alt="" coords="103,5,217,32"/>
<area shape="poly" title=" " alt="" coords="249,21,217,21,217,16,249,16"/>
<area shape="rect" href="main_8c.html#a840291bc02cba5474a4cb46a9b9566fe" title="The application entry point." alt="" coords="5,5,55,32"/>
<area shape="poly" title=" " alt="" coords="87,21,55,21,55,16,87,16"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_74665e7a93125a1b96de8fab7d5a3847.html">Davinci_2</a></li><li class="navelem"><a class="el" href="dir_2270421e09f92bb67b3cc59e68204e53.html">Core</a></li><li class="navelem"><a class="el" href="dir_8953985c8f7f8178c476555601a95ec2.html">Inc</a></li><li class="navelem"><a class="el" href="optimal_angle_8h.html">optimalAngle.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
