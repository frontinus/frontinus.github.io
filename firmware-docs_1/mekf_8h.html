<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Da Vinci Firmware: Davinci_2/Core/Inc/mekf.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="PRT-logo-horizontal-dark-resized.png"/></td>
  <td id="projectalign">
   <div id="projectname">Da Vinci Firmware<span id="projectnumber">&#160;1</span>
   </div>
   <div id="projectbrief">Firmware for the DaVinci-M rocket avionics board.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('mekf_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">mekf.h File Reference<div class="ingroups"><a class="el" href="group___flight_logic.html">Core Flight Logic</a> &raquo; <a class="el" href="group___control_algorithms.html">Control Algorithms</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>Multiplicative Extended Kalman Filter (MEKF) for attitude and gyroscope bias estimation.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="rtwtypes_8h_source.html">rtwtypes.h</a>&quot;</code><br />
<code>#include &lt;stddef.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for mekf.h:</div>
<div class="dyncontent">
<div class="center"><img src="mekf_8h__incl.png" border="0" usemap="#a_davinci__2_2_core_2_inc_2mekf_8h" alt=""/></div>
<map name="a_davinci__2_2_core_2_inc_2mekf_8h" id="a_davinci__2_2_core_2_inc_2mekf_8h">
<area shape="rect" title="Multiplicative Extended Kalman Filter (MEKF) for attitude and gyroscope bias estimation." alt="" coords="80,5,213,48"/>
<area shape="rect" href="rtwtypes_8h.html" title="Defines standard data types for code generated by MATLAB Coder." alt="" coords="5,96,88,123"/>
<area shape="poly" title=" " alt="" coords="122,51,76,88,72,84,119,47"/>
<area shape="rect" title=" " alt="" coords="112,96,181,123"/>
<area shape="poly" title=" " alt="" coords="149,49,149,80,144,80,144,49"/>
<area shape="rect" title=" " alt="" coords="204,96,268,123"/>
<area shape="poly" title=" " alt="" coords="171,47,212,83,209,87,168,51"/>
<area shape="rect" title=" " alt="" coords="9,171,84,197"/>
<area shape="poly" title=" " alt="" coords="49,123,49,155,44,155,44,123"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="mekf_8h__dep__incl.png" border="0" usemap="#a_davinci__2_2_core_2_inc_2mekf_8hdep" alt=""/></div>
<map name="a_davinci__2_2_core_2_inc_2mekf_8hdep" id="a_davinci__2_2_core_2_inc_2mekf_8hdep">
<area shape="rect" title="Multiplicative Extended Kalman Filter (MEKF) for attitude and gyroscope bias estimation." alt="" coords="86,5,220,48"/>
<area shape="rect" href="main_8c.html" title=": Main program body for the flight computer. Initializes hardware, RTOS, and starts all application t..." alt="" coords="5,96,141,139"/>
<area shape="poly" title=" " alt="" coords="126,61,93,97,89,94,122,58"/>
<area shape="rect" href="mekf_8c.html" title=" " alt="" coords="165,96,301,139"/>
<area shape="poly" title=" " alt="" coords="184,58,217,94,213,97,180,61"/>
</map>
</div>
</div>
<p><a href="mekf_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:af5c155b963dcb491cbe8a3b1daa0c6b1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mekf_8h.html#af5c155b963dcb491cbe8a3b1daa0c6b1">HIGHEST_NUMBER</a>&#160;&#160;&#160;4294967294</td></tr>
<tr class="separator:af5c155b963dcb491cbe8a3b1daa0c6b1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:abe18d5b109f99da1726f89803c17ec26"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mekf_8h.html#abe18d5b109f99da1726f89803c17ec26">mekf</a> (const double <a class="el" href="main_8c.html#ab4c3f2083fd1184ce7aa0a233db26e00">q</a>[4], const double <a class="el" href="main_8c.html#a51ef9e70aeabe7ebad89a2c96f64d127">beta</a>[3], double P[36], const double <a class="el" href="main_8c.html#a6f4cfa41c70f50ef4b5700aef52e6799">omega</a>[3], const double <a class="el" href="main_8c.html#a1da20c45c931350efcddda0349fccfd4">b_B</a>[3], double height_AGL, double <a class="el" href="main_8c.html#a5f90928b96a5400ea15a859630e94260">q_new</a>[4], double <a class="el" href="main_8c.html#a8c58e80126d57fb6e559b59e15f8db19">beta_new</a>[3], double P_new[36])</td></tr>
<tr class="memdesc:abe18d5b109f99da1726f89803c17ec26"><td class="mdescLeft">&#160;</td><td class="mdescRight">Executes one prediction and correction step of the MEKF.  <br /></td></tr>
<tr class="separator:abe18d5b109f99da1726f89803c17ec26"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Multiplicative Extended Kalman Filter (MEKF) for attitude and gyroscope bias estimation. </p>
<dl class="section author"><dt>Author</dt><dd>Francesco Abate, MSA (Originally generated by MATLAB Coder) </dd></dl>
<dl class="section version"><dt>Version</dt><dd>24.2 (MATLAB Coder version) </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2025-05-05</dd></dl>
<p>This header file declares the <code>mekf</code> function, an auto-generated MEKF from MATLAB Coder. The filter is designed to determine the rocket's attitude (3D orientation) by fusing high-frequency gyroscope data with lower-frequency magnetometer readings.</p>
<p>It estimates a 6-degree-of-freedom state:</p><ul>
<li>3 degrees for attitude (represented by a quaternion).</li>
<li>3 degrees for gyroscope bias.</li>
</ul>
<p>This is a core component of the rocket's guidance, navigation, and control (GNC) system. </p>

<p class="definition">Definition in file <a class="el" href="mekf_8h_source.html">mekf.h</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="af5c155b963dcb491cbe8a3b1daa0c6b1" name="af5c155b963dcb491cbe8a3b1daa0c6b1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af5c155b963dcb491cbe8a3b1daa0c6b1">&#9670;&#160;</a></span>HIGHEST_NUMBER</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HIGHEST_NUMBER&#160;&#160;&#160;4294967294</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mekf_8h_source.html#l00034">34</a> of file <a class="el" href="mekf_8h_source.html">mekf.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="abe18d5b109f99da1726f89803c17ec26" name="abe18d5b109f99da1726f89803c17ec26"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abe18d5b109f99da1726f89803c17ec26">&#9670;&#160;</a></span>mekf()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mekf </td>
          <td>(</td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>q</em>[4], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>beta</em>[3], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>P</em>[36], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>omega</em>[3], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>b_B</em>[3], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>height_AGL</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>q_new</em>[4], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>beta_new</em>[3], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>P_new</em>[36]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Executes one prediction and correction step of the MEKF. </p>
<p>This function propagates the state forward using gyroscope readings (prediction step) and then corrects the estimate using magnetometer data (correction step).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">P</td><td>Estimate Covariance Matrix [6x6]. Represents the uncertainty of the state estimate. Updated in place. Stored as a 36-element row-major array. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">q</td><td>The previous attitude state as a quaternion [w, x, y, z]. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">beta</td><td>The previous gyroscope bias estimate vector [3x1] for x, y, z axes. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">omega</td><td>The latest gyroscope measurement vector [3x1] in radians/second. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">b_B</td><td>The latest magnetometer measurement vector [3x1] in the body frame, in mG. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">height_AGL</td><td>The current altitude above ground level in meters (m), used to look up the reference magnetic field from a model. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">q_new</td><td>The updated attitude quaternion [w, x, y, z]. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">beta_new</td><td>The updated gyroscope bias estimate vector [3x1]. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">P_new</td><td>The updated estimate covariance matrix [6x6].</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>None </dd></dl>

<p class="definition">Definition at line <a class="el" href="mekf_8c_source.html#l00088">88</a> of file <a class="el" href="mekf_8c_source.html">mekf.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   91</span>{</div>
<div class="line"><span class="lineno">   92</span>  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code hl_variable" href="main_8c.html#ad3abb693476fba2ed2c23e63de561f32">Q</a>[36] = {4.3956900000000333E-11,</div>
<div class="line"><span class="lineno">   93</span>                               0.0,</div>
<div class="line"><span class="lineno">   94</span>                               0.0,</div>
<div class="line"><span class="lineno">   95</span>                               -5.0000000000000008E-23,</div>
<div class="line"><span class="lineno">   96</span>                               -0.0,</div>
<div class="line"><span class="lineno">   97</span>                               -0.0,</div>
<div class="line"><span class="lineno">   98</span>                               0.0,</div>
<div class="line"><span class="lineno">   99</span>                               4.3956900000000333E-11,</div>
<div class="line"><span class="lineno">  100</span>                               0.0,</div>
<div class="line"><span class="lineno">  101</span>                               -0.0,</div>
<div class="line"><span class="lineno">  102</span>                               -5.0000000000000008E-23,</div>
<div class="line"><span class="lineno">  103</span>                               -0.0,</div>
<div class="line"><span class="lineno">  104</span>                               0.0,</div>
<div class="line"><span class="lineno">  105</span>                               0.0,</div>
<div class="line"><span class="lineno">  106</span>                               4.3956900000000333E-11,</div>
<div class="line"><span class="lineno">  107</span>                               -0.0,</div>
<div class="line"><span class="lineno">  108</span>                               -0.0,</div>
<div class="line"><span class="lineno">  109</span>                               -5.0000000000000008E-23,</div>
<div class="line"><span class="lineno">  110</span>                               -5.0000000000000008E-23,</div>
<div class="line"><span class="lineno">  111</span>                               -0.0,</div>
<div class="line"><span class="lineno">  112</span>                               -0.0,</div>
<div class="line"><span class="lineno">  113</span>                               1.0000000000000001E-20,</div>
<div class="line"><span class="lineno">  114</span>                               0.0,</div>
<div class="line"><span class="lineno">  115</span>                               0.0,</div>
<div class="line"><span class="lineno">  116</span>                               -0.0,</div>
<div class="line"><span class="lineno">  117</span>                               -5.0000000000000008E-23,</div>
<div class="line"><span class="lineno">  118</span>                               -0.0,</div>
<div class="line"><span class="lineno">  119</span>                               0.0,</div>
<div class="line"><span class="lineno">  120</span>                               1.0000000000000001E-20,</div>
<div class="line"><span class="lineno">  121</span>                               0.0,</div>
<div class="line"><span class="lineno">  122</span>                               -0.0,</div>
<div class="line"><span class="lineno">  123</span>                               -0.0,</div>
<div class="line"><span class="lineno">  124</span>                               -5.0000000000000008E-23,</div>
<div class="line"><span class="lineno">  125</span>                               0.0,</div>
<div class="line"><span class="lineno">  126</span>                               0.0,</div>
<div class="line"><span class="lineno">  127</span>                               1.0000000000000001E-20};</div>
<div class="line"><span class="lineno">  128</span>  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> dv[11] = {23950.03, 23938.16, 23926.3,  23914.44,</div>
<div class="line"><span class="lineno">  129</span>                                23902.6,  23890.76, 23878.93, 23867.11,</div>
<div class="line"><span class="lineno">  130</span>                                23855.29, 23843.49, 23831.69};</div>
<div class="line"><span class="lineno">  131</span>  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> dv1[11] = {2585.64, 2583.71, 2581.78, 2579.85,</div>
<div class="line"><span class="lineno">  132</span>                                 2577.92, 2576.0,  2574.08, 2572.15,</div>
<div class="line"><span class="lineno">  133</span>                                 2570.24, 2568.32, 2566.4};</div>
<div class="line"><span class="lineno">  134</span>  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> dv2[11] = {39593.08, 39573.32, 39553.57, 39533.84,</div>
<div class="line"><span class="lineno">  135</span>                                 39514.11, 39494.41, 39474.71, 39455.03,</div>
<div class="line"><span class="lineno">  136</span>                                 39435.36, 39415.7,  39396.06};</div>
<div class="line"><span class="lineno">  137</span>  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> b_y[9] = {0.01, 0.0, 0.0, 0.0, 0.01, 0.0, 0.0, 0.0, 0.01};</div>
<div class="line"><span class="lineno">  138</span>  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code hl_variable" href="main_8c.html#a8523517a36ba1d96b83ca850602e30fa">R</a>[9] = {<a class="code hl_define" href="mekf_8h.html#af5c155b963dcb491cbe8a3b1daa0c6b1">HIGHEST_NUMBER</a>, 0, 0, 0, <a class="code hl_define" href="mekf_8h.html#af5c155b963dcb491cbe8a3b1daa0c6b1">HIGHEST_NUMBER</a>, 0, 0, 0, <a class="code hl_define" href="mekf_8h.html#af5c155b963dcb491cbe8a3b1daa0c6b1">HIGHEST_NUMBER</a>};</div>
<div class="line"><span class="lineno">  139</span>  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">signed</span> <span class="keywordtype">char</span> iv[18] = {0, 0, 0, 0, 0, 0, 0, 0, 0,</div>
<div class="line"><span class="lineno">  140</span>                                     1, 0, 0, 0, 1, 0, 0, 0, 1};</div>
<div class="line"><span class="lineno">  141</span>  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">signed</span> <span class="keywordtype">char</span> b[9] = {1, 0, 0, 0, 1, 0, 0, 0, 1};</div>
<div class="line"><span class="lineno">  142</span>  <span class="keywordtype">double</span> Phi[36];</div>
<div class="line"><span class="lineno">  143</span>  <span class="keywordtype">double</span> b_Phi[36];</div>
<div class="line"><span class="lineno">  144</span>  <span class="keywordtype">double</span> H[18];</div>
<div class="line"><span class="lineno">  145</span>  <span class="keywordtype">double</span> K[18];</div>
<div class="line"><span class="lineno">  146</span>  <span class="keywordtype">double</span> b_H[18];</div>
<div class="line"><span class="lineno">  147</span>  <span class="keywordtype">double</span> cos_term[16];</div>
<div class="line"><span class="lineno">  148</span>  <span class="keywordtype">double</span> A[9];</div>
<div class="line"><span class="lineno">  149</span>  <span class="keywordtype">double</span> dv3[9];</div>
<div class="line"><span class="lineno">  150</span>  <span class="keywordtype">double</span> skew_omega_sq[9];</div>
<div class="line"><span class="lineno">  151</span>  <span class="keywordtype">double</span> delta_x[6];</div>
<div class="line"><span class="lineno">  152</span>  <span class="keywordtype">double</span> delta_q[4];</div>
<div class="line"><span class="lineno">  153</span>  <span class="keywordtype">double</span> axis[3];</div>
<div class="line"><span class="lineno">  154</span>  <span class="keywordtype">double</span> b_W[3] = {0};</div>
<div class="line"><span class="lineno">  155</span>  <span class="keywordtype">double</span> A_tmp;</div>
<div class="line"><span class="lineno">  156</span>  <span class="keywordtype">double</span> a;</div>
<div class="line"><span class="lineno">  157</span>  <span class="keywordtype">double</span> angle;</div>
<div class="line"><span class="lineno">  158</span>  <span class="keywordtype">double</span> b_a;</div>
<div class="line"><span class="lineno">  159</span>  <span class="keywordtype">double</span> d;</div>
<div class="line"><span class="lineno">  160</span>  <span class="keywordtype">double</span> omega_norm;</div>
<div class="line"><span class="lineno">  161</span>  <span class="keywordtype">double</span> sin_term;</div>
<div class="line"><span class="lineno">  162</span>  <span class="keywordtype">double</span> x;</div>
<div class="line"><span class="lineno">  163</span>  <span class="keywordtype">double</span> y;</div>
<div class="line"><span class="lineno">  164</span>  <span class="keywordtype">int</span> H_tmp;</div>
<div class="line"><span class="lineno">  165</span>  <span class="keywordtype">int</span> b_i;</div>
<div class="line"><span class="lineno">  166</span>  <span class="keywordtype">int</span> cos_term_tmp;</div>
<div class="line"><span class="lineno">  167</span>  <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno">  168</span>  <span class="comment">/*  Input parameters: */</span></div>
<div class="line"><span class="lineno">  169</span>  <span class="comment">/*  q                 Attitude quaternion [qx,qy,qz,qw] */</span></div>
<div class="line"><span class="lineno">  170</span>  <span class="comment">/*  beta              Gyro bias estimate (3x1) */</span></div>
<div class="line"><span class="lineno">  171</span>  <span class="comment">/*  P                 Covariance matrix (6x6) */</span></div>
<div class="line"><span class="lineno">  172</span>  <span class="comment">/*  omega             Gyroscope measurement (3x1) */</span></div>
<div class="line"><span class="lineno">  173</span>  <span class="comment">/*  b_B               Measured magnetic field vector (3x1) */</span></div>
<div class="line"><span class="lineno">  174</span>  <span class="comment">/*  height_AGL        Height Above Ground Level */</span></div>
<div class="line"><span class="lineno">  175</span>  <span class="comment">/*  Output parameters: */</span></div>
<div class="line"><span class="lineno">  176</span>  <span class="comment">/*  q_new         Updated quaternion */</span></div>
<div class="line"><span class="lineno">  177</span>  <span class="comment">/*  beta_new      Updated gyro bias estimate */</span></div>
<div class="line"><span class="lineno">  178</span>  <span class="comment">/*  P_new         Updated covariance matrix */</span></div>
<div class="line"><span class="lineno">  179</span>  <span class="comment">/*  PARAMETERS INITIALIZATION */</span></div>
<div class="line"><span class="lineno">  180</span>  <span class="comment">/*  sigma_v       Gyro noise standard deviation */</span></div>
<div class="line"><span class="lineno">  181</span>  <span class="comment">/*  sigma_u       Gyro bias random walk noise standard deviation */</span></div>
<div class="line"><span class="lineno">  182</span>  <span class="comment">/*  sigma_b       Magnetometer noise standard deviation */</span></div>
<div class="line"><span class="lineno">  183</span>  <span class="comment">/*  dt            Time step */</span></div>
<div class="line"><span class="lineno">  184</span>  <span class="comment">/* spec-sheet */</span></div>
<div class="line"><span class="lineno">  185</span>  <span class="comment">/* placeholder */</span></div>
<div class="line"><span class="lineno">  186</span>  <span class="comment">/* spec-sheet */</span></div>
<div class="line"><span class="lineno">  187</span>  <span class="comment">/*  MEASUREMENT UPDATE */</span></div>
<div class="line"><span class="lineno">  188</span>  <span class="comment">/*  Normalize b_B and b_W */</span></div>
<div class="line"><span class="lineno">  189</span>  y = floor(height_AGL / 1000.0);</div>
<div class="line"><span class="lineno">  190</span>  omega_norm = ceil(height_AGL / 1000.0);</div>
<div class="line"><span class="lineno">  191</span>  <span class="comment">//-----------------------------------------------------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="lineno">  192</span>  <span class="comment">//x = (height_AGL / 1000.0 - (y + 1.0)) + 1.0;</span></div>
<div class="line"><span class="lineno">  193</span> <span class="comment">// sin_term = dv[(int)(y + 1.0) - 1];</span></div>
<div class="line"><span class="lineno">  194</span> <span class="comment">// b_W[0] = (dv[(int)(omega_norm + 1.0) - 1] - sin_term) * x + sin_term;</span></div>
<div class="line"><span class="lineno">  195</span> <span class="comment">// sin_term = dv1[(int)(y + 1.0) - 1];</span></div>
<div class="line"><span class="lineno">  196</span> <span class="comment">// b_W[1] = (dv1[(int)(omega_norm + 1.0) - 1] - sin_term) * x + sin_term;</span></div>
<div class="line"><span class="lineno">  197</span> <span class="comment">// sin_term = dv2[(int)(y + 1.0) - 1];</span></div>
<div class="line"><span class="lineno">  198</span> <span class="comment">// b_W[2] = (dv2[(int)(omega_norm + 1.0) - 1] - sin_term) * x + sin_term;</span></div>
<div class="line"><span class="lineno">  199</span>  <span class="comment">//---------------------------------------------------------------------------------------------------------------------------------- commented because of the magnetometers question</span></div>
<div class="line"><span class="lineno">  200</span>  <span class="comment">/*  Assemble point-rotation matrix for q */</span></div>
<div class="line"><span class="lineno">  201</span>  y = 2.0 * (<a class="code hl_variable" href="main_8c.html#ab4c3f2083fd1184ce7aa0a233db26e00">q</a>[2] * <a class="code hl_variable" href="main_8c.html#ab4c3f2083fd1184ce7aa0a233db26e00">q</a>[2]);</div>
<div class="line"><span class="lineno">  202</span>  omega_norm = 2.0 * (<a class="code hl_variable" href="main_8c.html#ab4c3f2083fd1184ce7aa0a233db26e00">q</a>[1] * <a class="code hl_variable" href="main_8c.html#ab4c3f2083fd1184ce7aa0a233db26e00">q</a>[1]);</div>
<div class="line"><span class="lineno">  203</span>  A[0] = (1.0 - omega_norm) - y;</div>
<div class="line"><span class="lineno">  204</span>  x = <a class="code hl_variable" href="main_8c.html#ab4c3f2083fd1184ce7aa0a233db26e00">q</a>[0] * <a class="code hl_variable" href="main_8c.html#ab4c3f2083fd1184ce7aa0a233db26e00">q</a>[1];</div>
<div class="line"><span class="lineno">  205</span>  sin_term = <a class="code hl_variable" href="main_8c.html#ab4c3f2083fd1184ce7aa0a233db26e00">q</a>[2] * <a class="code hl_variable" href="main_8c.html#ab4c3f2083fd1184ce7aa0a233db26e00">q</a>[3];</div>
<div class="line"><span class="lineno">  206</span>  A[3] = 2.0 * (x - sin_term);</div>
<div class="line"><span class="lineno">  207</span>  A_tmp = <a class="code hl_variable" href="main_8c.html#ab4c3f2083fd1184ce7aa0a233db26e00">q</a>[0] * <a class="code hl_variable" href="main_8c.html#ab4c3f2083fd1184ce7aa0a233db26e00">q</a>[2];</div>
<div class="line"><span class="lineno">  208</span>  angle = <a class="code hl_variable" href="main_8c.html#ab4c3f2083fd1184ce7aa0a233db26e00">q</a>[1] * <a class="code hl_variable" href="main_8c.html#ab4c3f2083fd1184ce7aa0a233db26e00">q</a>[3];</div>
<div class="line"><span class="lineno">  209</span>  A[6] = 2.0 * (A_tmp + angle);</div>
<div class="line"><span class="lineno">  210</span>  A[1] = 2.0 * (x + sin_term);</div>
<div class="line"><span class="lineno">  211</span>  x = 1.0 - 2.0 * (<a class="code hl_variable" href="main_8c.html#ab4c3f2083fd1184ce7aa0a233db26e00">q</a>[0] * <a class="code hl_variable" href="main_8c.html#ab4c3f2083fd1184ce7aa0a233db26e00">q</a>[0]);</div>
<div class="line"><span class="lineno">  212</span>  A[4] = x - y;</div>
<div class="line"><span class="lineno">  213</span>  y = <a class="code hl_variable" href="main_8c.html#ab4c3f2083fd1184ce7aa0a233db26e00">q</a>[1] * <a class="code hl_variable" href="main_8c.html#ab4c3f2083fd1184ce7aa0a233db26e00">q</a>[2];</div>
<div class="line"><span class="lineno">  214</span>  sin_term = <a class="code hl_variable" href="main_8c.html#ab4c3f2083fd1184ce7aa0a233db26e00">q</a>[0] * <a class="code hl_variable" href="main_8c.html#ab4c3f2083fd1184ce7aa0a233db26e00">q</a>[3];</div>
<div class="line"><span class="lineno">  215</span>  A[7] = 2.0 * (y - sin_term);</div>
<div class="line"><span class="lineno">  216</span>  A[2] = 2.0 * (A_tmp - angle);</div>
<div class="line"><span class="lineno">  217</span>  A[5] = 2.0 * (y + sin_term);</div>
<div class="line"><span class="lineno">  218</span>  A[8] = x - omega_norm;</div>
<div class="line"><span class="lineno">  219</span>  <span class="comment">/*  Calculate predicted measurement */</span></div>
<div class="line"><span class="lineno">  220</span>  <span class="comment">/*  Define sensitivity matrix */</span></div>
<div class="line"><span class="lineno">  221</span>  <span class="comment">/*  Create skew-symmetric matrix from a 3x1 vector */</span></div>
<div class="line"><span class="lineno">  222</span>  H[0] = 0.0;</div>
<div class="line"><span class="lineno">  223</span>  H[4] = 0.0;</div>
<div class="line"><span class="lineno">  224</span>  H[8] = 0.0;</div>
<div class="line"><span class="lineno">  225</span>  d = b_W[0];</div>
<div class="line"><span class="lineno">  226</span>  A_tmp = b_W[1];</div>
<div class="line"><span class="lineno">  227</span>  y = b_W[2];</div>
<div class="line"><span class="lineno">  228</span>  <span class="keywordflow">for</span> (i = 0; i &lt; 3; i++) {</div>
<div class="line"><span class="lineno">  229</span>    H_tmp = 3 * (i + 3);</div>
<div class="line"><span class="lineno">  230</span>    H[H_tmp] = 0.0;</div>
<div class="line"><span class="lineno">  231</span>    H[H_tmp + 1] = 0.0;</div>
<div class="line"><span class="lineno">  232</span>    H[H_tmp + 2] = 0.0;</div>
<div class="line"><span class="lineno">  233</span>    axis[i] = (A[i] * d + A[i + 3] * A_tmp) + A[i + 6] * y;</div>
<div class="line"><span class="lineno">  234</span>  }</div>
<div class="line"><span class="lineno">  235</span>  H[3] = -axis[2];</div>
<div class="line"><span class="lineno">  236</span>  H[6] = axis[1];</div>
<div class="line"><span class="lineno">  237</span>  H[1] = axis[2];</div>
<div class="line"><span class="lineno">  238</span>  H[7] = -axis[0];</div>
<div class="line"><span class="lineno">  239</span>  H[2] = -axis[1];</div>
<div class="line"><span class="lineno">  240</span>  H[5] = axis[0];</div>
<div class="line"><span class="lineno">  241</span>  <span class="comment">/*  Calculate Kalman gain */</span></div>
<div class="line"><span class="lineno">  242</span>  <span class="keywordflow">for</span> (i = 0; i &lt; 3; i++) {</div>
<div class="line"><span class="lineno">  243</span>    <span class="keywordflow">for</span> (cos_term_tmp = 0; cos_term_tmp &lt; 6; cos_term_tmp++) {</div>
<div class="line"><span class="lineno">  244</span>      d = 0.0;</div>
<div class="line"><span class="lineno">  245</span>      <span class="keywordflow">for</span> (H_tmp = 0; H_tmp &lt; 6; H_tmp++) {</div>
<div class="line"><span class="lineno">  246</span>        d += H[i + 3 * H_tmp] * P[H_tmp + 6 * cos_term_tmp];</div>
<div class="line"><span class="lineno">  247</span>      }</div>
<div class="line"><span class="lineno">  248</span>      b_H[i + 3 * cos_term_tmp] = d;</div>
<div class="line"><span class="lineno">  249</span>    }</div>
<div class="line"><span class="lineno">  250</span>    <span class="keywordflow">for</span> (cos_term_tmp = 0; cos_term_tmp &lt; 3; cos_term_tmp++) {</div>
<div class="line"><span class="lineno">  251</span>      d = 0.0;</div>
<div class="line"><span class="lineno">  252</span>      <span class="keywordflow">for</span> (H_tmp = 0; H_tmp &lt; 6; H_tmp++) {</div>
<div class="line"><span class="lineno">  253</span>        d += b_H[i + 3 * H_tmp] * H[cos_term_tmp + 3 * H_tmp];</div>
<div class="line"><span class="lineno">  254</span>      }</div>
<div class="line"><span class="lineno">  255</span>      H_tmp = i + 3 * cos_term_tmp;</div>
<div class="line"><span class="lineno">  256</span>      skew_omega_sq[H_tmp] = d + (double)<a class="code hl_variable" href="main_8c.html#a8523517a36ba1d96b83ca850602e30fa">R</a>[H_tmp];</div>
<div class="line"><span class="lineno">  257</span>    }</div>
<div class="line"><span class="lineno">  258</span>  }</div>
<div class="line"><span class="lineno">  259</span>  <a class="code hl_function" href="mpower_8c.html#a14a99d692fd15c8d9d7f487c6f311ef5">mpower</a>(skew_omega_sq, dv3);</div>
<div class="line"><span class="lineno">  260</span>  <span class="keywordflow">for</span> (i = 0; i &lt; 6; i++) {</div>
<div class="line"><span class="lineno">  261</span>    <span class="keywordflow">for</span> (cos_term_tmp = 0; cos_term_tmp &lt; 3; cos_term_tmp++) {</div>
<div class="line"><span class="lineno">  262</span>      d = 0.0;</div>
<div class="line"><span class="lineno">  263</span>      <span class="keywordflow">for</span> (H_tmp = 0; H_tmp &lt; 6; H_tmp++) {</div>
<div class="line"><span class="lineno">  264</span>        d += P[i + 6 * H_tmp] * H[cos_term_tmp + 3 * H_tmp];</div>
<div class="line"><span class="lineno">  265</span>      }</div>
<div class="line"><span class="lineno">  266</span>      b_H[i + 6 * cos_term_tmp] = d;</div>
<div class="line"><span class="lineno">  267</span>    }</div>
<div class="line"><span class="lineno">  268</span>    d = b_H[i];</div>
<div class="line"><span class="lineno">  269</span>    A_tmp = b_H[i + 6];</div>
<div class="line"><span class="lineno">  270</span>    y = b_H[i + 12];</div>
<div class="line"><span class="lineno">  271</span>    <span class="keywordflow">for</span> (cos_term_tmp = 0; cos_term_tmp &lt; 3; cos_term_tmp++) {</div>
<div class="line"><span class="lineno">  272</span>      K[i + 6 * cos_term_tmp] =</div>
<div class="line"><span class="lineno">  273</span>          (d * dv3[3 * cos_term_tmp] + A_tmp * dv3[3 * cos_term_tmp + 1]) +</div>
<div class="line"><span class="lineno">  274</span>          y * dv3[3 * cos_term_tmp + 2];</div>
<div class="line"><span class="lineno">  275</span>    }</div>
<div class="line"><span class="lineno">  276</span>  }</div>
<div class="line"><span class="lineno">  277</span>  <span class="comment">/*  Update error state */</span></div>
<div class="line"><span class="lineno">  278</span>  d = <a class="code hl_function" href="norm_8c.html#aa2f1f6f0418837c19636fa89d661b2ac">b_norm</a>(<a class="code hl_variable" href="main_8c.html#a1da20c45c931350efcddda0349fccfd4">b_B</a>);</div>
<div class="line"><span class="lineno">  279</span>  A_tmp = <a class="code hl_function" href="norm_8c.html#aa2f1f6f0418837c19636fa89d661b2ac">b_norm</a>(b_W);</div>
<div class="line"><span class="lineno">  280</span>  <span class="comment">//-----------------------------------------TODO SETTATO A 0 PER VIA DEL TINKERING, EVITARE 0/0</span></div>
<div class="line"><span class="lineno">  281</span>  omega_norm = 0;<span class="comment">// b_W[0] / A_tmp;</span></div>
<div class="line"><span class="lineno">  282</span>  x = 0;<span class="comment">//b_W[1] / A_tmp;</span></div>
<div class="line"><span class="lineno">  283</span>  y = 0;<span class="comment">//b_W[2] / A_tmp;</span></div>
<div class="line"><span class="lineno">  284</span>  <span class="comment">//for (i = 0; i &lt; 3; i++) {</span></div>
<div class="line"><span class="lineno">  285</span>    <span class="comment">//b_W[i] = b_B[i] / d - ((A[i] * omega_norm + A[i + 3] * x) + A[i + 6] * y);</span></div>
<div class="line"><span class="lineno">  286</span>  <span class="comment">//}</span></div>
<div class="line"><span class="lineno">  287</span>  <span class="comment">//-----------------------------------------TODO SETTATO A 0 PER VIA DEL TINKERING, EVITARE 0/0</span></div>
<div class="line"><span class="lineno">  288</span>  <span class="comment">/*  Update global states */</span></div>
<div class="line"><span class="lineno">  289</span>  <span class="comment">/*  QUATERNION UPDATE */</span></div>
<div class="line"><span class="lineno">  290</span>  <span class="comment">/*  delta_q quaternion definition */</span></div>
<div class="line"><span class="lineno">  291</span>  <span class="comment">/*  Small angle approx */</span></div>
<div class="line"><span class="lineno">  292</span>  <span class="comment">/*  Scalar part */</span></div>
<div class="line"><span class="lineno">  293</span>  <span class="comment">/*  Multiply delta_q with the current quaternion */</span></div>
<div class="line"><span class="lineno">  294</span>  <span class="comment">/*  Normalize the result */</span></div>
<div class="line"><span class="lineno">  295</span>  <span class="comment">/*  BIAS UPDATE */</span></div>
<div class="line"><span class="lineno">  296</span>  <span class="comment">/*  COVARIANCE MATRIX UPDATE */</span></div>
<div class="line"><span class="lineno">  297</span>  <a class="code hl_function" href="eye_8c.html#a904eb8da59edc08e1a96b3b2ce63bcfc">b_eye</a>(Phi);</div>
<div class="line"><span class="lineno">  298</span>  <span class="keywordflow">for</span> (i = 0; i &lt; 6; i++) {</div>
<div class="line"><span class="lineno">  299</span>    d = K[i];</div>
<div class="line"><span class="lineno">  300</span>    A_tmp = K[i + 6];</div>
<div class="line"><span class="lineno">  301</span>    y = K[i + 12];</div>
<div class="line"><span class="lineno">  302</span>    delta_x[i] = (d * b_W[0] + A_tmp * b_W[1]) + y * b_W[2];</div>
<div class="line"><span class="lineno">  303</span>    <span class="keywordflow">for</span> (cos_term_tmp = 0; cos_term_tmp &lt; 6; cos_term_tmp++) {</div>
<div class="line"><span class="lineno">  304</span>      H_tmp = i + 6 * cos_term_tmp;</div>
<div class="line"><span class="lineno">  305</span>      b_Phi[H_tmp] =</div>
<div class="line"><span class="lineno">  306</span>          Phi[H_tmp] -</div>
<div class="line"><span class="lineno">  307</span>          ((d * H[3 * cos_term_tmp] + A_tmp * H[3 * cos_term_tmp + 1]) +</div>
<div class="line"><span class="lineno">  308</span>           y * H[3 * cos_term_tmp + 2]);</div>
<div class="line"><span class="lineno">  309</span>    }</div>
<div class="line"><span class="lineno">  310</span>    <span class="keywordflow">for</span> (cos_term_tmp = 0; cos_term_tmp &lt; 6; cos_term_tmp++) {</div>
<div class="line"><span class="lineno">  311</span>      d = 0.0;</div>
<div class="line"><span class="lineno">  312</span>      <span class="keywordflow">for</span> (H_tmp = 0; H_tmp &lt; 6; H_tmp++) {</div>
<div class="line"><span class="lineno">  313</span>        d += b_Phi[i + 6 * H_tmp] * P[H_tmp + 6 * cos_term_tmp];</div>
<div class="line"><span class="lineno">  314</span>      }</div>
<div class="line"><span class="lineno">  315</span>      Phi[i + 6 * cos_term_tmp] = d;</div>
<div class="line"><span class="lineno">  316</span>    }</div>
<div class="line"><span class="lineno">  317</span>  }</div>
<div class="line"><span class="lineno">  318</span>  delta_q[0] = 0.5 * delta_x[0];</div>
<div class="line"><span class="lineno">  319</span>  delta_q[1] = 0.5 * delta_x[1];</div>
<div class="line"><span class="lineno">  320</span>  delta_q[2] = 0.5 * delta_x[2];</div>
<div class="line"><span class="lineno">  321</span>  <a class="code hl_variable" href="main_8c.html#a5f90928b96a5400ea15a859630e94260">q_new</a>[0] =</div>
<div class="line"><span class="lineno">  322</span>      ((delta_q[0] * <a class="code hl_variable" href="main_8c.html#ab4c3f2083fd1184ce7aa0a233db26e00">q</a>[3] + <a class="code hl_variable" href="main_8c.html#ab4c3f2083fd1184ce7aa0a233db26e00">q</a>[0]) + <a class="code hl_variable" href="main_8c.html#ab4c3f2083fd1184ce7aa0a233db26e00">q</a>[1] * delta_q[2]) - delta_q[1] * <a class="code hl_variable" href="main_8c.html#ab4c3f2083fd1184ce7aa0a233db26e00">q</a>[2];</div>
<div class="line"><span class="lineno">  323</span>  <a class="code hl_variable" href="main_8c.html#a5f90928b96a5400ea15a859630e94260">q_new</a>[1] =</div>
<div class="line"><span class="lineno">  324</span>      ((delta_q[1] * <a class="code hl_variable" href="main_8c.html#ab4c3f2083fd1184ce7aa0a233db26e00">q</a>[3] - <a class="code hl_variable" href="main_8c.html#ab4c3f2083fd1184ce7aa0a233db26e00">q</a>[0] * delta_q[2]) + <a class="code hl_variable" href="main_8c.html#ab4c3f2083fd1184ce7aa0a233db26e00">q</a>[1]) + delta_q[0] * <a class="code hl_variable" href="main_8c.html#ab4c3f2083fd1184ce7aa0a233db26e00">q</a>[2];</div>
<div class="line"><span class="lineno">  325</span>  <a class="code hl_variable" href="main_8c.html#a5f90928b96a5400ea15a859630e94260">q_new</a>[2] =</div>
<div class="line"><span class="lineno">  326</span>      ((delta_q[2] * <a class="code hl_variable" href="main_8c.html#ab4c3f2083fd1184ce7aa0a233db26e00">q</a>[3] + <a class="code hl_variable" href="main_8c.html#ab4c3f2083fd1184ce7aa0a233db26e00">q</a>[0] * delta_q[1]) - delta_q[0] * <a class="code hl_variable" href="main_8c.html#ab4c3f2083fd1184ce7aa0a233db26e00">q</a>[1]) + <a class="code hl_variable" href="main_8c.html#ab4c3f2083fd1184ce7aa0a233db26e00">q</a>[2];</div>
<div class="line"><span class="lineno">  327</span>  <a class="code hl_variable" href="main_8c.html#a5f90928b96a5400ea15a859630e94260">q_new</a>[3] =</div>
<div class="line"><span class="lineno">  328</span>      ((<a class="code hl_variable" href="main_8c.html#ab4c3f2083fd1184ce7aa0a233db26e00">q</a>[3] - <a class="code hl_variable" href="main_8c.html#ab4c3f2083fd1184ce7aa0a233db26e00">q</a>[0] * delta_q[0]) - <a class="code hl_variable" href="main_8c.html#ab4c3f2083fd1184ce7aa0a233db26e00">q</a>[1] * delta_q[1]) - <a class="code hl_variable" href="main_8c.html#ab4c3f2083fd1184ce7aa0a233db26e00">q</a>[2] * delta_q[2];</div>
<div class="line"><span class="lineno">  329</span>  d = <a class="code hl_function" href="norm_8c.html#afe7e9a93950e318570d2bfc4c9dae52a">c_norm</a>(<a class="code hl_variable" href="main_8c.html#a5f90928b96a5400ea15a859630e94260">q_new</a>);</div>
<div class="line"><span class="lineno">  330</span>  <a class="code hl_variable" href="main_8c.html#a5f90928b96a5400ea15a859630e94260">q_new</a>[0] /= d;</div>
<div class="line"><span class="lineno">  331</span>  <a class="code hl_variable" href="main_8c.html#a5f90928b96a5400ea15a859630e94260">q_new</a>[1] /= d;</div>
<div class="line"><span class="lineno">  332</span>  <a class="code hl_variable" href="main_8c.html#a5f90928b96a5400ea15a859630e94260">q_new</a>[2] /= d;</div>
<div class="line"><span class="lineno">  333</span>  <a class="code hl_variable" href="main_8c.html#a5f90928b96a5400ea15a859630e94260">q_new</a>[3] /= d;</div>
<div class="line"><span class="lineno">  334</span>  <a class="code hl_variable" href="main_8c.html#a8c58e80126d57fb6e559b59e15f8db19">beta_new</a>[0] = <a class="code hl_variable" href="main_8c.html#a51ef9e70aeabe7ebad89a2c96f64d127">beta</a>[0] + delta_x[3];</div>
<div class="line"><span class="lineno">  335</span>  <a class="code hl_variable" href="main_8c.html#a8c58e80126d57fb6e559b59e15f8db19">beta_new</a>[1] = <a class="code hl_variable" href="main_8c.html#a51ef9e70aeabe7ebad89a2c96f64d127">beta</a>[1] + delta_x[4];</div>
<div class="line"><span class="lineno">  336</span>  <a class="code hl_variable" href="main_8c.html#a8c58e80126d57fb6e559b59e15f8db19">beta_new</a>[2] = <a class="code hl_variable" href="main_8c.html#a51ef9e70aeabe7ebad89a2c96f64d127">beta</a>[2] + delta_x[5];</div>
<div class="line"><span class="lineno">  337</span>  memcpy(&amp;P[0], &amp;Phi[0], 36U * <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><span class="lineno">  338</span>  <span class="comment">/*  STATE PROPAGATION */</span></div>
<div class="line"><span class="lineno">  339</span>  <span class="comment">/*  Calculate the gyroscope measurement without the bias */</span></div>
<div class="line"><span class="lineno">  340</span>  b_W[0] = <a class="code hl_variable" href="main_8c.html#a6f4cfa41c70f50ef4b5700aef52e6799">omega</a>[0] - <a class="code hl_variable" href="main_8c.html#a8c58e80126d57fb6e559b59e15f8db19">beta_new</a>[0];</div>
<div class="line"><span class="lineno">  341</span>  b_W[1] = <a class="code hl_variable" href="main_8c.html#a6f4cfa41c70f50ef4b5700aef52e6799">omega</a>[1] - <a class="code hl_variable" href="main_8c.html#a8c58e80126d57fb6e559b59e15f8db19">beta_new</a>[1];</div>
<div class="line"><span class="lineno">  342</span>  b_W[2] = <a class="code hl_variable" href="main_8c.html#a6f4cfa41c70f50ef4b5700aef52e6799">omega</a>[2] - <a class="code hl_variable" href="main_8c.html#a8c58e80126d57fb6e559b59e15f8db19">beta_new</a>[2];</div>
<div class="line"><span class="lineno">  343</span>  <span class="comment">/*  Calculate the magnitude of the angular velocity */</span></div>
<div class="line"><span class="lineno">  344</span>  omega_norm = <a class="code hl_function" href="norm_8c.html#aa2f1f6f0418837c19636fa89d661b2ac">b_norm</a>(b_W);</div>
<div class="line"><span class="lineno">  345</span>  <span class="comment">/*  Calculate the angle and axis of rotation */</span></div>
<div class="line"><span class="lineno">  346</span>  angle = omega_norm * 0.01;</div>
<div class="line"><span class="lineno">  347</span>  <span class="comment">/*  Compute the matrix exponential */</span></div>
<div class="line"><span class="lineno">  348</span>  x = cos(angle);</div>
<div class="line"><span class="lineno">  349</span>  sin_term = sin(angle);</div>
<div class="line"><span class="lineno">  350</span>  <span class="comment">/*  Define the skew symmetric matrix for omega_hat */</span></div>
<div class="line"><span class="lineno">  351</span>  <span class="comment">/*  Create skew-symmetric matrix from a 3x1 vector */</span></div>
<div class="line"><span class="lineno">  352</span>  A[0] = 0.0;</div>
<div class="line"><span class="lineno">  353</span>  A[3] = -b_W[2];</div>
<div class="line"><span class="lineno">  354</span>  A[6] = b_W[1];</div>
<div class="line"><span class="lineno">  355</span>  A[1] = b_W[2];</div>
<div class="line"><span class="lineno">  356</span>  A[4] = 0.0;</div>
<div class="line"><span class="lineno">  357</span>  A[7] = -b_W[0];</div>
<div class="line"><span class="lineno">  358</span>  A[2] = -b_W[1];</div>
<div class="line"><span class="lineno">  359</span>  A[5] = b_W[0];</div>
<div class="line"><span class="lineno">  360</span>  A[8] = 0.0;</div>
<div class="line"><span class="lineno">  361</span>  <span class="comment">/*  Calculate the squared product of the skew matrix of omega_hat */</span></div>
<div class="line"><span class="lineno">  362</span>  <span class="keywordflow">for</span> (b_i = 0; b_i &lt; 3; b_i++) {</div>
<div class="line"><span class="lineno">  363</span>    axis[b_i] = b_W[b_i] / omega_norm;</div>
<div class="line"><span class="lineno">  364</span>    <span class="keywordflow">for</span> (i = 0; i &lt; 3; i++) {</div>
<div class="line"><span class="lineno">  365</span>      skew_omega_sq[b_i + 3 * i] =</div>
<div class="line"><span class="lineno">  366</span>          (A[b_i] * A[3 * i] + A[b_i + 3] * A[3 * i + 1]) +</div>
<div class="line"><span class="lineno">  367</span>          A[b_i + 6] * A[3 * i + 2];</div>
<div class="line"><span class="lineno">  368</span>    }</div>
<div class="line"><span class="lineno">  369</span>  }</div>
<div class="line"><span class="lineno">  370</span>  <span class="comment">/*  Calculate the elements of the first row of the phi matrix */</span></div>
<div class="line"><span class="lineno">  371</span>  a = sin_term / omega_norm;</div>
<div class="line"><span class="lineno">  372</span>  y = omega_norm * omega_norm;</div>
<div class="line"><span class="lineno">  373</span>  b_a = x / y;</div>
<div class="line"><span class="lineno">  374</span>  x = (1.0 - x) / y;</div>
<div class="line"><span class="lineno">  375</span>  y = (angle - sin_term) / <a class="code hl_function" href="mekf_8c.html#aec012aeba63ea4ffcdc8bcede27b6847">rt_powd_snf</a>(omega_norm, 3.0);</div>
<div class="line"><span class="lineno">  376</span>  <span class="comment">/*  Assemble phi matrix */</span></div>
<div class="line"><span class="lineno">  377</span>  <a class="code hl_function" href="eye_8c.html#af97fcd83250503a8d844da14475156a3">eye</a>(dv3);</div>
<div class="line"><span class="lineno">  378</span>  <span class="keywordflow">for</span> (i = 0; i &lt; 3; i++) {</div>
<div class="line"><span class="lineno">  379</span>    d = A[3 * i];</div>
<div class="line"><span class="lineno">  380</span>    A_tmp = skew_omega_sq[3 * i];</div>
<div class="line"><span class="lineno">  381</span>    Phi[6 * i] = (dv3[3 * i] - a * d) + b_a * A_tmp;</div>
<div class="line"><span class="lineno">  382</span>    H_tmp = 6 * (i + 3);</div>
<div class="line"><span class="lineno">  383</span>    Phi[H_tmp] = (x * d - y * A_tmp) - b_y[3 * i];</div>
<div class="line"><span class="lineno">  384</span>    cos_term_tmp = 3 * i + 1;</div>
<div class="line"><span class="lineno">  385</span>    d = A[cos_term_tmp];</div>
<div class="line"><span class="lineno">  386</span>    A_tmp = skew_omega_sq[cos_term_tmp];</div>
<div class="line"><span class="lineno">  387</span>    Phi[6 * i + 1] = (dv3[cos_term_tmp] - a * d) + b_a * A_tmp;</div>
<div class="line"><span class="lineno">  388</span>    Phi[H_tmp + 1] = (x * d - y * A_tmp) - b_y[cos_term_tmp];</div>
<div class="line"><span class="lineno">  389</span>    cos_term_tmp = 3 * i + 2;</div>
<div class="line"><span class="lineno">  390</span>    d = A[cos_term_tmp];</div>
<div class="line"><span class="lineno">  391</span>    A_tmp = skew_omega_sq[cos_term_tmp];</div>
<div class="line"><span class="lineno">  392</span>    Phi[6 * i + 2] = (dv3[cos_term_tmp] - a * d) + b_a * A_tmp;</div>
<div class="line"><span class="lineno">  393</span>    Phi[H_tmp + 2] = (x * d - y * A_tmp) - b_y[cos_term_tmp];</div>
<div class="line"><span class="lineno">  394</span>  }</div>
<div class="line"><span class="lineno">  395</span>  <span class="keywordflow">for</span> (i = 0; i &lt; 6; i++) {</div>
<div class="line"><span class="lineno">  396</span>    Phi[6 * i + 3] = iv[3 * i];</div>
<div class="line"><span class="lineno">  397</span>    Phi[6 * i + 4] = iv[3 * i + 1];</div>
<div class="line"><span class="lineno">  398</span>    Phi[6 * i + 5] = iv[3 * i + 2];</div>
<div class="line"><span class="lineno">  399</span>  }</div>
<div class="line"><span class="lineno">  400</span>  <span class="comment">/*  Calculate the elements of Q_k */</span></div>
<div class="line"><span class="lineno">  401</span>  <span class="comment">/*  Assemble Q_k */</span></div>
<div class="line"><span class="lineno">  402</span>  <span class="comment">/*  Covariance propagation */</span></div>
<div class="line"><span class="lineno">  403</span>  <span class="keywordflow">for</span> (i = 0; i &lt; 6; i++) {</div>
<div class="line"><span class="lineno">  404</span>    <span class="keywordflow">for</span> (cos_term_tmp = 0; cos_term_tmp &lt; 6; cos_term_tmp++) {</div>
<div class="line"><span class="lineno">  405</span>      d = 0.0;</div>
<div class="line"><span class="lineno">  406</span>      <span class="keywordflow">for</span> (H_tmp = 0; H_tmp &lt; 6; H_tmp++) {</div>
<div class="line"><span class="lineno">  407</span>        d += Phi[i + 6 * H_tmp] * P[H_tmp + 6 * cos_term_tmp];</div>
<div class="line"><span class="lineno">  408</span>      }</div>
<div class="line"><span class="lineno">  409</span>      b_Phi[i + 6 * cos_term_tmp] = d;</div>
<div class="line"><span class="lineno">  410</span>    }</div>
<div class="line"><span class="lineno">  411</span>    <span class="keywordflow">for</span> (cos_term_tmp = 0; cos_term_tmp &lt; 6; cos_term_tmp++) {</div>
<div class="line"><span class="lineno">  412</span>      d = 0.0;</div>
<div class="line"><span class="lineno">  413</span>      <span class="keywordflow">for</span> (H_tmp = 0; H_tmp &lt; 6; H_tmp++) {</div>
<div class="line"><span class="lineno">  414</span>        d += b_Phi[i + 6 * H_tmp] * Phi[cos_term_tmp + 6 * H_tmp];</div>
<div class="line"><span class="lineno">  415</span>      }</div>
<div class="line"><span class="lineno">  416</span>      H_tmp = i + 6 * cos_term_tmp;</div>
<div class="line"><span class="lineno">  417</span>      P_new[H_tmp] = d + <a class="code hl_variable" href="main_8c.html#ad3abb693476fba2ed2c23e63de561f32">Q</a>[H_tmp];</div>
<div class="line"><span class="lineno">  418</span>    }</div>
<div class="line"><span class="lineno">  419</span>  }</div>
<div class="line"><span class="lineno">  420</span>  <span class="comment">/*  Compute the skew-symmetric matrix for the axis */</span></div>
<div class="line"><span class="lineno">  421</span>  <span class="comment">/*  Create skew-symmetric matrix from a 3x1 vector */</span></div>
<div class="line"><span class="lineno">  422</span>  <span class="comment">/*  Recompute the sine and cosine terms */</span></div>
<div class="line"><span class="lineno">  423</span>  x = cos(0.5 * angle);</div>
<div class="line"><span class="lineno">  424</span>  sin_term = sin(0.5 * angle);</div>
<div class="line"><span class="lineno">  425</span>  <span class="comment">/*  Construct the Theta matrix */</span></div>
<div class="line"><span class="lineno">  426</span>  <span class="comment">/*  Propagate the quaternion */</span></div>
<div class="line"><span class="lineno">  427</span>  skew_omega_sq[0] = sin_term * 0.0;</div>
<div class="line"><span class="lineno">  428</span>  skew_omega_sq[3] = sin_term * -axis[2];</div>
<div class="line"><span class="lineno">  429</span>  skew_omega_sq[6] = sin_term * axis[1];</div>
<div class="line"><span class="lineno">  430</span>  skew_omega_sq[1] = sin_term * axis[2];</div>
<div class="line"><span class="lineno">  431</span>  skew_omega_sq[4] = sin_term * 0.0;</div>
<div class="line"><span class="lineno">  432</span>  skew_omega_sq[7] = sin_term * -axis[0];</div>
<div class="line"><span class="lineno">  433</span>  skew_omega_sq[2] = sin_term * -axis[1];</div>
<div class="line"><span class="lineno">  434</span>  skew_omega_sq[5] = sin_term * axis[0];</div>
<div class="line"><span class="lineno">  435</span>  skew_omega_sq[8] = sin_term * 0.0;</div>
<div class="line"><span class="lineno">  436</span>  <span class="keywordflow">for</span> (b_i = 0; b_i &lt; 3; b_i++) {</div>
<div class="line"><span class="lineno">  437</span>    d = sin_term * axis[b_i];</div>
<div class="line"><span class="lineno">  438</span>    H_tmp = b_i &lt;&lt; 2;</div>
<div class="line"><span class="lineno">  439</span>    cos_term[H_tmp] = x * (double)b[3 * b_i] - skew_omega_sq[3 * b_i];</div>
<div class="line"><span class="lineno">  440</span>    cos_term_tmp = 3 * b_i + 1;</div>
<div class="line"><span class="lineno">  441</span>    cos_term[H_tmp + 1] =</div>
<div class="line"><span class="lineno">  442</span>        x * (double)b[cos_term_tmp] - skew_omega_sq[cos_term_tmp];</div>
<div class="line"><span class="lineno">  443</span>    cos_term_tmp = 3 * b_i + 2;</div>
<div class="line"><span class="lineno">  444</span>    cos_term[H_tmp + 2] =</div>
<div class="line"><span class="lineno">  445</span>        x * (double)b[cos_term_tmp] - skew_omega_sq[cos_term_tmp];</div>
<div class="line"><span class="lineno">  446</span>    cos_term[b_i + 12] = d;</div>
<div class="line"><span class="lineno">  447</span>    cos_term[H_tmp + 3] = -d;</div>
<div class="line"><span class="lineno">  448</span>  }</div>
<div class="line"><span class="lineno">  449</span>  cos_term[15] = x;</div>
<div class="line"><span class="lineno">  450</span>  d = <a class="code hl_variable" href="main_8c.html#a5f90928b96a5400ea15a859630e94260">q_new</a>[0];</div>
<div class="line"><span class="lineno">  451</span>  A_tmp = <a class="code hl_variable" href="main_8c.html#a5f90928b96a5400ea15a859630e94260">q_new</a>[1];</div>
<div class="line"><span class="lineno">  452</span>  y = <a class="code hl_variable" href="main_8c.html#a5f90928b96a5400ea15a859630e94260">q_new</a>[2];</div>
<div class="line"><span class="lineno">  453</span>  omega_norm = <a class="code hl_variable" href="main_8c.html#a5f90928b96a5400ea15a859630e94260">q_new</a>[3];</div>
<div class="line"><span class="lineno">  454</span>  <span class="keywordflow">for</span> (i = 0; i &lt; 4; i++) {</div>
<div class="line"><span class="lineno">  455</span>    delta_q[i] =</div>
<div class="line"><span class="lineno">  456</span>        ((cos_term[i] * d + cos_term[i + 4] * A_tmp) + cos_term[i + 8] * y) +</div>
<div class="line"><span class="lineno">  457</span>        cos_term[i + 12] * omega_norm;</div>
<div class="line"><span class="lineno">  458</span>  }</div>
<div class="line"><span class="lineno">  459</span>  <span class="comment">/*  Normalize the propagated quaternion */</span></div>
<div class="line"><span class="lineno">  460</span>  d = <a class="code hl_function" href="norm_8c.html#afe7e9a93950e318570d2bfc4c9dae52a">c_norm</a>(delta_q);</div>
<div class="line"><span class="lineno">  461</span>  <a class="code hl_variable" href="main_8c.html#a5f90928b96a5400ea15a859630e94260">q_new</a>[0] = delta_q[0] / d;</div>
<div class="line"><span class="lineno">  462</span>  <a class="code hl_variable" href="main_8c.html#a5f90928b96a5400ea15a859630e94260">q_new</a>[1] = delta_q[1] / d;</div>
<div class="line"><span class="lineno">  463</span>  <a class="code hl_variable" href="main_8c.html#a5f90928b96a5400ea15a859630e94260">q_new</a>[2] = delta_q[2] / d;</div>
<div class="line"><span class="lineno">  464</span>  <a class="code hl_variable" href="main_8c.html#a5f90928b96a5400ea15a859630e94260">q_new</a>[3] = delta_q[3] / d;</div>
<div class="line"><span class="lineno">  465</span>}</div>
<div class="ttc" id="aeye_8c_html_a904eb8da59edc08e1a96b3b2ce63bcfc"><div class="ttname"><a href="eye_8c.html#a904eb8da59edc08e1a96b3b2ce63bcfc">b_eye</a></div><div class="ttdeci">void b_eye(double b_I[36])</div><div class="ttdoc">Creates a 6x6 identity matrix.</div><div class="ttdef"><b>Definition</b> <a href="eye_8c_source.html#l00021">eye.c:21</a></div></div>
<div class="ttc" id="aeye_8c_html_af97fcd83250503a8d844da14475156a3"><div class="ttname"><a href="eye_8c.html#af97fcd83250503a8d844da14475156a3">eye</a></div><div class="ttdeci">void eye(double b_I[9])</div><div class="ttdoc">Creates a 3x3 identity matrix.</div><div class="ttdef"><b>Definition</b> <a href="eye_8c_source.html#l00034">eye.c:34</a></div></div>
<div class="ttc" id="amain_8c_html_a1da20c45c931350efcddda0349fccfd4"><div class="ttname"><a href="main_8c.html#a1da20c45c931350efcddda0349fccfd4">b_B</a></div><div class="ttdeci">double b_B[]</div><div class="ttdef"><b>Definition</b> <a href="main_8c_source.html#l00241">main.c:241</a></div></div>
<div class="ttc" id="amain_8c_html_a51ef9e70aeabe7ebad89a2c96f64d127"><div class="ttname"><a href="main_8c.html#a51ef9e70aeabe7ebad89a2c96f64d127">beta</a></div><div class="ttdeci">double beta[]</div><div class="ttdef"><b>Definition</b> <a href="main_8c_source.html#l00238">main.c:238</a></div></div>
<div class="ttc" id="amain_8c_html_a5f90928b96a5400ea15a859630e94260"><div class="ttname"><a href="main_8c.html#a5f90928b96a5400ea15a859630e94260">q_new</a></div><div class="ttdeci">double q_new[]</div><div class="ttdef"><b>Definition</b> <a href="main_8c_source.html#l00243">main.c:243</a></div></div>
<div class="ttc" id="amain_8c_html_a6f4cfa41c70f50ef4b5700aef52e6799"><div class="ttname"><a href="main_8c.html#a6f4cfa41c70f50ef4b5700aef52e6799">omega</a></div><div class="ttdeci">double omega[]</div><div class="ttdef"><b>Definition</b> <a href="main_8c_source.html#l00240">main.c:240</a></div></div>
<div class="ttc" id="amain_8c_html_a8523517a36ba1d96b83ca850602e30fa"><div class="ttname"><a href="main_8c.html#a8523517a36ba1d96b83ca850602e30fa">R</a></div><div class="ttdeci">const double R[]</div><div class="ttdef"><b>Definition</b> <a href="main_8c_source.html#l00253">main.c:253</a></div></div>
<div class="ttc" id="amain_8c_html_a8c58e80126d57fb6e559b59e15f8db19"><div class="ttname"><a href="main_8c.html#a8c58e80126d57fb6e559b59e15f8db19">beta_new</a></div><div class="ttdeci">double beta_new[]</div><div class="ttdef"><b>Definition</b> <a href="main_8c_source.html#l00244">main.c:244</a></div></div>
<div class="ttc" id="amain_8c_html_ab4c3f2083fd1184ce7aa0a233db26e00"><div class="ttname"><a href="main_8c.html#ab4c3f2083fd1184ce7aa0a233db26e00">q</a></div><div class="ttdeci">double q[]</div><div class="ttdef"><b>Definition</b> <a href="main_8c_source.html#l00237">main.c:237</a></div></div>
<div class="ttc" id="amain_8c_html_ad3abb693476fba2ed2c23e63de561f32"><div class="ttname"><a href="main_8c.html#ad3abb693476fba2ed2c23e63de561f32">Q</a></div><div class="ttdeci">const double Q[]</div><div class="ttdef"><b>Definition</b> <a href="main_8c_source.html#l00252">main.c:252</a></div></div>
<div class="ttc" id="amekf_8c_html_aec012aeba63ea4ffcdc8bcede27b6847"><div class="ttname"><a href="mekf_8c.html#aec012aeba63ea4ffcdc8bcede27b6847">rt_powd_snf</a></div><div class="ttdeci">static double rt_powd_snf(double u0, double u1)</div><div class="ttdef"><b>Definition</b> <a href="mekf_8c_source.html#l00030">mekf.c:30</a></div></div>
<div class="ttc" id="amekf_8h_html_af5c155b963dcb491cbe8a3b1daa0c6b1"><div class="ttname"><a href="mekf_8h.html#af5c155b963dcb491cbe8a3b1daa0c6b1">HIGHEST_NUMBER</a></div><div class="ttdeci">#define HIGHEST_NUMBER</div><div class="ttdef"><b>Definition</b> <a href="mekf_8h_source.html#l00034">mekf.h:34</a></div></div>
<div class="ttc" id="ampower_8c_html_a14a99d692fd15c8d9d7f487c6f311ef5"><div class="ttname"><a href="mpower_8c.html#a14a99d692fd15c8d9d7f487c6f311ef5">mpower</a></div><div class="ttdeci">void mpower(const double a[9], double c[9])</div><div class="ttdoc">Calculates the inverse of a 3x3 matrix.</div><div class="ttdef"><b>Definition</b> <a href="mpower_8c_source.html#l00024">mpower.c:24</a></div></div>
<div class="ttc" id="anorm_8c_html_aa2f1f6f0418837c19636fa89d661b2ac"><div class="ttname"><a href="norm_8c.html#aa2f1f6f0418837c19636fa89d661b2ac">b_norm</a></div><div class="ttdeci">double b_norm(const double x[3])</div><div class="ttdoc">Calculates the Euclidean norm (magnitude) of a 3-element vector.</div><div class="ttdef"><b>Definition</b> <a href="norm_8c_source.html#l00021">norm.c:21</a></div></div>
<div class="ttc" id="anorm_8c_html_afe7e9a93950e318570d2bfc4c9dae52a"><div class="ttname"><a href="norm_8c.html#afe7e9a93950e318570d2bfc4c9dae52a">c_norm</a></div><div class="ttdeci">double c_norm(const double x[4])</div><div class="ttdoc">Calculates the Euclidean norm (magnitude) of a 4-element vector.</div><div class="ttdef"><b>Definition</b> <a href="norm_8c_source.html#l00061">norm.c:61</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="main_8c_source.html#l00241">b_B</a>, <a class="el" href="eye_8c_source.html#l00021">b_eye()</a>, <a class="el" href="norm_8c_source.html#l00021">b_norm()</a>, <a class="el" href="main_8c_source.html#l00238">beta</a>, <a class="el" href="main_8c_source.html#l00244">beta_new</a>, <a class="el" href="norm_8c_source.html#l00061">c_norm()</a>, <a class="el" href="eye_8c_source.html#l00034">eye()</a>, <a class="el" href="mekf_8h_source.html#l00034">HIGHEST_NUMBER</a>, <a class="el" href="mpower_8c_source.html#l00024">mpower()</a>, <a class="el" href="main_8c_source.html#l00240">omega</a>, <a class="el" href="main_8c_source.html#l00237">q</a>, <a class="el" href="main_8c_source.html#l00252">Q</a>, <a class="el" href="main_8c_source.html#l00243">q_new</a>, <a class="el" href="main_8c_source.html#l00253">R</a>, and <a class="el" href="mekf_8c_source.html#l00030">rt_powd_snf()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mekf_8h_abe18d5b109f99da1726f89803c17ec26_cgraph.png" border="0" usemap="#amekf_8h_abe18d5b109f99da1726f89803c17ec26_cgraph" alt=""/></div>
<map name="amekf_8h_abe18d5b109f99da1726f89803c17ec26_cgraph" id="amekf_8h_abe18d5b109f99da1726f89803c17ec26_cgraph">
<area shape="rect" title="Executes one prediction and correction step of the MEKF." alt="" coords="5,132,56,159"/>
<area shape="rect" href="eye_8c.html#a904eb8da59edc08e1a96b3b2ce63bcfc" title="Creates a 6x6 identity matrix." alt="" coords="122,5,178,32"/>
<area shape="poly" title=" " alt="" coords="37,130,63,88,102,42,107,38,110,42,106,46,67,91,41,133"/>
<area shape="rect" href="norm_8c.html#aa2f1f6f0418837c19636fa89d661b2ac" title="Calculates the Euclidean norm (magnitude) of a 3&#45;element vector." alt="" coords="118,56,182,83"/>
<area shape="poly" title=" " alt="" coords="49,129,102,92,109,88,112,93,105,97,52,134"/>
<area shape="rect" href="norm_8c.html#afe7e9a93950e318570d2bfc4c9dae52a" title="Calculates the Euclidean norm (magnitude) of a 4&#45;element vector." alt="" coords="118,107,182,133"/>
<area shape="poly" title=" " alt="" coords="55,137,102,127,103,133,57,143"/>
<area shape="rect" href="eye_8c.html#af97fcd83250503a8d844da14475156a3" title="Creates a 3x3 identity matrix." alt="" coords="129,157,171,184"/>
<area shape="poly" title=" " alt="" coords="57,148,114,161,113,166,55,153"/>
<area shape="rect" href="mpower_8c.html#a14a99d692fd15c8d9d7f487c6f311ef5" title="Calculates the inverse of a 3x3 matrix." alt="" coords="116,208,184,235"/>
<area shape="poly" title=" " alt="" coords="52,157,105,194,112,198,109,202,102,198,49,161"/>
<area shape="rect" href="mekf_8c.html#aec012aeba63ea4ffcdc8bcede27b6847" title=" " alt="" coords="104,259,196,285"/>
<area shape="poly" title=" " alt="" coords="41,158,67,199,106,245,109,248,106,252,102,249,63,203,37,161"/>
<area shape="rect" href="group___non_finite___functions.html#ga5cb8bd309556e80b24b7e67a0718a0c5" title="Checks if a double&#45;precision value is positive or negative infinity." alt="" coords="250,233,305,260"/>
<area shape="poly" title=" " alt="" coords="196,260,234,252,235,258,197,265"/>
<area shape="rect" href="group___non_finite___functions.html#ga77a37b8e06f4c4ce363a03fe4099aad8" title="Checks if a double&#45;precision value is Not&#45;a&#45;Number (NaN)." alt="" coords="244,284,311,311"/>
<area shape="poly" title=" " alt="" coords="197,279,229,285,228,290,196,284"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_74665e7a93125a1b96de8fab7d5a3847.html">Davinci_2</a></li><li class="navelem"><a class="el" href="dir_2270421e09f92bb67b3cc59e68204e53.html">Core</a></li><li class="navelem"><a class="el" href="dir_8953985c8f7f8178c476555601a95ec2.html">Inc</a></li><li class="navelem"><a class="el" href="mekf_8h.html">mekf.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
