<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Da Vinci Firmware: Davinci_2/Core/Inc/flight_control.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="PRT-logo-horizontal-dark-resized.png"/></td>
  <td id="projectalign">
   <div id="projectname">Da Vinci Firmware<span id="projectnumber">&#160;1</span>
   </div>
   <div id="projectbrief">Firmware for the DaVinci-M rocket avionics board.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('flight__control_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">flight_control.h File Reference<div class="ingroups"><a class="el" href="group___flight_logic.html">Core Flight Logic</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>Defines the states, events, and data structures for the rocket's main Flight State Machine (FSM).  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="main_8h_source.html">main.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for flight_control.h:</div>
<div class="dyncontent">
<div class="center"><img src="flight__control_8h__incl.png" border="0" usemap="#a_davinci__2_2_core_2_inc_2flight__control_8h" alt=""/></div>
<map name="a_davinci__2_2_core_2_inc_2flight__control_8h" id="a_davinci__2_2_core_2_inc_2flight__control_8h">
<area shape="rect" title="Defines the states, events, and data structures for the rocket&#39;s main Flight State Machine (FSM)." alt="" coords="5,5,139,48"/>
<area shape="rect" href="main_8h.html" title=": Header for main.c file. This file contains the common defines of the application." alt="" coords="42,96,102,123"/>
<area shape="poly" title=" " alt="" coords="75,49,75,80,69,80,69,49"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="flight__control_8h__dep__incl.png" border="0" usemap="#a_davinci__2_2_core_2_inc_2flight__control_8hdep" alt=""/></div>
<map name="a_davinci__2_2_core_2_inc_2flight__control_8hdep" id="a_davinci__2_2_core_2_inc_2flight__control_8hdep">
<area shape="rect" title="Defines the states, events, and data structures for the rocket&#39;s main Flight State Machine (FSM)." alt="" coords="6,5,140,48"/>
<area shape="rect" href="flight__control_8c.html" title=" " alt="" coords="5,96,141,139"/>
<area shape="poly" title=" " alt="" coords="76,64,76,96,70,96,70,64"/>
</map>
</div>
</div>
<p><a href="flight__control_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlinear__acceleration__t.html">linear_acceleration_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Represents a 3-axis linear acceleration vector from an IMU.  <a href="structlinear__acceleration__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structestimation__output__t.html">estimation_output_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Holds the primary outputs of the state estimation filter (e.g., Kalman filter).  <a href="structestimation__output__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structflight__fsm__t.html">flight_fsm_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main data structure for the Flight State Machine.  <a href="structflight__fsm__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="enum-members" name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:ga3dfa0d2746ea8e8cbad6da7259918ab3"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___flight_state.html#ga3dfa0d2746ea8e8cbad6da7259918ab3">flight_phase_t</a> { <br />
&#160;&#160;<a class="el" href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3aef2863a469df3ea6871d640e3669a2f2">INVALID</a>
, <a class="el" href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3a418c789b8bc517c5c1cf05dbfc5c45e0">CALIBRATING</a>
, <a class="el" href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3a78cda93fcedb1dc8abd154cc187e6730">LIFTOFF</a>
, <a class="el" href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3ad790b28b6f6640a2aeb099fdd740566b">BURNING</a>
, <br />
&#160;&#160;<a class="el" href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3a96fa685b0a361f3103c6b0324eb48286">ABCSDEPLOYED</a>
, <a class="el" href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3aadd0dc8e4b9d8ac5e296a6dd14d9d7ba">DROGUE</a>
, <a class="el" href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3a41c6eb506ccf657cc7e958c8e8c769cd">MAIN</a>
, <a class="el" href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3af333eb87dc386553d0043cf3af30a831">TOUCHDOWN</a>
<br />
 }</td></tr>
<tr class="memdesc:ga3dfa0d2746ea8e8cbad6da7259918ab3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enumeration of all possible flight phases (states) in the FSM.  <a href="group___flight_state.html#ga3dfa0d2746ea8e8cbad6da7259918ab3">More...</a><br /></td></tr>
<tr class="separator:ga3dfa0d2746ea8e8cbad6da7259918ab3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a2d929a4793ee883e3e7bdabe0deea72e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="flight__control_8h.html#a2d929a4793ee883e3e7bdabe0deea72e">check_Calibrating_phase</a> (<a class="el" href="structflight__fsm__t.html">flight_fsm_t</a> *fsm_state, <a class="el" href="structestimation__output__t.html">estimation_output_t</a> MotionData, <a class="el" href="structlinear__acceleration__t.html">linear_acceleration_t</a> acc_data)</td></tr>
<tr class="memdesc:a2d929a4793ee883e3e7bdabe0deea72e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handler for the CALIBRATING state.  <br /></td></tr>
<tr class="separator:a2d929a4793ee883e3e7bdabe0deea72e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba82f61bcce6a03c81dae2533ab2431e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="flight__control_8h.html#aba82f61bcce6a03c81dae2533ab2431e">check_Liftoff_phase</a> (<a class="el" href="structflight__fsm__t.html">flight_fsm_t</a> *fsm_state, <a class="el" href="structestimation__output__t.html">estimation_output_t</a> MotionData)</td></tr>
<tr class="memdesc:aba82f61bcce6a03c81dae2533ab2431e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handler for the LIFTOFF state.  <br /></td></tr>
<tr class="separator:aba82f61bcce6a03c81dae2533ab2431e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae80bc3f567e80bf0afa8f58a9fbebb28"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="flight__control_8h.html#ae80bc3f567e80bf0afa8f58a9fbebb28">check_Burning_phase</a> (<a class="el" href="structflight__fsm__t.html">flight_fsm_t</a> *fsm_state, <a class="el" href="structestimation__output__t.html">estimation_output_t</a> MotionData)</td></tr>
<tr class="memdesc:ae80bc3f567e80bf0afa8f58a9fbebb28"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handler for the BURNING state (powered ascent).  <br /></td></tr>
<tr class="separator:ae80bc3f567e80bf0afa8f58a9fbebb28"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5e7abf18b94d350d897d4a41c7e93122"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="flight__control_8h.html#a5e7abf18b94d350d897d4a41c7e93122">check_AbcsDeployed_phase</a> (<a class="el" href="structflight__fsm__t.html">flight_fsm_t</a> *fsm_state, <a class="el" href="structestimation__output__t.html">estimation_output_t</a> MotionData)</td></tr>
<tr class="memdesc:a5e7abf18b94d350d897d4a41c7e93122"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handler for the ABCSDEPLOYED state (apogee control).  <br /></td></tr>
<tr class="separator:a5e7abf18b94d350d897d4a41c7e93122"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2d4fe4bfe6408b0445d7e474c5ea3c6c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="flight__control_8h.html#a2d4fe4bfe6408b0445d7e474c5ea3c6c">check_Drogue_phase</a> (<a class="el" href="structflight__fsm__t.html">flight_fsm_t</a> *fsm_state, <a class="el" href="structestimation__output__t.html">estimation_output_t</a> MotionData)</td></tr>
<tr class="memdesc:a2d4fe4bfe6408b0445d7e474c5ea3c6c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handler for the DROGUE state (descent under drogue parachute).  <br /></td></tr>
<tr class="separator:a2d4fe4bfe6408b0445d7e474c5ea3c6c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1fbe66f19e588fd4bf4a6ed29ddc8a3b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="flight__control_8h.html#a1fbe66f19e588fd4bf4a6ed29ddc8a3b">check_Main_phase</a> (<a class="el" href="structflight__fsm__t.html">flight_fsm_t</a> *fsm_state, <a class="el" href="structestimation__output__t.html">estimation_output_t</a> MotionData)</td></tr>
<tr class="memdesc:a1fbe66f19e588fd4bf4a6ed29ddc8a3b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handler for the MAIN state (descent under main parachute).  <br /></td></tr>
<tr class="separator:a1fbe66f19e588fd4bf4a6ed29ddc8a3b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae3697dd1ba93efbdbcf9d9aee78707cd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="flight__control_8h.html#ae3697dd1ba93efbdbcf9d9aee78707cd">check_Touchdown_phase</a> (<a class="el" href="structflight__fsm__t.html">flight_fsm_t</a> *fsm_state, <a class="el" href="structestimation__output__t.html">estimation_output_t</a> MotionData, <a class="el" href="structlinear__acceleration__t.html">linear_acceleration_t</a> acc_data)</td></tr>
<tr class="memdesc:ae3697dd1ba93efbdbcf9d9aee78707cd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handler for the TOUCHDOWN state.  <br /></td></tr>
<tr class="separator:ae3697dd1ba93efbdbcf9d9aee78707cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a850f84f75bc7d3639826e71dc1ba1367"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="flight__control_8h.html#a850f84f75bc7d3639826e71dc1ba1367">check_flight_phase</a> (<a class="el" href="structflight__fsm__t.html">flight_fsm_t</a> *fsm_state, <a class="el" href="structestimation__output__t.html">estimation_output_t</a> MotionData, <a class="el" href="structlinear__acceleration__t.html">linear_acceleration_t</a> acc_data)</td></tr>
<tr class="memdesc:a850f84f75bc7d3639826e71dc1ba1367"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main FSM router function that delegates to the current state's handler.  <br /></td></tr>
<tr class="separator:a850f84f75bc7d3639826e71dc1ba1367"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af2b0cd6c7eba3eb5f23e859fc0546383"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="flight__control_8h.html#af2b0cd6c7eba3eb5f23e859fc0546383">change_state_to</a> (<a class="el" href="structflight__fsm__t.html">flight_fsm_t</a> *fsm_state, <a class="el" href="group___flight_state.html#ga3dfa0d2746ea8e8cbad6da7259918ab3">flight_phase_t</a> new_state)</td></tr>
<tr class="memdesc:af2b0cd6c7eba3eb5f23e859fc0546383"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles the mechanics of a state transition.  <br /></td></tr>
<tr class="separator:af2b0cd6c7eba3eb5f23e859fc0546383"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Defines the states, events, and data structures for the rocket's main Flight State Machine (FSM). </p>
<dl class="section author"><dt>Author</dt><dd>Francesco Abate, Tommaso Gualtierotti </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2024-04-02</dd></dl>
<p>This header file contains all the definitions necessary for the flight control logic. The FSM is responsible for managing the mission sequence, transitioning the rocket through its various flight phases from pre-launch calibration to post-landing touchdown. </p>

<p class="definition">Definition in file <a class="el" href="flight__control_8h_source.html">flight_control.h</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="af2b0cd6c7eba3eb5f23e859fc0546383" name="af2b0cd6c7eba3eb5f23e859fc0546383"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af2b0cd6c7eba3eb5f23e859fc0546383">&#9670;&#160;</a></span>change_state_to()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void change_state_to </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structflight__fsm__t.html">flight_fsm_t</a> *&#160;</td>
          <td class="paramname"><em>fsm_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group___flight_state.html#ga3dfa0d2746ea8e8cbad6da7259918ab3">flight_phase_t</a>&#160;</td>
          <td class="paramname"><em>new_state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles the mechanics of a state transition. </p>
<p>This utility function updates the FSM's state to the new phase, sets the <code>state_changed</code> flag, and records the transition timestamp. It ensures state changes are handled consistently. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">fsm_state</td><td>Pointer to the FSM state object to be updated. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">new_state</td><td>The new <code>flight_phase_t</code> to transition into. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>None </dd></dl>

<p class="definition">Definition at line <a class="el" href="flight__control_8c_source.html#l00229">229</a> of file <a class="el" href="flight__control_8c_source.html">flight_control.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  229</span>                                                                     {</div>
<div class="line"><span class="lineno">  230</span> </div>
<div class="line"><span class="lineno">  231</span>    phase-&gt;flight_state=new_phase;</div>
<div class="line"><span class="lineno">  232</span>    <a class="code hl_function" href="flight__control_8c.html#a2453e798beaa2b27f6468db201f7861a">clear_fsm_memory</a>(phase);</div>
<div class="line"><span class="lineno">  233</span>}</div>
<div class="ttc" id="aflight__control_8c_html_a2453e798beaa2b27f6468db201f7861a"><div class="ttname"><a href="flight__control_8c.html#a2453e798beaa2b27f6468db201f7861a">clear_fsm_memory</a></div><div class="ttdeci">static void clear_fsm_memory(flight_fsm_t *fsm_state)</div><div class="ttdef"><b>Definition</b> <a href="flight__control_8c_source.html#l00222">flight_control.c:222</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="flight__control_8c_source.html#l00222">clear_fsm_memory()</a>, and <a class="el" href="flight__control_8h_source.html#l00071">flight_fsm_t::flight_state</a>.</p>

<p class="reference">Referenced by <a class="el" href="flight__control_8c_source.html#l00162">check_AbcsDeployed_phase()</a>, <a class="el" href="flight__control_8c_source.html#l00126">check_Burning_phase()</a>, <a class="el" href="flight__control_8c_source.html#l00056">check_Calibrating_phase()</a>, <a class="el" href="flight__control_8c_source.html#l00181">check_Drogue_phase()</a>, <a class="el" href="flight__control_8c_source.html#l00093">check_Liftoff_phase()</a>, and <a class="el" href="flight__control_8c_source.html#l00197">check_Main_phase()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="flight__control_8h_af2b0cd6c7eba3eb5f23e859fc0546383_cgraph.png" border="0" usemap="#aflight__control_8h_af2b0cd6c7eba3eb5f23e859fc0546383_cgraph" alt=""/></div>
<map name="aflight__control_8h_af2b0cd6c7eba3eb5f23e859fc0546383_cgraph" id="aflight__control_8h_af2b0cd6c7eba3eb5f23e859fc0546383_cgraph">
<area shape="rect" title="Handles the mechanics of a state transition." alt="" coords="5,5,123,32"/>
<area shape="rect" href="flight__control_8c.html#a2453e798beaa2b27f6468db201f7861a" title=" " alt="" coords="171,5,303,32"/>
<area shape="poly" title=" " alt="" coords="123,16,155,16,155,21,123,21"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="flight__control_8h_af2b0cd6c7eba3eb5f23e859fc0546383_icgraph.png" border="0" usemap="#aflight__control_8h_af2b0cd6c7eba3eb5f23e859fc0546383_icgraph" alt=""/></div>
<map name="aflight__control_8h_af2b0cd6c7eba3eb5f23e859fc0546383_icgraph" id="aflight__control_8h_af2b0cd6c7eba3eb5f23e859fc0546383_icgraph">
<area shape="rect" title="Handles the mechanics of a state transition." alt="" coords="625,148,742,175"/>
<area shape="rect" href="flight__control_8c.html#a3633e4bb35c5a119ca032439db0d985a" title="Handler for the ABCSDEPLOYED state (apogee control)." alt="" coords="419,5,567,48"/>
<area shape="poly" title=" " alt="" coords="659,138,622,100,575,62,555,51,557,46,578,58,625,96,663,134"/>
<area shape="rect" href="flight__control_8c.html#a2044ea22f9d0a5b3c53b269e4f1be508" title="Handler for the BURNING state (powered ascent)." alt="" coords="418,72,568,99"/>
<area shape="poly" title=" " alt="" coords="642,143,576,113,543,102,545,97,578,108,644,138"/>
<area shape="rect" href="flight__control_8c.html#a2d929a4793ee883e3e7bdabe0deea72e" title="Handler for the CALIBRATING state." alt="" coords="409,123,577,149"/>
<area shape="poly" title=" " alt="" coords="609,154,577,150,578,145,609,149"/>
<area shape="rect" href="flight__control_8c.html#ad67c8fa956febe3c7a883f7fa2b268b0" title="Handler for the DROGUE state (descent under drogue parachute)." alt="" coords="419,173,567,200"/>
<area shape="poly" title=" " alt="" coords="609,174,568,179,567,174,609,169"/>
<area shape="rect" href="flight__control_8c.html#aba82f61bcce6a03c81dae2533ab2431e" title="Handler for the LIFTOFF state." alt="" coords="424,224,562,251"/>
<area shape="poly" title=" " alt="" coords="644,184,578,214,545,226,543,221,576,210,642,180"/>
<area shape="rect" href="flight__control_8c.html#a8116659c0af7f3f1abd980d8013e2654" title="Handler for the MAIN state (descent under main parachute)." alt="" coords="426,275,560,301"/>
<area shape="poly" title=" " alt="" coords="664,189,626,228,578,265,553,276,551,272,575,260,623,224,660,185"/>
<area shape="rect" href="flight__control_8c.html#a47306eb52262845f0284a01226c787ca" title="Main FSM router function that delegates to the current state&#39;s handler." alt="" coords="228,148,361,175"/>
<area shape="poly" title=" " alt="" coords="418,58,411,62,353,107,310,149,307,146,349,103,408,58,416,53"/>
<area shape="rect" href="group___r_t_o_s___tasks.html#ga958596a1a00c9ec7bce777e773465f45" title="Function implementing the FSM thread." alt="" coords="103,148,180,175"/>
<area shape="poly" title=" " alt="" coords="212,164,180,164,180,159,212,159"/>
<area shape="rect" href="main_8c.html#a840291bc02cba5474a4cb46a9b9566fe" title="The application entry point." alt="" coords="5,148,55,175"/>
<area shape="poly" title=" " alt="" coords="87,164,55,164,55,159,87,159"/>
<area shape="poly" title=" " alt="" coords="430,106,410,113,326,150,323,145,408,108,428,101"/>
<area shape="poly" title=" " alt="" coords="394,151,362,155,362,150,393,146"/>
<area shape="poly" title=" " alt="" coords="403,178,361,172,362,167,404,173"/>
<area shape="poly" title=" " alt="" coords="428,221,408,214,323,178,326,173,410,210,430,216"/>
<area shape="poly" title=" " alt="" coords="420,271,408,265,377,244,348,220,306,177,310,173,352,216,380,240,411,260,422,266"/>
</map>
</div>

</div>
</div>
<a id="a5e7abf18b94d350d897d4a41c7e93122" name="a5e7abf18b94d350d897d4a41c7e93122"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5e7abf18b94d350d897d4a41c7e93122">&#9670;&#160;</a></span>check_AbcsDeployed_phase()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void check_AbcsDeployed_phase </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structflight__fsm__t.html">flight_fsm_t</a> *&#160;</td>
          <td class="paramname"><em>fsm_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structestimation__output__t.html">estimation_output_t</a>&#160;</td>
          <td class="paramname"><em>MotionData</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handler for the ABCSDEPLOYED state (apogee control). </p>
<p>Monitors for apogee detection (velocity changing from positive to negative) to trigger drogue parachute deployment. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">fsm_state</td><td>Pointer to the FSM state object. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">MotionData</td><td>Filtered estimation data (altitude, velocity). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="flight__control_8c_source.html#l00162">162</a> of file <a class="el" href="flight__control_8c_source.html">flight_control.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  162</span>                                                                                  {</div>
<div class="line"><span class="lineno">  163</span>    <span class="keywordflow">if</span>(phase-&gt;flight_state &gt; <a class="code hl_enumvalue" href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3a96fa685b0a361f3103c6b0324eb48286">ABCSDEPLOYED</a>) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  164</span> </div>
<div class="line"><span class="lineno">  165</span>    <span class="keywordflow">if</span> (MotionData.<a class="code hl_variable" href="structestimation__output__t.html#abb80b0a1dfae15b7abca1d0bd3c5f5ff">height</a> &lt; <a class="code hl_variable" href="flight__control_8c.html#a89f505952b15d3ead3e15863164ebb9d">previous_altitude</a>) {</div>
<div class="line"><span class="lineno">  166</span>            phase-&gt;memory[0]++;</div>
<div class="line"><span class="lineno">  167</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  168</span>        phase-&gt;memory[0] = 0;</div>
<div class="line"><span class="lineno">  169</span>        <a class="code hl_variable" href="flight__control_8c.html#a89f505952b15d3ead3e15863164ebb9d">previous_altitude</a> = MotionData.<a class="code hl_variable" href="structestimation__output__t.html#abb80b0a1dfae15b7abca1d0bd3c5f5ff">height</a>;</div>
<div class="line"><span class="lineno">  170</span>    }</div>
<div class="line"><span class="lineno">  171</span> </div>
<div class="line"><span class="lineno">  172</span>    <span class="keywordflow">if</span>(phase-&gt;memory[0] &gt; <a class="code hl_define" href="group___f_s_m___safety___counters.html#gaeb43200e79c23d18bc1a291bf10e2361">APOGEE_SAFETY_COUNTER</a>){</div>
<div class="line"><span class="lineno">  173</span>        <a class="code hl_variable" href="group___global___variables.html#ga9f6b9948886b71a18a636cce7acd5e52">drogue</a> = 1;</div>
<div class="line"><span class="lineno">  174</span>        <a class="code hl_variable" href="group___global___variables.html#ga3dd0ab7e3442a6c2767b63b3916f473f">flag_MPC</a> = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  175</span>        <a class="code hl_variable" href="group___global___variables.html#gac214107f44ddc446c55d6c07952198f7">flag_attitude</a> = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  176</span>        <a class="code hl_function" href="flight__control_8c.html#ac501a7c6c60c2b8c9cd9d0e7d328c80c">change_state_to</a>(phase,<a class="code hl_enumvalue" href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3aadd0dc8e4b9d8ac5e296a6dd14d9d7ba">DROGUE</a>);</div>
<div class="line"><span class="lineno">  177</span>    }</div>
<div class="line"><span class="lineno">  178</span>}</div>
<div class="ttc" id="aflight__control_8c_html_a89f505952b15d3ead3e15863164ebb9d"><div class="ttname"><a href="flight__control_8c.html#a89f505952b15d3ead3e15863164ebb9d">previous_altitude</a></div><div class="ttdeci">float_t previous_altitude</div><div class="ttdef"><b>Definition</b> <a href="flight__control_8c_source.html#l00013">flight_control.c:13</a></div></div>
<div class="ttc" id="aflight__control_8c_html_ac501a7c6c60c2b8c9cd9d0e7d328c80c"><div class="ttname"><a href="flight__control_8c.html#ac501a7c6c60c2b8c9cd9d0e7d328c80c">change_state_to</a></div><div class="ttdeci">void change_state_to(flight_fsm_t *phase, flight_phase_t new_phase)</div><div class="ttdoc">Handles the mechanics of a state transition.</div><div class="ttdef"><b>Definition</b> <a href="flight__control_8c_source.html#l00229">flight_control.c:229</a></div></div>
<div class="ttc" id="agroup___f_s_m___safety___counters_html_gaeb43200e79c23d18bc1a291bf10e2361"><div class="ttname"><a href="group___f_s_m___safety___counters.html#gaeb43200e79c23d18bc1a291bf10e2361">APOGEE_SAFETY_COUNTER</a></div><div class="ttdeci">#define APOGEE_SAFETY_COUNTER</div><div class="ttdoc">Cycles for apogee detection (velocity &lt; 0).</div><div class="ttdef"><b>Definition</b> <a href="_f_l_i_g_h_t___p_a_r_a_m_e_t_e_r_s___c_o_n_f_i_g_8h_source.html#l00061">FLIGHT_PARAMETERS_CONFIG.h:61</a></div></div>
<div class="ttc" id="agroup___flight_state_html_gga3dfa0d2746ea8e8cbad6da7259918ab3a96fa685b0a361f3103c6b0324eb48286"><div class="ttname"><a href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3a96fa685b0a361f3103c6b0324eb48286">ABCSDEPLOYED</a></div><div class="ttdeci">@ ABCSDEPLOYED</div><div class="ttdoc">Airbrakes are deployed for apogee control.</div><div class="ttdef"><b>Definition</b> <a href="flight__control_8h_source.html#l00038">flight_control.h:38</a></div></div>
<div class="ttc" id="agroup___flight_state_html_gga3dfa0d2746ea8e8cbad6da7259918ab3aadd0dc8e4b9d8ac5e296a6dd14d9d7ba"><div class="ttname"><a href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3aadd0dc8e4b9d8ac5e296a6dd14d9d7ba">DROGUE</a></div><div class="ttdeci">@ DROGUE</div><div class="ttdoc">Drogue parachute has been deployed.</div><div class="ttdef"><b>Definition</b> <a href="flight__control_8h_source.html#l00039">flight_control.h:39</a></div></div>
<div class="ttc" id="agroup___global___variables_html_ga3dd0ab7e3442a6c2767b63b3916f473f"><div class="ttname"><a href="group___global___variables.html#ga3dd0ab7e3442a6c2767b63b3916f473f">flag_MPC</a></div><div class="ttdeci">bool flag_MPC</div><div class="ttdoc">RTOS event flag to trigger the MPC task.</div><div class="ttdef"><b>Definition</b> <a href="main_8c_source.html#l00303">main.c:303</a></div></div>
<div class="ttc" id="agroup___global___variables_html_ga9f6b9948886b71a18a636cce7acd5e52"><div class="ttname"><a href="group___global___variables.html#ga9f6b9948886b71a18a636cce7acd5e52">drogue</a></div><div class="ttdeci">uint8_t drogue</div><div class="ttdoc">Status flag for the drogue parachute pyro channel.</div><div class="ttdef"><b>Definition</b> <a href="main_8c_source.html#l00229">main.c:229</a></div></div>
<div class="ttc" id="agroup___global___variables_html_gac214107f44ddc446c55d6c07952198f7"><div class="ttname"><a href="group___global___variables.html#gac214107f44ddc446c55d6c07952198f7">flag_attitude</a></div><div class="ttdeci">bool flag_attitude</div><div class="ttdoc">RTOS event flag to trigger the attitude estimation task.</div><div class="ttdef"><b>Definition</b> <a href="main_8c_source.html#l00302">main.c:302</a></div></div>
<div class="ttc" id="astructestimation__output__t_html_abb80b0a1dfae15b7abca1d0bd3c5f5ff"><div class="ttname"><a href="structestimation__output__t.html#abb80b0a1dfae15b7abca1d0bd3c5f5ff">estimation_output_t::height</a></div><div class="ttdeci">float_t height</div><div class="ttdoc">Vertical altitude above ground level in meters (m).</div><div class="ttdef"><b>Definition</b> <a href="flight__control_8h_source.html#l00059">flight_control.h:59</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="flight__control_8h_source.html#l00038">ABCSDEPLOYED</a>, <a class="el" href="_f_l_i_g_h_t___p_a_r_a_m_e_t_e_r_s___c_o_n_f_i_g_8h_source.html#l00061">APOGEE_SAFETY_COUNTER</a>, <a class="el" href="flight__control_8c_source.html#l00229">change_state_to()</a>, <a class="el" href="flight__control_8h_source.html#l00039">DROGUE</a>, <a class="el" href="main_8c_source.html#l00229">drogue</a>, <a class="el" href="main_8c_source.html#l00302">flag_attitude</a>, <a class="el" href="main_8c_source.html#l00303">flag_MPC</a>, <a class="el" href="flight__control_8h_source.html#l00071">flight_fsm_t::flight_state</a>, <a class="el" href="flight__control_8h_source.html#l00059">estimation_output_t::height</a>, <a class="el" href="flight__control_8h_source.html#l00075">flight_fsm_t::memory</a>, and <a class="el" href="flight__control_8c_source.html#l00013">previous_altitude</a>.</p>

<p class="reference">Referenced by <a class="el" href="flight__control_8c_source.html#l00017">check_flight_phase()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="flight__control_8h_a5e7abf18b94d350d897d4a41c7e93122_cgraph.png" border="0" usemap="#aflight__control_8h_a5e7abf18b94d350d897d4a41c7e93122_cgraph" alt=""/></div>
<map name="aflight__control_8h_a5e7abf18b94d350d897d4a41c7e93122_cgraph" id="aflight__control_8h_a5e7abf18b94d350d897d4a41c7e93122_cgraph">
<area shape="rect" title="Handler for the ABCSDEPLOYED state (apogee control)." alt="" coords="5,5,154,48"/>
<area shape="rect" href="flight__control_8c.html#ac501a7c6c60c2b8c9cd9d0e7d328c80c" title="Handles the mechanics of a state transition." alt="" coords="202,13,319,40"/>
<area shape="poly" title=" " alt="" coords="154,24,186,24,186,29,154,29"/>
<area shape="rect" href="flight__control_8c.html#a2453e798beaa2b27f6468db201f7861a" title=" " alt="" coords="367,13,499,40"/>
<area shape="poly" title=" " alt="" coords="319,24,351,24,351,29,319,29"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="flight__control_8h_a5e7abf18b94d350d897d4a41c7e93122_icgraph.png" border="0" usemap="#aflight__control_8h_a5e7abf18b94d350d897d4a41c7e93122_icgraph" alt=""/></div>
<map name="aflight__control_8h_a5e7abf18b94d350d897d4a41c7e93122_icgraph" id="aflight__control_8h_a5e7abf18b94d350d897d4a41c7e93122_icgraph">
<area shape="rect" title="Handler for the ABCSDEPLOYED state (apogee control)." alt="" coords="409,5,558,48"/>
<area shape="rect" href="flight__control_8c.html#a47306eb52262845f0284a01226c787ca" title="Main FSM router function that delegates to the current state&#39;s handler." alt="" coords="228,13,361,40"/>
<area shape="poly" title=" " alt="" coords="394,29,362,29,362,24,394,24"/>
<area shape="rect" href="group___r_t_o_s___tasks.html#ga958596a1a00c9ec7bce777e773465f45" title="Function implementing the FSM thread." alt="" coords="103,13,180,40"/>
<area shape="poly" title=" " alt="" coords="212,29,180,29,180,24,212,24"/>
<area shape="rect" href="main_8c.html#a840291bc02cba5474a4cb46a9b9566fe" title="The application entry point." alt="" coords="5,13,55,40"/>
<area shape="poly" title=" " alt="" coords="87,29,55,29,55,24,87,24"/>
</map>
</div>

</div>
</div>
<a id="ae80bc3f567e80bf0afa8f58a9fbebb28" name="ae80bc3f567e80bf0afa8f58a9fbebb28"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae80bc3f567e80bf0afa8f58a9fbebb28">&#9670;&#160;</a></span>check_Burning_phase()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void check_Burning_phase </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structflight__fsm__t.html">flight_fsm_t</a> *&#160;</td>
          <td class="paramname"><em>fsm_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structestimation__output__t.html">estimation_output_t</a>&#160;</td>
          <td class="paramname"><em>MotionData</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handler for the BURNING state (powered ascent). </p>
<p>Monitors for motor burnout and transitions to the coasting/apogee control phase. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">fsm_state</td><td>Pointer to the FSM state object. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">MotionData</td><td>Filtered estimation data (altitude, velocity). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="flight__control_8c_source.html#l00126">126</a> of file <a class="el" href="flight__control_8c_source.html">flight_control.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  126</span>                                                                              {</div>
<div class="line"><span class="lineno">  127</span>    <span class="comment">// if I&#39;m in a higher state I cannot come back</span></div>
<div class="line"><span class="lineno">  128</span> </div>
<div class="line"><span class="lineno">  129</span>    <span class="keywordflow">if</span>(phase-&gt;flight_state &gt; <a class="code hl_enumvalue" href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3ad790b28b6f6640a2aeb099fdd740566b">BURNING</a>) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  130</span> </div>
<div class="line"><span class="lineno">  131</span>    <span class="keywordflow">if</span> (MotionData.<a class="code hl_variable" href="structestimation__output__t.html#abb80b0a1dfae15b7abca1d0bd3c5f5ff">height</a> &gt; 1000) {</div>
<div class="line"><span class="lineno">  132</span>        phase-&gt;memory[0]++;</div>
<div class="line"><span class="lineno">  133</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  134</span>          phase-&gt;memory[0] = 0;</div>
<div class="line"><span class="lineno">  135</span>      }</div>
<div class="line"><span class="lineno">  136</span> </div>
<div class="line"><span class="lineno">  137</span>    <span class="keywordflow">if</span> (phase-&gt;memory[0] &gt; <a class="code hl_define" href="group___f_s_m___safety___counters.html#gabdb78e2ad123abe28ef8d1eb06c18e4b">COASTING_SAFETY_COUNTER</a>) {</div>
<div class="line"><span class="lineno">  138</span>        <a class="code hl_variable" href="group___global___variables.html#ga3dd0ab7e3442a6c2767b63b3916f473f">flag_MPC</a> = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  139</span>        <a class="code hl_variable" href="group___global___variables.html#gac214107f44ddc446c55d6c07952198f7">flag_attitude</a> = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  140</span>        <a class="code hl_function" href="flight__control_8c.html#ac501a7c6c60c2b8c9cd9d0e7d328c80c">change_state_to</a>(phase, <a class="code hl_enumvalue" href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3a96fa685b0a361f3103c6b0324eb48286">ABCSDEPLOYED</a>);<span class="comment">//ABCSDEPLOYED</span></div>
<div class="line"><span class="lineno">  141</span>    }</div>
<div class="line"><span class="lineno">  142</span> </div>
<div class="line"><span class="lineno">  143</span><span class="comment">//----------------------------------------------------------------------------------------- JUST IN CASE WE HAVE AN UMEXPECTED APOGEE</span></div>
<div class="line"><span class="lineno">  144</span>    <span class="keywordflow">if</span> (MotionData.<a class="code hl_variable" href="structestimation__output__t.html#abb80b0a1dfae15b7abca1d0bd3c5f5ff">height</a> &lt; <a class="code hl_variable" href="flight__control_8c.html#a89f505952b15d3ead3e15863164ebb9d">previous_altitude</a>) {</div>
<div class="line"><span class="lineno">  145</span>        phase-&gt;memory_bis[0]++;</div>
<div class="line"><span class="lineno">  146</span>    } <span class="keywordflow">else</span>{</div>
<div class="line"><span class="lineno">  147</span>        phase-&gt;memory_bis[0] = 0;</div>
<div class="line"><span class="lineno">  148</span>        <a class="code hl_variable" href="flight__control_8c.html#a89f505952b15d3ead3e15863164ebb9d">previous_altitude</a> = MotionData.<a class="code hl_variable" href="structestimation__output__t.html#abb80b0a1dfae15b7abca1d0bd3c5f5ff">height</a>;</div>
<div class="line"><span class="lineno">  149</span>    }</div>
<div class="line"><span class="lineno">  150</span> </div>
<div class="line"><span class="lineno">  151</span>    <span class="keywordflow">if</span>(phase-&gt;memory_bis[0] &gt; <a class="code hl_define" href="group___f_s_m___safety___counters.html#gaeb43200e79c23d18bc1a291bf10e2361">APOGEE_SAFETY_COUNTER</a>){</div>
<div class="line"><span class="lineno">  152</span>        <a class="code hl_variable" href="group___global___variables.html#ga9f6b9948886b71a18a636cce7acd5e52">drogue</a> = 1;</div>
<div class="line"><span class="lineno">  153</span>        <a class="code hl_variable" href="group___global___variables.html#ga3dd0ab7e3442a6c2767b63b3916f473f">flag_MPC</a> = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  154</span>        <a class="code hl_variable" href="group___global___variables.html#gac214107f44ddc446c55d6c07952198f7">flag_attitude</a> = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  155</span>        <a class="code hl_function" href="flight__control_8c.html#ac501a7c6c60c2b8c9cd9d0e7d328c80c">change_state_to</a>(phase,<a class="code hl_enumvalue" href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3aadd0dc8e4b9d8ac5e296a6dd14d9d7ba">DROGUE</a>);</div>
<div class="line"><span class="lineno">  156</span>    }</div>
<div class="line"><span class="lineno">  157</span><span class="comment">//--------------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="lineno">  158</span> </div>
<div class="line"><span class="lineno">  159</span> </div>
<div class="line"><span class="lineno">  160</span>}</div>
<div class="ttc" id="agroup___f_s_m___safety___counters_html_gabdb78e2ad123abe28ef8d1eb06c18e4b"><div class="ttname"><a href="group___f_s_m___safety___counters.html#gabdb78e2ad123abe28ef8d1eb06c18e4b">COASTING_SAFETY_COUNTER</a></div><div class="ttdeci">#define COASTING_SAFETY_COUNTER</div><div class="ttdoc">Cycles for burnout detection.</div><div class="ttdef"><b>Definition</b> <a href="_f_l_i_g_h_t___p_a_r_a_m_e_t_e_r_s___c_o_n_f_i_g_8h_source.html#l00060">FLIGHT_PARAMETERS_CONFIG.h:60</a></div></div>
<div class="ttc" id="agroup___flight_state_html_gga3dfa0d2746ea8e8cbad6da7259918ab3ad790b28b6f6640a2aeb099fdd740566b"><div class="ttname"><a href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3ad790b28b6f6640a2aeb099fdd740566b">BURNING</a></div><div class="ttdeci">@ BURNING</div><div class="ttdoc">Engine is burning; under powered ascent.</div><div class="ttdef"><b>Definition</b> <a href="flight__control_8h_source.html#l00037">flight_control.h:37</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="flight__control_8h_source.html#l00038">ABCSDEPLOYED</a>, <a class="el" href="_f_l_i_g_h_t___p_a_r_a_m_e_t_e_r_s___c_o_n_f_i_g_8h_source.html#l00061">APOGEE_SAFETY_COUNTER</a>, <a class="el" href="flight__control_8h_source.html#l00037">BURNING</a>, <a class="el" href="flight__control_8c_source.html#l00229">change_state_to()</a>, <a class="el" href="_f_l_i_g_h_t___p_a_r_a_m_e_t_e_r_s___c_o_n_f_i_g_8h_source.html#l00060">COASTING_SAFETY_COUNTER</a>, <a class="el" href="flight__control_8h_source.html#l00039">DROGUE</a>, <a class="el" href="main_8c_source.html#l00229">drogue</a>, <a class="el" href="main_8c_source.html#l00302">flag_attitude</a>, <a class="el" href="main_8c_source.html#l00303">flag_MPC</a>, <a class="el" href="flight__control_8h_source.html#l00071">flight_fsm_t::flight_state</a>, <a class="el" href="flight__control_8h_source.html#l00059">estimation_output_t::height</a>, <a class="el" href="flight__control_8h_source.html#l00075">flight_fsm_t::memory</a>, <a class="el" href="flight__control_8h_source.html#l00076">flight_fsm_t::memory_bis</a>, and <a class="el" href="flight__control_8c_source.html#l00013">previous_altitude</a>.</p>

<p class="reference">Referenced by <a class="el" href="flight__control_8c_source.html#l00017">check_flight_phase()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="flight__control_8h_ae80bc3f567e80bf0afa8f58a9fbebb28_cgraph.png" border="0" usemap="#aflight__control_8h_ae80bc3f567e80bf0afa8f58a9fbebb28_cgraph" alt=""/></div>
<map name="aflight__control_8h_ae80bc3f567e80bf0afa8f58a9fbebb28_cgraph" id="aflight__control_8h_ae80bc3f567e80bf0afa8f58a9fbebb28_cgraph">
<area shape="rect" title="Handler for the BURNING state (powered ascent)." alt="" coords="5,5,155,32"/>
<area shape="rect" href="flight__control_8c.html#ac501a7c6c60c2b8c9cd9d0e7d328c80c" title="Handles the mechanics of a state transition." alt="" coords="203,5,320,32"/>
<area shape="poly" title=" " alt="" coords="155,16,187,16,187,21,155,21"/>
<area shape="rect" href="flight__control_8c.html#a2453e798beaa2b27f6468db201f7861a" title=" " alt="" coords="368,5,500,32"/>
<area shape="poly" title=" " alt="" coords="320,16,352,16,352,21,320,21"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="flight__control_8h_ae80bc3f567e80bf0afa8f58a9fbebb28_icgraph.png" border="0" usemap="#aflight__control_8h_ae80bc3f567e80bf0afa8f58a9fbebb28_icgraph" alt=""/></div>
<map name="aflight__control_8h_ae80bc3f567e80bf0afa8f58a9fbebb28_icgraph" id="aflight__control_8h_ae80bc3f567e80bf0afa8f58a9fbebb28_icgraph">
<area shape="rect" title="Handler for the BURNING state (powered ascent)." alt="" coords="409,5,559,32"/>
<area shape="rect" href="flight__control_8c.html#a47306eb52262845f0284a01226c787ca" title="Main FSM router function that delegates to the current state&#39;s handler." alt="" coords="228,5,361,32"/>
<area shape="poly" title=" " alt="" coords="394,21,362,21,362,16,394,16"/>
<area shape="rect" href="group___r_t_o_s___tasks.html#ga958596a1a00c9ec7bce777e773465f45" title="Function implementing the FSM thread." alt="" coords="103,5,180,32"/>
<area shape="poly" title=" " alt="" coords="212,21,180,21,180,16,212,16"/>
<area shape="rect" href="main_8c.html#a840291bc02cba5474a4cb46a9b9566fe" title="The application entry point." alt="" coords="5,5,55,32"/>
<area shape="poly" title=" " alt="" coords="87,21,55,21,55,16,87,16"/>
</map>
</div>

</div>
</div>
<a id="a2d929a4793ee883e3e7bdabe0deea72e" name="a2d929a4793ee883e3e7bdabe0deea72e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2d929a4793ee883e3e7bdabe0deea72e">&#9670;&#160;</a></span>check_Calibrating_phase()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void check_Calibrating_phase </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structflight__fsm__t.html">flight_fsm_t</a> *&#160;</td>
          <td class="paramname"><em>fsm_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structestimation__output__t.html">estimation_output_t</a>&#160;</td>
          <td class="paramname"><em>MotionData</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structlinear__acceleration__t.html">linear_acceleration_t</a>&#160;</td>
          <td class="paramname"><em>acc_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handler for the CALIBRATING state. </p>
<p>Monitors for a sustained high vertical acceleration that indicates liftoff. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">fsm_state</td><td>Pointer to the FSM state object. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">MotionData</td><td>Filtered estimation data (altitude, velocity). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">acc_data</td><td>Raw linear acceleration data from the IMU. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="flight__control_8c_source.html#l00056">56</a> of file <a class="el" href="flight__control_8c_source.html">flight_control.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   56</span>                                                                                                                   {</div>
<div class="line"><span class="lineno">   57</span>    <span class="keywordflow">if</span>(fsm_state-&gt;<a class="code hl_variable" href="structflight__fsm__t.html#aa261111fbfd39bc2e3e292c60b467dda">flight_state</a> &gt; <a class="code hl_enumvalue" href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3a418c789b8bc517c5c1cf05dbfc5c45e0">CALIBRATING</a>) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">   58</span> </div>
<div class="line"><span class="lineno">   59</span>    <span class="keywordflow">if</span> (acc_data.<a class="code hl_variable" href="structlinear__acceleration__t.html#a4f5de47239c8474ecb6c1f8ec40ebdb4">accX</a>&gt;<a class="code hl_define" href="group___f_s_m___safety___counters.html#ga0766d373ce70b6722fd1c6d2728049de">LIFTOFF_TRESHOLD_ACC</a>) {</div>
<div class="line"><span class="lineno">   60</span> </div>
<div class="line"><span class="lineno">   61</span>            fsm_state-&gt;<a class="code hl_variable" href="structflight__fsm__t.html#a8d9181f808299123359ef27cc52d8641">memory</a>[0]++;</div>
<div class="line"><span class="lineno">   62</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">   63</span> </div>
<div class="line"><span class="lineno">   64</span>            fsm_state-&gt;<a class="code hl_variable" href="structflight__fsm__t.html#a8d9181f808299123359ef27cc52d8641">memory</a>[0] = 0;</div>
<div class="line"><span class="lineno">   65</span>        }</div>
<div class="line"><span class="lineno">   66</span> </div>
<div class="line"><span class="lineno">   67</span>    <span class="keywordflow">if</span>(fsm_state-&gt;<a class="code hl_variable" href="structflight__fsm__t.html#a8d9181f808299123359ef27cc52d8641">memory</a>[0] &gt; <a class="code hl_define" href="group___f_s_m___safety___counters.html#ga3d12cdc6f4ce3c994c0fd2c4f3cf6cfe">AIRBRAKES_SAFETY_COUNTER</a>) {</div>
<div class="line"><span class="lineno">   68</span> </div>
<div class="line"><span class="lineno">   69</span>            float_t flag = 1.0;</div>
<div class="line"><span class="lineno">   70</span>            <a class="code hl_function" href="group___winbond___memory.html#gad6301bd88db8e497c5382bda891bac6f">QFlash_Write</a>(0, (uint8_t*)&amp;flag, 4);</div>
<div class="line"><span class="lineno">   71</span>            <a class="code hl_variable" href="group___global___variables.html#ga9944ecd09a3da3fa55c8c1846ba56f6d">flag_flash</a> = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">   72</span>            <a class="code hl_variable" href="group___global___variables.html#gac214107f44ddc446c55d6c07952198f7">flag_attitude</a> = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">   73</span>            <a class="code hl_function" href="flight__control_8c.html#ac501a7c6c60c2b8c9cd9d0e7d328c80c">change_state_to</a>(fsm_state, <a class="code hl_enumvalue" href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3a78cda93fcedb1dc8abd154cc187e6730">LIFTOFF</a>);</div>
<div class="line"><span class="lineno">   74</span>        }</div>
<div class="line"><span class="lineno">   75</span><span class="comment">//----------------------------------------------------------------------------------------- JUST IN CASE WE HAVE AN UMEXPECTED APOGEE</span></div>
<div class="line"><span class="lineno">   76</span>    <span class="keywordflow">if</span> (MotionData.<a class="code hl_variable" href="structestimation__output__t.html#abb80b0a1dfae15b7abca1d0bd3c5f5ff">height</a> &gt; 20) {</div>
<div class="line"><span class="lineno">   77</span>        fsm_state-&gt;<a class="code hl_variable" href="structflight__fsm__t.html#a7149ffc1d309dbafbe2b809f4397e754">memory_bis</a>[0]++;</div>
<div class="line"><span class="lineno">   78</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">   79</span>        fsm_state-&gt;<a class="code hl_variable" href="structflight__fsm__t.html#a7149ffc1d309dbafbe2b809f4397e754">memory_bis</a>[0] = 0;</div>
<div class="line"><span class="lineno">   80</span>    }</div>
<div class="line"><span class="lineno">   81</span> </div>
<div class="line"><span class="lineno">   82</span>    <span class="keywordflow">if</span>(fsm_state-&gt;<a class="code hl_variable" href="structflight__fsm__t.html#a7149ffc1d309dbafbe2b809f4397e754">memory_bis</a>[0] &gt; <a class="code hl_define" href="group___f_s_m___safety___counters.html#gad74e691358994087450de2407fac6306">LIFTOFF_SAFETY_COUNTER</a>){</div>
<div class="line"><span class="lineno">   83</span>        float_t flag = 1.0;</div>
<div class="line"><span class="lineno">   84</span>        <a class="code hl_function" href="group___winbond___memory.html#gad6301bd88db8e497c5382bda891bac6f">QFlash_Write</a>(0, (uint8_t*)&amp;flag, 4);</div>
<div class="line"><span class="lineno">   85</span>        <a class="code hl_variable" href="group___global___variables.html#ga9944ecd09a3da3fa55c8c1846ba56f6d">flag_flash</a> = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">   86</span>        <a class="code hl_variable" href="group___global___variables.html#gac214107f44ddc446c55d6c07952198f7">flag_attitude</a> = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">   87</span>        <a class="code hl_function" href="flight__control_8c.html#ac501a7c6c60c2b8c9cd9d0e7d328c80c">change_state_to</a>(fsm_state,<a class="code hl_enumvalue" href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3a78cda93fcedb1dc8abd154cc187e6730">LIFTOFF</a>);</div>
<div class="line"><span class="lineno">   88</span>    }</div>
<div class="line"><span class="lineno">   89</span><span class="comment">//--------------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="lineno">   90</span> </div>
<div class="line"><span class="lineno">   91</span>}</div>
<div class="ttc" id="agroup___f_s_m___safety___counters_html_ga0766d373ce70b6722fd1c6d2728049de"><div class="ttname"><a href="group___f_s_m___safety___counters.html#ga0766d373ce70b6722fd1c6d2728049de">LIFTOFF_TRESHOLD_ACC</a></div><div class="ttdeci">#define LIFTOFF_TRESHOLD_ACC</div><div class="ttdoc">Raw accelerometer reading threshold for liftoff detection.</div><div class="ttdef"><b>Definition</b> <a href="_f_l_i_g_h_t___p_a_r_a_m_e_t_e_r_s___c_o_n_f_i_g_8h_source.html#l00059">FLIGHT_PARAMETERS_CONFIG.h:59</a></div></div>
<div class="ttc" id="agroup___f_s_m___safety___counters_html_ga3d12cdc6f4ce3c994c0fd2c4f3cf6cfe"><div class="ttname"><a href="group___f_s_m___safety___counters.html#ga3d12cdc6f4ce3c994c0fd2c4f3cf6cfe">AIRBRAKES_SAFETY_COUNTER</a></div><div class="ttdeci">#define AIRBRAKES_SAFETY_COUNTER</div><div class="ttdoc">Safety counter related to airbrake deployment logic.</div><div class="ttdef"><b>Definition</b> <a href="_f_l_i_g_h_t___p_a_r_a_m_e_t_e_r_s___c_o_n_f_i_g_8h_source.html#l00064">FLIGHT_PARAMETERS_CONFIG.h:64</a></div></div>
<div class="ttc" id="agroup___f_s_m___safety___counters_html_gad74e691358994087450de2407fac6306"><div class="ttname"><a href="group___f_s_m___safety___counters.html#gad74e691358994087450de2407fac6306">LIFTOFF_SAFETY_COUNTER</a></div><div class="ttdeci">#define LIFTOFF_SAFETY_COUNTER</div><div class="ttdoc">Cycles for liftoff logic.</div><div class="ttdef"><b>Definition</b> <a href="_f_l_i_g_h_t___p_a_r_a_m_e_t_e_r_s___c_o_n_f_i_g_8h_source.html#l00066">FLIGHT_PARAMETERS_CONFIG.h:66</a></div></div>
<div class="ttc" id="agroup___flight_state_html_gga3dfa0d2746ea8e8cbad6da7259918ab3a418c789b8bc517c5c1cf05dbfc5c45e0"><div class="ttname"><a href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3a418c789b8bc517c5c1cf05dbfc5c45e0">CALIBRATING</a></div><div class="ttdeci">@ CALIBRATING</div><div class="ttdoc">On the launchpad, calibrating sensors.</div><div class="ttdef"><b>Definition</b> <a href="flight__control_8h_source.html#l00035">flight_control.h:35</a></div></div>
<div class="ttc" id="agroup___flight_state_html_gga3dfa0d2746ea8e8cbad6da7259918ab3a78cda93fcedb1dc8abd154cc187e6730"><div class="ttname"><a href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3a78cda93fcedb1dc8abd154cc187e6730">LIFTOFF</a></div><div class="ttdeci">@ LIFTOFF</div><div class="ttdoc">Rocket has cleared the launch rail.</div><div class="ttdef"><b>Definition</b> <a href="flight__control_8h_source.html#l00036">flight_control.h:36</a></div></div>
<div class="ttc" id="agroup___global___variables_html_ga9944ecd09a3da3fa55c8c1846ba56f6d"><div class="ttname"><a href="group___global___variables.html#ga9944ecd09a3da3fa55c8c1846ba56f6d">flag_flash</a></div><div class="ttdeci">bool flag_flash</div><div class="ttdoc">RTOS event flag to trigger the data logging task.</div><div class="ttdef"><b>Definition</b> <a href="main_8c_source.html#l00307">main.c:307</a></div></div>
<div class="ttc" id="agroup___winbond___memory_html_gad6301bd88db8e497c5382bda891bac6f"><div class="ttname"><a href="group___winbond___memory.html#gad6301bd88db8e497c5382bda891bac6f">QFlash_Write</a></div><div class="ttdeci">HAL_StatusTypeDef QFlash_Write(uint32_t addr, uint8_t *data, uint32_t dataSize)</div><div class="ttdef"><b>Definition</b> <a href="z__qflash___w25_q_x_x_x_8c_source.html#l00875">z_qflash_W25QXXX.c:875</a></div></div>
<div class="ttc" id="astructflight__fsm__t_html_a7149ffc1d309dbafbe2b809f4397e754"><div class="ttname"><a href="structflight__fsm__t.html#a7149ffc1d309dbafbe2b809f4397e754">flight_fsm_t::memory_bis</a></div><div class="ttdeci">uint32_t memory_bis[3]</div><div class="ttdoc">Additional general-purpose memory.</div><div class="ttdef"><b>Definition</b> <a href="flight__control_8h_source.html#l00076">flight_control.h:76</a></div></div>
<div class="ttc" id="astructflight__fsm__t_html_a8d9181f808299123359ef27cc52d8641"><div class="ttname"><a href="structflight__fsm__t.html#a8d9181f808299123359ef27cc52d8641">flight_fsm_t::memory</a></div><div class="ttdeci">uint32_t memory[3]</div><div class="ttdoc">General-purpose memory for state-specific logic.</div><div class="ttdef"><b>Definition</b> <a href="flight__control_8h_source.html#l00075">flight_control.h:75</a></div></div>
<div class="ttc" id="astructflight__fsm__t_html_aa261111fbfd39bc2e3e292c60b467dda"><div class="ttname"><a href="structflight__fsm__t.html#aa261111fbfd39bc2e3e292c60b467dda">flight_fsm_t::flight_state</a></div><div class="ttdeci">flight_phase_t flight_state</div><div class="ttdoc">The current state of the FSM.</div><div class="ttdef"><b>Definition</b> <a href="flight__control_8h_source.html#l00071">flight_control.h:71</a></div></div>
<div class="ttc" id="astructlinear__acceleration__t_html_a4f5de47239c8474ecb6c1f8ec40ebdb4"><div class="ttname"><a href="structlinear__acceleration__t.html#a4f5de47239c8474ecb6c1f8ec40ebdb4">linear_acceleration_t::accX</a></div><div class="ttdeci">float_t accX</div><div class="ttdoc">Acceleration along the X-axis in m/s^2.</div><div class="ttdef"><b>Definition</b> <a href="flight__control_8h_source.html#l00049">flight_control.h:49</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="flight__control_8h_source.html#l00049">linear_acceleration_t::accX</a>, <a class="el" href="_f_l_i_g_h_t___p_a_r_a_m_e_t_e_r_s___c_o_n_f_i_g_8h_source.html#l00064">AIRBRAKES_SAFETY_COUNTER</a>, <a class="el" href="flight__control_8h_source.html#l00035">CALIBRATING</a>, <a class="el" href="flight__control_8c_source.html#l00229">change_state_to()</a>, <a class="el" href="main_8c_source.html#l00302">flag_attitude</a>, <a class="el" href="main_8c_source.html#l00307">flag_flash</a>, <a class="el" href="flight__control_8h_source.html#l00071">flight_fsm_t::flight_state</a>, <a class="el" href="flight__control_8h_source.html#l00059">estimation_output_t::height</a>, <a class="el" href="flight__control_8h_source.html#l00036">LIFTOFF</a>, <a class="el" href="_f_l_i_g_h_t___p_a_r_a_m_e_t_e_r_s___c_o_n_f_i_g_8h_source.html#l00066">LIFTOFF_SAFETY_COUNTER</a>, <a class="el" href="_f_l_i_g_h_t___p_a_r_a_m_e_t_e_r_s___c_o_n_f_i_g_8h_source.html#l00059">LIFTOFF_TRESHOLD_ACC</a>, <a class="el" href="flight__control_8h_source.html#l00075">flight_fsm_t::memory</a>, <a class="el" href="flight__control_8h_source.html#l00076">flight_fsm_t::memory_bis</a>, and <a class="el" href="z__qflash___w25_q_x_x_x_8c_source.html#l00875">QFlash_Write()</a>.</p>

<p class="reference">Referenced by <a class="el" href="flight__control_8c_source.html#l00017">check_flight_phase()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="flight__control_8h_a2d929a4793ee883e3e7bdabe0deea72e_cgraph.png" border="0" usemap="#aflight__control_8h_a2d929a4793ee883e3e7bdabe0deea72e_cgraph" alt=""/></div>
<map name="aflight__control_8h_a2d929a4793ee883e3e7bdabe0deea72e_cgraph" id="aflight__control_8h_a2d929a4793ee883e3e7bdabe0deea72e_cgraph">
<area shape="rect" title="Handler for the CALIBRATING state." alt="" coords="5,56,173,83"/>
<area shape="rect" href="flight__control_8c.html#ac501a7c6c60c2b8c9cd9d0e7d328c80c" title="Handles the mechanics of a state transition." alt="" coords="221,19,338,45"/>
<area shape="poly" title=" " alt="" coords="160,53,205,44,206,49,161,58"/>
<area shape="rect" href="group___winbond___memory.html#gad6301bd88db8e497c5382bda891bac6f" title=" " alt="" coords="229,81,330,108"/>
<area shape="poly" title=" " alt="" coords="174,78,214,83,214,89,173,83"/>
<area shape="rect" href="flight__control_8c.html#a2453e798beaa2b27f6468db201f7861a" title=" " alt="" coords="426,5,558,32"/>
<area shape="poly" title=" " alt="" coords="338,26,409,21,410,26,339,31"/>
<area shape="rect" href="group___winbond___control.html#gaefb0b18c1b05043f2ce91b1be9be11be" title=" " alt="" coords="386,56,597,83"/>
<area shape="poly" title=" " alt="" coords="330,86,370,81,371,86,330,91"/>
<area shape="rect" href="z__qflash___w25_q_x_x_x_8c.html#afb89e02b295e274a464decd984e2f0c5" title=" " alt="" coords="404,107,579,133"/>
<area shape="poly" title=" " alt="" coords="330,98,389,105,388,110,330,103"/>
<area shape="rect" href="group___winbond___status.html#gaf93b34eaf38e118fc173c4c0d5abe5f7" title="enables writes" alt="" coords="422,157,562,184"/>
<area shape="poly" title=" " alt="" coords="307,106,387,143,410,150,409,155,385,148,304,111"/>
<area shape="rect" href="group___winbond___status.html#gaa0c97f126a0945f1a2cdbaa2258a0d73" title=" " alt="" coords="645,107,786,133"/>
<area shape="poly" title=" " alt="" coords="555,81,639,100,638,105,553,86"/>
<area shape="poly" title=" " alt="" coords="580,117,629,117,629,123,580,123"/>
<area shape="poly" title=" " alt="" coords="553,154,638,135,639,140,555,159"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="flight__control_8h_a2d929a4793ee883e3e7bdabe0deea72e_icgraph.png" border="0" usemap="#aflight__control_8h_a2d929a4793ee883e3e7bdabe0deea72e_icgraph" alt=""/></div>
<map name="aflight__control_8h_a2d929a4793ee883e3e7bdabe0deea72e_icgraph" id="aflight__control_8h_a2d929a4793ee883e3e7bdabe0deea72e_icgraph">
<area shape="rect" title="Handler for the CALIBRATING state." alt="" coords="409,5,577,32"/>
<area shape="rect" href="flight__control_8c.html#a47306eb52262845f0284a01226c787ca" title="Main FSM router function that delegates to the current state&#39;s handler." alt="" coords="228,5,361,32"/>
<area shape="poly" title=" " alt="" coords="394,21,362,21,362,16,394,16"/>
<area shape="rect" href="group___r_t_o_s___tasks.html#ga958596a1a00c9ec7bce777e773465f45" title="Function implementing the FSM thread." alt="" coords="103,5,180,32"/>
<area shape="poly" title=" " alt="" coords="212,21,180,21,180,16,212,16"/>
<area shape="rect" href="main_8c.html#a840291bc02cba5474a4cb46a9b9566fe" title="The application entry point." alt="" coords="5,5,55,32"/>
<area shape="poly" title=" " alt="" coords="87,21,55,21,55,16,87,16"/>
</map>
</div>

</div>
</div>
<a id="a2d4fe4bfe6408b0445d7e474c5ea3c6c" name="a2d4fe4bfe6408b0445d7e474c5ea3c6c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2d4fe4bfe6408b0445d7e474c5ea3c6c">&#9670;&#160;</a></span>check_Drogue_phase()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void check_Drogue_phase </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structflight__fsm__t.html">flight_fsm_t</a> *&#160;</td>
          <td class="paramname"><em>fsm_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structestimation__output__t.html">estimation_output_t</a>&#160;</td>
          <td class="paramname"><em>MotionData</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handler for the DROGUE state (descent under drogue parachute). </p>
<p>Monitors altitude to trigger main parachute deployment at a predefined height. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">fsm_state</td><td>Pointer to the FSM state object. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">MotionData</td><td>Filtered estimation data (altitude, velocity). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="flight__control_8c_source.html#l00181">181</a> of file <a class="el" href="flight__control_8c_source.html">flight_control.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  181</span>                                                                             {</div>
<div class="line"><span class="lineno">  182</span>    <span class="comment">// if I&#39;m in a higher state I cannot come back</span></div>
<div class="line"><span class="lineno">  183</span>    <span class="keywordflow">if</span>(phase-&gt;flight_state &gt; <a class="code hl_enumvalue" href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3aadd0dc8e4b9d8ac5e296a6dd14d9d7ba">DROGUE</a>) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  184</span> </div>
<div class="line"><span class="lineno">  185</span>    <span class="keywordflow">if</span>(MotionData.<a class="code hl_variable" href="structestimation__output__t.html#abb80b0a1dfae15b7abca1d0bd3c5f5ff">height</a> &lt; <a class="code hl_define" href="group___f_s_m___thresholds.html#gad9b805c1aaf65198aabfc2839e854f52">MAIN_DEPLOY_HEIGHT</a>) {</div>
<div class="line"><span class="lineno">  186</span>        phase-&gt;memory[0]++;</div>
<div class="line"><span class="lineno">  187</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  188</span>        phase-&gt;memory[0] = 0;</div>
<div class="line"><span class="lineno">  189</span>    }</div>
<div class="line"><span class="lineno">  190</span> </div>
<div class="line"><span class="lineno">  191</span>    <span class="keywordflow">if</span>(phase-&gt;memory[0] &gt; <a class="code hl_define" href="group___f_s_m___safety___counters.html#ga2e3eec426bbd58c81b56833681837b61">MAIN_SAFETY_COUNTER</a>) {</div>
<div class="line"><span class="lineno">  192</span>        <a class="code hl_variable" href="group___global___variables.html#gaf20e0da8d1d2d642fcd2c1b869394bcf">mainp</a> = 1;</div>
<div class="line"><span class="lineno">  193</span>        <a class="code hl_function" href="flight__control_8c.html#ac501a7c6c60c2b8c9cd9d0e7d328c80c">change_state_to</a>(phase, <a class="code hl_enumvalue" href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3a41c6eb506ccf657cc7e958c8e8c769cd">MAIN</a>);</div>
<div class="line"><span class="lineno">  194</span>    }</div>
<div class="line"><span class="lineno">  195</span>}</div>
<div class="ttc" id="agroup___f_s_m___safety___counters_html_ga2e3eec426bbd58c81b56833681837b61"><div class="ttname"><a href="group___f_s_m___safety___counters.html#ga2e3eec426bbd58c81b56833681837b61">MAIN_SAFETY_COUNTER</a></div><div class="ttdeci">#define MAIN_SAFETY_COUNTER</div><div class="ttdoc">Cycles for main parachute deployment altitude check.</div><div class="ttdef"><b>Definition</b> <a href="_f_l_i_g_h_t___p_a_r_a_m_e_t_e_r_s___c_o_n_f_i_g_8h_source.html#l00062">FLIGHT_PARAMETERS_CONFIG.h:62</a></div></div>
<div class="ttc" id="agroup___f_s_m___thresholds_html_gad9b805c1aaf65198aabfc2839e854f52"><div class="ttname"><a href="group___f_s_m___thresholds.html#gad9b805c1aaf65198aabfc2839e854f52">MAIN_DEPLOY_HEIGHT</a></div><div class="ttdeci">#define MAIN_DEPLOY_HEIGHT</div><div class="ttdoc">Altitude in meters (m) for main parachute deployment.</div><div class="ttdef"><b>Definition</b> <a href="_f_l_i_g_h_t___p_a_r_a_m_e_t_e_r_s___c_o_n_f_i_g_8h_source.html#l00050">FLIGHT_PARAMETERS_CONFIG.h:50</a></div></div>
<div class="ttc" id="agroup___flight_state_html_gga3dfa0d2746ea8e8cbad6da7259918ab3a41c6eb506ccf657cc7e958c8e8c769cd"><div class="ttname"><a href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3a41c6eb506ccf657cc7e958c8e8c769cd">MAIN</a></div><div class="ttdeci">@ MAIN</div><div class="ttdoc">Main parachute has been deployed.</div><div class="ttdef"><b>Definition</b> <a href="flight__control_8h_source.html#l00040">flight_control.h:40</a></div></div>
<div class="ttc" id="agroup___global___variables_html_gaf20e0da8d1d2d642fcd2c1b869394bcf"><div class="ttname"><a href="group___global___variables.html#gaf20e0da8d1d2d642fcd2c1b869394bcf">mainp</a></div><div class="ttdeci">uint8_t mainp</div><div class="ttdoc">Status flag for the main parachute pyro channel.</div><div class="ttdef"><b>Definition</b> <a href="main_8c_source.html#l00230">main.c:230</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="flight__control_8c_source.html#l00229">change_state_to()</a>, <a class="el" href="flight__control_8h_source.html#l00039">DROGUE</a>, <a class="el" href="flight__control_8h_source.html#l00071">flight_fsm_t::flight_state</a>, <a class="el" href="flight__control_8h_source.html#l00059">estimation_output_t::height</a>, <a class="el" href="flight__control_8h_source.html#l00040">MAIN</a>, <a class="el" href="_f_l_i_g_h_t___p_a_r_a_m_e_t_e_r_s___c_o_n_f_i_g_8h_source.html#l00050">MAIN_DEPLOY_HEIGHT</a>, <a class="el" href="_f_l_i_g_h_t___p_a_r_a_m_e_t_e_r_s___c_o_n_f_i_g_8h_source.html#l00062">MAIN_SAFETY_COUNTER</a>, <a class="el" href="main_8c_source.html#l00230">mainp</a>, and <a class="el" href="flight__control_8h_source.html#l00075">flight_fsm_t::memory</a>.</p>

<p class="reference">Referenced by <a class="el" href="flight__control_8c_source.html#l00017">check_flight_phase()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="flight__control_8h_a2d4fe4bfe6408b0445d7e474c5ea3c6c_cgraph.png" border="0" usemap="#aflight__control_8h_a2d4fe4bfe6408b0445d7e474c5ea3c6c_cgraph" alt=""/></div>
<map name="aflight__control_8h_a2d4fe4bfe6408b0445d7e474c5ea3c6c_cgraph" id="aflight__control_8h_a2d4fe4bfe6408b0445d7e474c5ea3c6c_cgraph">
<area shape="rect" title="Handler for the DROGUE state (descent under drogue parachute)." alt="" coords="5,5,153,32"/>
<area shape="rect" href="flight__control_8c.html#ac501a7c6c60c2b8c9cd9d0e7d328c80c" title="Handles the mechanics of a state transition." alt="" coords="201,5,318,32"/>
<area shape="poly" title=" " alt="" coords="153,16,185,16,185,21,153,21"/>
<area shape="rect" href="flight__control_8c.html#a2453e798beaa2b27f6468db201f7861a" title=" " alt="" coords="366,5,498,32"/>
<area shape="poly" title=" " alt="" coords="318,16,350,16,350,21,318,21"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="flight__control_8h_a2d4fe4bfe6408b0445d7e474c5ea3c6c_icgraph.png" border="0" usemap="#aflight__control_8h_a2d4fe4bfe6408b0445d7e474c5ea3c6c_icgraph" alt=""/></div>
<map name="aflight__control_8h_a2d4fe4bfe6408b0445d7e474c5ea3c6c_icgraph" id="aflight__control_8h_a2d4fe4bfe6408b0445d7e474c5ea3c6c_icgraph">
<area shape="rect" title="Handler for the DROGUE state (descent under drogue parachute)." alt="" coords="409,5,557,32"/>
<area shape="rect" href="flight__control_8c.html#a47306eb52262845f0284a01226c787ca" title="Main FSM router function that delegates to the current state&#39;s handler." alt="" coords="228,5,361,32"/>
<area shape="poly" title=" " alt="" coords="394,21,362,21,362,16,394,16"/>
<area shape="rect" href="group___r_t_o_s___tasks.html#ga958596a1a00c9ec7bce777e773465f45" title="Function implementing the FSM thread." alt="" coords="103,5,180,32"/>
<area shape="poly" title=" " alt="" coords="212,21,180,21,180,16,212,16"/>
<area shape="rect" href="main_8c.html#a840291bc02cba5474a4cb46a9b9566fe" title="The application entry point." alt="" coords="5,5,55,32"/>
<area shape="poly" title=" " alt="" coords="87,21,55,21,55,16,87,16"/>
</map>
</div>

</div>
</div>
<a id="a850f84f75bc7d3639826e71dc1ba1367" name="a850f84f75bc7d3639826e71dc1ba1367"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a850f84f75bc7d3639826e71dc1ba1367">&#9670;&#160;</a></span>check_flight_phase()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void check_flight_phase </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structflight__fsm__t.html">flight_fsm_t</a> *&#160;</td>
          <td class="paramname"><em>fsm_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structestimation__output__t.html">estimation_output_t</a>&#160;</td>
          <td class="paramname"><em>MotionData</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structlinear__acceleration__t.html">linear_acceleration_t</a>&#160;</td>
          <td class="paramname"><em>acc_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Main FSM router function that delegates to the current state's handler. </p>
<p>This function acts as a switchboard. Based on the <code>flight_state</code> member of the FSM object, it calls the appropriate handler function for the current phase (e.g., <code>check_Calibrating_phase</code>, <code>check_Liftoff_phase</code>, etc.). </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">fsm_state</td><td>Pointer to the FSM state object. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">MotionData</td><td>The latest output from the state estimation filter. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">acc_data</td><td>The latest raw linear acceleration data. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>None </dd></dl>

<p class="definition">Definition at line <a class="el" href="flight__control_8c_source.html#l00017">17</a> of file <a class="el" href="flight__control_8c_source.html">flight_control.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   17</span>                                                                                                            {</div>
<div class="line"><span class="lineno">   18</span> </div>
<div class="line"><span class="lineno">   19</span>     <span class="keyword">const</span> <a class="code hl_struct" href="structflight__fsm__t.html">flight_fsm_t</a> old_phase = *phase;</div>
<div class="line"><span class="lineno">   20</span> </div>
<div class="line"><span class="lineno">   21</span>     <span class="keywordflow">switch</span> (phase-&gt;flight_state) {</div>
<div class="line"><span class="lineno">   22</span>         <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3a418c789b8bc517c5c1cf05dbfc5c45e0">CALIBRATING</a>:</div>
<div class="line"><span class="lineno">   23</span>              <a class="code hl_function" href="flight__control_8c.html#a2d929a4793ee883e3e7bdabe0deea72e">check_Calibrating_phase</a>(phase,MotionData,acc_data);</div>
<div class="line"><span class="lineno">   24</span>              <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">   25</span> </div>
<div class="line"><span class="lineno">   26</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3a78cda93fcedb1dc8abd154cc187e6730">LIFTOFF</a>:</div>
<div class="line"><span class="lineno">   27</span>              <a class="code hl_function" href="flight__control_8c.html#aba82f61bcce6a03c81dae2533ab2431e">check_Liftoff_phase</a>(phase, MotionData);</div>
<div class="line"><span class="lineno">   28</span>              <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">   29</span> </div>
<div class="line"><span class="lineno">   30</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3ad790b28b6f6640a2aeb099fdd740566b">BURNING</a>:</div>
<div class="line"><span class="lineno">   31</span>              <a class="code hl_function" href="flight__control_8c.html#a2044ea22f9d0a5b3c53b269e4f1be508">check_Burning_phase</a>(phase, MotionData);</div>
<div class="line"><span class="lineno">   32</span>              <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">   33</span> </div>
<div class="line"><span class="lineno">   34</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3a96fa685b0a361f3103c6b0324eb48286">ABCSDEPLOYED</a>:</div>
<div class="line"><span class="lineno">   35</span>              <a class="code hl_function" href="flight__control_8c.html#a3633e4bb35c5a119ca032439db0d985a">check_AbcsDeployed_phase</a>(phase,MotionData);</div>
<div class="line"><span class="lineno">   36</span>              <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">   37</span> </div>
<div class="line"><span class="lineno">   38</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3aadd0dc8e4b9d8ac5e296a6dd14d9d7ba">DROGUE</a>:</div>
<div class="line"><span class="lineno">   39</span>              <a class="code hl_function" href="flight__control_8c.html#ad67c8fa956febe3c7a883f7fa2b268b0">check_Drogue_phase</a>(phase,MotionData);</div>
<div class="line"><span class="lineno">   40</span>              <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">   41</span> </div>
<div class="line"><span class="lineno">   42</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3a41c6eb506ccf657cc7e958c8e8c769cd">MAIN</a>:</div>
<div class="line"><span class="lineno">   43</span>              <a class="code hl_function" href="flight__control_8c.html#a8116659c0af7f3f1abd980d8013e2654">check_Main_phase</a>(phase, MotionData);</div>
<div class="line"><span class="lineno">   44</span>              <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">   45</span> </div>
<div class="line"><span class="lineno">   46</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3af333eb87dc386553d0043cf3af30a831">TOUCHDOWN</a>:</div>
<div class="line"><span class="lineno">   47</span>              <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">   48</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3aef2863a469df3ea6871d640e3669a2f2">INVALID</a>:</div>
<div class="line"><span class="lineno">   49</span>              <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">   50</span> </div>
<div class="line"><span class="lineno">   51</span>      }</div>
<div class="line"><span class="lineno">   52</span> </div>
<div class="line"><span class="lineno">   53</span>     phase-&gt;state_changed = old_phase.<a class="code hl_variable" href="structflight__fsm__t.html#aa261111fbfd39bc2e3e292c60b467dda">flight_state</a> != phase-&gt;flight_state;</div>
<div class="line"><span class="lineno">   54</span>}</div>
<div class="ttc" id="aflight__control_8c_html_a2044ea22f9d0a5b3c53b269e4f1be508"><div class="ttname"><a href="flight__control_8c.html#a2044ea22f9d0a5b3c53b269e4f1be508">check_Burning_phase</a></div><div class="ttdeci">void check_Burning_phase(flight_fsm_t *phase, estimation_output_t MotionData)</div><div class="ttdoc">Handler for the BURNING state (powered ascent).</div><div class="ttdef"><b>Definition</b> <a href="flight__control_8c_source.html#l00126">flight_control.c:126</a></div></div>
<div class="ttc" id="aflight__control_8c_html_a2d929a4793ee883e3e7bdabe0deea72e"><div class="ttname"><a href="flight__control_8c.html#a2d929a4793ee883e3e7bdabe0deea72e">check_Calibrating_phase</a></div><div class="ttdeci">void check_Calibrating_phase(flight_fsm_t *fsm_state, estimation_output_t MotionData, linear_acceleration_t acc_data)</div><div class="ttdoc">Handler for the CALIBRATING state.</div><div class="ttdef"><b>Definition</b> <a href="flight__control_8c_source.html#l00056">flight_control.c:56</a></div></div>
<div class="ttc" id="aflight__control_8c_html_a3633e4bb35c5a119ca032439db0d985a"><div class="ttname"><a href="flight__control_8c.html#a3633e4bb35c5a119ca032439db0d985a">check_AbcsDeployed_phase</a></div><div class="ttdeci">void check_AbcsDeployed_phase(flight_fsm_t *phase, estimation_output_t MotionData)</div><div class="ttdoc">Handler for the ABCSDEPLOYED state (apogee control).</div><div class="ttdef"><b>Definition</b> <a href="flight__control_8c_source.html#l00162">flight_control.c:162</a></div></div>
<div class="ttc" id="aflight__control_8c_html_a8116659c0af7f3f1abd980d8013e2654"><div class="ttname"><a href="flight__control_8c.html#a8116659c0af7f3f1abd980d8013e2654">check_Main_phase</a></div><div class="ttdeci">void check_Main_phase(flight_fsm_t *phase, estimation_output_t MotionData)</div><div class="ttdoc">Handler for the MAIN state (descent under main parachute).</div><div class="ttdef"><b>Definition</b> <a href="flight__control_8c_source.html#l00197">flight_control.c:197</a></div></div>
<div class="ttc" id="aflight__control_8c_html_aba82f61bcce6a03c81dae2533ab2431e"><div class="ttname"><a href="flight__control_8c.html#aba82f61bcce6a03c81dae2533ab2431e">check_Liftoff_phase</a></div><div class="ttdeci">void check_Liftoff_phase(flight_fsm_t *fsm_state, estimation_output_t MotionData)</div><div class="ttdoc">Handler for the LIFTOFF state.</div><div class="ttdef"><b>Definition</b> <a href="flight__control_8c_source.html#l00093">flight_control.c:93</a></div></div>
<div class="ttc" id="aflight__control_8c_html_ad67c8fa956febe3c7a883f7fa2b268b0"><div class="ttname"><a href="flight__control_8c.html#ad67c8fa956febe3c7a883f7fa2b268b0">check_Drogue_phase</a></div><div class="ttdeci">void check_Drogue_phase(flight_fsm_t *phase, estimation_output_t MotionData)</div><div class="ttdoc">Handler for the DROGUE state (descent under drogue parachute).</div><div class="ttdef"><b>Definition</b> <a href="flight__control_8c_source.html#l00181">flight_control.c:181</a></div></div>
<div class="ttc" id="agroup___flight_state_html_gga3dfa0d2746ea8e8cbad6da7259918ab3aef2863a469df3ea6871d640e3669a2f2"><div class="ttname"><a href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3aef2863a469df3ea6871d640e3669a2f2">INVALID</a></div><div class="ttdeci">@ INVALID</div><div class="ttdoc">An undefined or error state.</div><div class="ttdef"><b>Definition</b> <a href="flight__control_8h_source.html#l00034">flight_control.h:34</a></div></div>
<div class="ttc" id="agroup___flight_state_html_gga3dfa0d2746ea8e8cbad6da7259918ab3af333eb87dc386553d0043cf3af30a831"><div class="ttname"><a href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3af333eb87dc386553d0043cf3af30a831">TOUCHDOWN</a></div><div class="ttdeci">@ TOUCHDOWN</div><div class="ttdoc">Rocket has landed.</div><div class="ttdef"><b>Definition</b> <a href="flight__control_8h_source.html#l00041">flight_control.h:41</a></div></div>
<div class="ttc" id="astructflight__fsm__t_html"><div class="ttname"><a href="structflight__fsm__t.html">flight_fsm_t</a></div><div class="ttdoc">Main data structure for the Flight State Machine.</div><div class="ttdef"><b>Definition</b> <a href="flight__control_8h_source.html#l00070">flight_control.h:70</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="flight__control_8h_source.html#l00038">ABCSDEPLOYED</a>, <a class="el" href="flight__control_8h_source.html#l00037">BURNING</a>, <a class="el" href="flight__control_8h_source.html#l00035">CALIBRATING</a>, <a class="el" href="flight__control_8c_source.html#l00162">check_AbcsDeployed_phase()</a>, <a class="el" href="flight__control_8c_source.html#l00126">check_Burning_phase()</a>, <a class="el" href="flight__control_8c_source.html#l00056">check_Calibrating_phase()</a>, <a class="el" href="flight__control_8c_source.html#l00181">check_Drogue_phase()</a>, <a class="el" href="flight__control_8c_source.html#l00093">check_Liftoff_phase()</a>, <a class="el" href="flight__control_8c_source.html#l00197">check_Main_phase()</a>, <a class="el" href="flight__control_8h_source.html#l00039">DROGUE</a>, <a class="el" href="flight__control_8h_source.html#l00071">flight_fsm_t::flight_state</a>, <a class="el" href="flight__control_8h_source.html#l00034">INVALID</a>, <a class="el" href="flight__control_8h_source.html#l00036">LIFTOFF</a>, <a class="el" href="flight__control_8h_source.html#l00040">MAIN</a>, <a class="el" href="flight__control_8h_source.html#l00078">flight_fsm_t::state_changed</a>, and <a class="el" href="flight__control_8h_source.html#l00041">TOUCHDOWN</a>.</p>

<p class="reference">Referenced by <a class="el" href="main_8c_source.html#l01721">StartFSM()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="flight__control_8h_a850f84f75bc7d3639826e71dc1ba1367_cgraph.png" border="0" usemap="#aflight__control_8h_a850f84f75bc7d3639826e71dc1ba1367_cgraph" alt=""/></div>
<map name="aflight__control_8h_a850f84f75bc7d3639826e71dc1ba1367_cgraph" id="aflight__control_8h_a850f84f75bc7d3639826e71dc1ba1367_cgraph">
<area shape="rect" title="Main FSM router function that delegates to the current state&#39;s handler." alt="" coords="5,148,139,175"/>
<area shape="rect" href="flight__control_8c.html#a3633e4bb35c5a119ca032439db0d985a" title="Handler for the ABCSDEPLOYED state (apogee control)." alt="" coords="196,5,344,48"/>
<area shape="poly" title=" " alt="" coords="84,146,126,103,185,58,193,53,196,58,188,62,130,107,88,149"/>
<area shape="rect" href="flight__control_8c.html#a2044ea22f9d0a5b3c53b269e4f1be508" title="Handler for the BURNING state (powered ascent)." alt="" coords="196,72,345,99"/>
<area shape="poly" title=" " alt="" coords="101,145,186,108,205,101,207,106,188,113,103,150"/>
<area shape="rect" href="flight__control_8c.html#a2d929a4793ee883e3e7bdabe0deea72e" title="Handler for the CALIBRATING state." alt="" coords="187,275,354,301"/>
<area shape="poly" title=" " alt="" coords="87,173,129,216,157,240,188,260,200,266,197,271,185,265,154,244,125,220,83,177"/>
<area shape="rect" href="flight__control_8c.html#ad67c8fa956febe3c7a883f7fa2b268b0" title="Handler for the DROGUE state (descent under drogue parachute)." alt="" coords="197,123,344,149"/>
<area shape="poly" title=" " alt="" coords="139,150,181,145,181,150,139,155"/>
<area shape="rect" href="flight__control_8c.html#aba82f61bcce6a03c81dae2533ab2431e" title="Handler for the LIFTOFF state." alt="" coords="202,173,339,200"/>
<area shape="poly" title=" " alt="" coords="139,167,187,173,186,179,139,172"/>
<area shape="rect" href="flight__control_8c.html#a8116659c0af7f3f1abd980d8013e2654" title="Handler for the MAIN state (descent under main parachute)." alt="" coords="204,224,337,251"/>
<area shape="poly" title=" " alt="" coords="103,173,188,210,207,216,205,221,186,214,101,178"/>
<area shape="rect" href="flight__control_8c.html#ac501a7c6c60c2b8c9cd9d0e7d328c80c" title="Handles the mechanics of a state transition." alt="" coords="402,148,519,175"/>
<area shape="poly" title=" " alt="" coords="335,46,355,58,403,96,440,134,436,138,399,100,353,62,332,51"/>
<area shape="rect" href="flight__control_8c.html#a2453e798beaa2b27f6468db201f7861a" title=" " alt="" coords="607,148,739,175"/>
<area shape="poly" title=" " alt="" coords="520,159,591,159,591,164,520,164"/>
<area shape="poly" title=" " alt="" coords="322,97,355,108,421,138,419,143,353,113,320,102"/>
<area shape="poly" title=" " alt="" coords="328,272,353,260,400,224,437,185,441,189,404,228,355,265,331,276"/>
<area shape="rect" href="group___winbond___memory.html#gad6301bd88db8e497c5382bda891bac6f" title=" " alt="" coords="410,275,511,301"/>
<area shape="poly" title=" " alt="" coords="355,285,395,285,395,291,355,291"/>
<area shape="rect" href="group___winbond___control.html#gaefb0b18c1b05043f2ce91b1be9be11be" title=" " alt="" coords="567,224,779,251"/>
<area shape="poly" title=" " alt="" coords="511,274,598,252,600,257,512,279"/>
<area shape="rect" href="z__qflash___w25_q_x_x_x_8c.html#afb89e02b295e274a464decd984e2f0c5" title=" " alt="" coords="585,275,761,301"/>
<area shape="poly" title=" " alt="" coords="511,285,570,285,570,291,511,291"/>
<area shape="rect" href="group___winbond___status.html#gaf93b34eaf38e118fc173c4c0d5abe5f7" title="enables writes" alt="" coords="603,325,743,352"/>
<area shape="poly" title=" " alt="" coords="512,297,600,319,598,324,511,302"/>
<area shape="rect" href="group___winbond___status.html#gaa0c97f126a0945f1a2cdbaa2258a0d73" title=" " alt="" coords="827,275,967,301"/>
<area shape="poly" title=" " alt="" coords="736,249,820,268,819,273,735,254"/>
<area shape="poly" title=" " alt="" coords="761,285,811,285,811,291,761,291"/>
<area shape="poly" title=" " alt="" coords="735,322,819,303,820,308,736,327"/>
<area shape="poly" title=" " alt="" coords="345,143,387,149,386,154,344,148"/>
<area shape="poly" title=" " alt="" coords="339,175,386,169,387,174,340,180"/>
<area shape="poly" title=" " alt="" coords="320,221,353,210,419,180,421,184,355,214,322,226"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="flight__control_8h_a850f84f75bc7d3639826e71dc1ba1367_icgraph.png" border="0" usemap="#aflight__control_8h_a850f84f75bc7d3639826e71dc1ba1367_icgraph" alt=""/></div>
<map name="aflight__control_8h_a850f84f75bc7d3639826e71dc1ba1367_icgraph" id="aflight__control_8h_a850f84f75bc7d3639826e71dc1ba1367_icgraph">
<area shape="rect" title="Main FSM router function that delegates to the current state&#39;s handler." alt="" coords="228,5,361,32"/>
<area shape="rect" href="group___r_t_o_s___tasks.html#ga958596a1a00c9ec7bce777e773465f45" title="Function implementing the FSM thread." alt="" coords="103,5,180,32"/>
<area shape="poly" title=" " alt="" coords="212,21,180,21,180,16,212,16"/>
<area shape="rect" href="main_8c.html#a840291bc02cba5474a4cb46a9b9566fe" title="The application entry point." alt="" coords="5,5,55,32"/>
<area shape="poly" title=" " alt="" coords="87,21,55,21,55,16,87,16"/>
</map>
</div>

</div>
</div>
<a id="aba82f61bcce6a03c81dae2533ab2431e" name="aba82f61bcce6a03c81dae2533ab2431e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aba82f61bcce6a03c81dae2533ab2431e">&#9670;&#160;</a></span>check_Liftoff_phase()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void check_Liftoff_phase </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structflight__fsm__t.html">flight_fsm_t</a> *&#160;</td>
          <td class="paramname"><em>fsm_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structestimation__output__t.html">estimation_output_t</a>&#160;</td>
          <td class="paramname"><em>MotionData</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handler for the LIFTOFF state. </p>
<p>Monitors for the end of the motor burn phase based on acceleration drop. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">fsm_state</td><td>Pointer to the FSM state object. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">MotionData</td><td>Filtered estimation data (altitude, velocity). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="flight__control_8c_source.html#l00093">93</a> of file <a class="el" href="flight__control_8c_source.html">flight_control.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   93</span>                                                                                 {</div>
<div class="line"><span class="lineno">   94</span>    <span class="comment">// if I&#39;m in a higher state I cannot come back</span></div>
<div class="line"><span class="lineno">   95</span>    <span class="keywordflow">if</span>(fsm_state-&gt;<a class="code hl_variable" href="structflight__fsm__t.html#aa261111fbfd39bc2e3e292c60b467dda">flight_state</a> &gt; <a class="code hl_enumvalue" href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3a78cda93fcedb1dc8abd154cc187e6730">LIFTOFF</a>) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">   96</span> </div>
<div class="line"><span class="lineno">   97</span>    <span class="keywordflow">if</span> (MotionData.<a class="code hl_variable" href="structestimation__output__t.html#abb80b0a1dfae15b7abca1d0bd3c5f5ff">height</a> &gt; 500) {</div>
<div class="line"><span class="lineno">   98</span>        fsm_state-&gt;<a class="code hl_variable" href="structflight__fsm__t.html#a8d9181f808299123359ef27cc52d8641">memory</a>[0]++;</div>
<div class="line"><span class="lineno">   99</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  100</span>          fsm_state-&gt;<a class="code hl_variable" href="structflight__fsm__t.html#a8d9181f808299123359ef27cc52d8641">memory</a>[0] = 0;</div>
<div class="line"><span class="lineno">  101</span>      }</div>
<div class="line"><span class="lineno">  102</span> </div>
<div class="line"><span class="lineno">  103</span>    <span class="keywordflow">if</span> (fsm_state-&gt;<a class="code hl_variable" href="structflight__fsm__t.html#a8d9181f808299123359ef27cc52d8641">memory</a>[0] &gt; <a class="code hl_define" href="group___f_s_m___safety___counters.html#gabdb78e2ad123abe28ef8d1eb06c18e4b">COASTING_SAFETY_COUNTER</a>) {</div>
<div class="line"><span class="lineno">  104</span>        <a class="code hl_variable" href="group___global___variables.html#ga1cf27eef143ce97274946c621c1b5c6c">flag_kf</a> = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  105</span>        <a class="code hl_function" href="flight__control_8c.html#ac501a7c6c60c2b8c9cd9d0e7d328c80c">change_state_to</a>(fsm_state, <a class="code hl_enumvalue" href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3ad790b28b6f6640a2aeb099fdd740566b">BURNING</a>);<span class="comment">//ABCSDEPLOYED</span></div>
<div class="line"><span class="lineno">  106</span>    }</div>
<div class="line"><span class="lineno">  107</span> </div>
<div class="line"><span class="lineno">  108</span> </div>
<div class="line"><span class="lineno">  109</span><span class="comment">//----------------------------------------------------------------------------------------- JUST IN CASE WE HAVE AN UMEXPECTED APOGEE</span></div>
<div class="line"><span class="lineno">  110</span>    <span class="keywordflow">if</span> (MotionData.<a class="code hl_variable" href="structestimation__output__t.html#abb80b0a1dfae15b7abca1d0bd3c5f5ff">height</a> &lt; <a class="code hl_variable" href="flight__control_8c.html#a89f505952b15d3ead3e15863164ebb9d">previous_altitude</a>) {</div>
<div class="line"><span class="lineno">  111</span>        fsm_state-&gt;<a class="code hl_variable" href="structflight__fsm__t.html#a7149ffc1d309dbafbe2b809f4397e754">memory_bis</a>[0]++;</div>
<div class="line"><span class="lineno">  112</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  113</span>        fsm_state-&gt;<a class="code hl_variable" href="structflight__fsm__t.html#a7149ffc1d309dbafbe2b809f4397e754">memory_bis</a>[0] = 0;</div>
<div class="line"><span class="lineno">  114</span>        <a class="code hl_variable" href="flight__control_8c.html#a89f505952b15d3ead3e15863164ebb9d">previous_altitude</a> = MotionData.<a class="code hl_variable" href="structestimation__output__t.html#abb80b0a1dfae15b7abca1d0bd3c5f5ff">height</a>;</div>
<div class="line"><span class="lineno">  115</span>    }</div>
<div class="line"><span class="lineno">  116</span> </div>
<div class="line"><span class="lineno">  117</span>    <span class="keywordflow">if</span>(fsm_state-&gt;<a class="code hl_variable" href="structflight__fsm__t.html#a7149ffc1d309dbafbe2b809f4397e754">memory_bis</a>[0] &gt; <a class="code hl_define" href="group___f_s_m___safety___counters.html#gaeb43200e79c23d18bc1a291bf10e2361">APOGEE_SAFETY_COUNTER</a>) {</div>
<div class="line"><span class="lineno">  118</span>        <a class="code hl_variable" href="group___global___variables.html#ga9f6b9948886b71a18a636cce7acd5e52">drogue</a> = 1;</div>
<div class="line"><span class="lineno">  119</span>        <a class="code hl_variable" href="group___global___variables.html#ga3dd0ab7e3442a6c2767b63b3916f473f">flag_MPC</a> = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  120</span>        <a class="code hl_variable" href="group___global___variables.html#gac214107f44ddc446c55d6c07952198f7">flag_attitude</a> = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  121</span>        <a class="code hl_function" href="flight__control_8c.html#ac501a7c6c60c2b8c9cd9d0e7d328c80c">change_state_to</a>(fsm_state,<a class="code hl_enumvalue" href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3aadd0dc8e4b9d8ac5e296a6dd14d9d7ba">DROGUE</a>);</div>
<div class="line"><span class="lineno">  122</span>    }</div>
<div class="line"><span class="lineno">  123</span><span class="comment">//--------------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="lineno">  124</span>}</div>
<div class="ttc" id="agroup___global___variables_html_ga1cf27eef143ce97274946c621c1b5c6c"><div class="ttname"><a href="group___global___variables.html#ga1cf27eef143ce97274946c621c1b5c6c">flag_kf</a></div><div class="ttdeci">bool flag_kf</div><div class="ttdoc">RTOS event flag to trigger the Kalman Filter task.</div><div class="ttdef"><b>Definition</b> <a href="main_8c_source.html#l00301">main.c:301</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_f_l_i_g_h_t___p_a_r_a_m_e_t_e_r_s___c_o_n_f_i_g_8h_source.html#l00061">APOGEE_SAFETY_COUNTER</a>, <a class="el" href="flight__control_8h_source.html#l00037">BURNING</a>, <a class="el" href="flight__control_8c_source.html#l00229">change_state_to()</a>, <a class="el" href="_f_l_i_g_h_t___p_a_r_a_m_e_t_e_r_s___c_o_n_f_i_g_8h_source.html#l00060">COASTING_SAFETY_COUNTER</a>, <a class="el" href="flight__control_8h_source.html#l00039">DROGUE</a>, <a class="el" href="main_8c_source.html#l00229">drogue</a>, <a class="el" href="main_8c_source.html#l00302">flag_attitude</a>, <a class="el" href="main_8c_source.html#l00301">flag_kf</a>, <a class="el" href="main_8c_source.html#l00303">flag_MPC</a>, <a class="el" href="flight__control_8h_source.html#l00071">flight_fsm_t::flight_state</a>, <a class="el" href="flight__control_8h_source.html#l00059">estimation_output_t::height</a>, <a class="el" href="flight__control_8h_source.html#l00036">LIFTOFF</a>, <a class="el" href="flight__control_8h_source.html#l00075">flight_fsm_t::memory</a>, <a class="el" href="flight__control_8h_source.html#l00076">flight_fsm_t::memory_bis</a>, and <a class="el" href="flight__control_8c_source.html#l00013">previous_altitude</a>.</p>

<p class="reference">Referenced by <a class="el" href="flight__control_8c_source.html#l00017">check_flight_phase()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="flight__control_8h_aba82f61bcce6a03c81dae2533ab2431e_cgraph.png" border="0" usemap="#aflight__control_8h_aba82f61bcce6a03c81dae2533ab2431e_cgraph" alt=""/></div>
<map name="aflight__control_8h_aba82f61bcce6a03c81dae2533ab2431e_cgraph" id="aflight__control_8h_aba82f61bcce6a03c81dae2533ab2431e_cgraph">
<area shape="rect" title="Handler for the LIFTOFF state." alt="" coords="5,5,143,32"/>
<area shape="rect" href="flight__control_8c.html#ac501a7c6c60c2b8c9cd9d0e7d328c80c" title="Handles the mechanics of a state transition." alt="" coords="191,5,308,32"/>
<area shape="poly" title=" " alt="" coords="143,16,175,16,175,21,143,21"/>
<area shape="rect" href="flight__control_8c.html#a2453e798beaa2b27f6468db201f7861a" title=" " alt="" coords="356,5,488,32"/>
<area shape="poly" title=" " alt="" coords="308,16,340,16,340,21,308,21"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="flight__control_8h_aba82f61bcce6a03c81dae2533ab2431e_icgraph.png" border="0" usemap="#aflight__control_8h_aba82f61bcce6a03c81dae2533ab2431e_icgraph" alt=""/></div>
<map name="aflight__control_8h_aba82f61bcce6a03c81dae2533ab2431e_icgraph" id="aflight__control_8h_aba82f61bcce6a03c81dae2533ab2431e_icgraph">
<area shape="rect" title="Handler for the LIFTOFF state." alt="" coords="409,5,547,32"/>
<area shape="rect" href="flight__control_8c.html#a47306eb52262845f0284a01226c787ca" title="Main FSM router function that delegates to the current state&#39;s handler." alt="" coords="228,5,361,32"/>
<area shape="poly" title=" " alt="" coords="394,21,362,21,362,16,394,16"/>
<area shape="rect" href="group___r_t_o_s___tasks.html#ga958596a1a00c9ec7bce777e773465f45" title="Function implementing the FSM thread." alt="" coords="103,5,180,32"/>
<area shape="poly" title=" " alt="" coords="212,21,180,21,180,16,212,16"/>
<area shape="rect" href="main_8c.html#a840291bc02cba5474a4cb46a9b9566fe" title="The application entry point." alt="" coords="5,5,55,32"/>
<area shape="poly" title=" " alt="" coords="87,21,55,21,55,16,87,16"/>
</map>
</div>

</div>
</div>
<a id="a1fbe66f19e588fd4bf4a6ed29ddc8a3b" name="a1fbe66f19e588fd4bf4a6ed29ddc8a3b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1fbe66f19e588fd4bf4a6ed29ddc8a3b">&#9670;&#160;</a></span>check_Main_phase()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void check_Main_phase </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structflight__fsm__t.html">flight_fsm_t</a> *&#160;</td>
          <td class="paramname"><em>fsm_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structestimation__output__t.html">estimation_output_t</a>&#160;</td>
          <td class="paramname"><em>MotionData</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handler for the MAIN state (descent under main parachute). </p>
<p>Monitors for a stable, low altitude and a spike in acceleration to detect landing. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">fsm_state</td><td>Pointer to the FSM state object. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">MotionData</td><td>Filtered estimation data (altitude, velocity). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="flight__control_8c_source.html#l00197">197</a> of file <a class="el" href="flight__control_8c_source.html">flight_control.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  197</span>                                                                           {</div>
<div class="line"><span class="lineno">  198</span>    <span class="comment">// if I&#39;m in a higher state I cannot come back</span></div>
<div class="line"><span class="lineno">  199</span>    <span class="keywordflow">if</span>(phase-&gt;flight_state &gt; <a class="code hl_enumvalue" href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3a41c6eb506ccf657cc7e958c8e8c769cd">MAIN</a>) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  200</span> </div>
<div class="line"><span class="lineno">  201</span>    <span class="comment">//HAL_GPIO_WritePin(GPIOC, E_Match_Parachute_2_Pin, GPIO_PIN_SET);</span></div>
<div class="line"><span class="lineno">  202</span> </div>
<div class="line"><span class="lineno">  203</span>    <span class="comment">/* If the velocity is very small we have touchdown */</span></div>
<div class="line"><span class="lineno">  204</span>    <span class="comment">// check the altitude for a specific amount of time</span></div>
<div class="line"><span class="lineno">  205</span>    <span class="keywordflow">if</span> (fabsf(MotionData.<a class="code hl_variable" href="structestimation__output__t.html#aa8de49abb95e45d9f0ba2ae0aa90ba31">velocity</a>) &lt; <a class="code hl_define" href="group___f_s_m___thresholds.html#ga8ef04e4686caa23b24f5037a21c47224">VELOCITY_BOUND_TOUCHDOWN</a>) {</div>
<div class="line"><span class="lineno">  206</span><span class="comment">//      /* Touchdown achieved */</span></div>
<div class="line"><span class="lineno">  207</span>        phase-&gt;memory[0]++;</div>
<div class="line"><span class="lineno">  208</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  209</span>        <span class="comment">/* Touchdown not achieved */</span></div>
<div class="line"><span class="lineno">  210</span>        phase-&gt;memory[0] = 0;</div>
<div class="line"><span class="lineno">  211</span>    }</div>
<div class="line"><span class="lineno">  212</span> </div>
<div class="line"><span class="lineno">  213</span>    <span class="keywordflow">if</span> (phase-&gt;memory[0] &gt; <a class="code hl_define" href="group___f_s_m___safety___counters.html#ga96f3446ccdb43b48d13c8826d8c3536f">TOUCHDOWN_SAFETY_COUNTER</a>) {</div>
<div class="line"><span class="lineno">  214</span>        <a class="code hl_variable" href="group___global___variables.html#ga9944ecd09a3da3fa55c8c1846ba56f6d">flag_flash</a> = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  215</span>        <a class="code hl_function" href="flight__control_8c.html#ac501a7c6c60c2b8c9cd9d0e7d328c80c">change_state_to</a>(phase, <a class="code hl_enumvalue" href="group___flight_state.html#gga3dfa0d2746ea8e8cbad6da7259918ab3af333eb87dc386553d0043cf3af30a831">TOUCHDOWN</a>);</div>
<div class="line"><span class="lineno">  216</span>    }</div>
<div class="line"><span class="lineno">  217</span> </div>
<div class="line"><span class="lineno">  218</span>}</div>
<div class="ttc" id="agroup___f_s_m___safety___counters_html_ga96f3446ccdb43b48d13c8826d8c3536f"><div class="ttname"><a href="group___f_s_m___safety___counters.html#ga96f3446ccdb43b48d13c8826d8c3536f">TOUCHDOWN_SAFETY_COUNTER</a></div><div class="ttdeci">#define TOUCHDOWN_SAFETY_COUNTER</div><div class="ttdoc">Cycles for touchdown logic.</div><div class="ttdef"><b>Definition</b> <a href="_f_l_i_g_h_t___p_a_r_a_m_e_t_e_r_s___c_o_n_f_i_g_8h_source.html#l00063">FLIGHT_PARAMETERS_CONFIG.h:63</a></div></div>
<div class="ttc" id="agroup___f_s_m___thresholds_html_ga8ef04e4686caa23b24f5037a21c47224"><div class="ttname"><a href="group___f_s_m___thresholds.html#ga8ef04e4686caa23b24f5037a21c47224">VELOCITY_BOUND_TOUCHDOWN</a></div><div class="ttdeci">#define VELOCITY_BOUND_TOUCHDOWN</div><div class="ttdoc">Maximum vertical velocity (m/s) below which touchdown is considered possible.</div><div class="ttdef"><b>Definition</b> <a href="_f_l_i_g_h_t___p_a_r_a_m_e_t_e_r_s___c_o_n_f_i_g_8h_source.html#l00049">FLIGHT_PARAMETERS_CONFIG.h:49</a></div></div>
<div class="ttc" id="astructestimation__output__t_html_aa8de49abb95e45d9f0ba2ae0aa90ba31"><div class="ttname"><a href="structestimation__output__t.html#aa8de49abb95e45d9f0ba2ae0aa90ba31">estimation_output_t::velocity</a></div><div class="ttdeci">float_t velocity</div><div class="ttdoc">Vertical velocity in meters per second (m/s).</div><div class="ttdef"><b>Definition</b> <a href="flight__control_8h_source.html#l00060">flight_control.h:60</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="flight__control_8c_source.html#l00229">change_state_to()</a>, <a class="el" href="main_8c_source.html#l00307">flag_flash</a>, <a class="el" href="flight__control_8h_source.html#l00071">flight_fsm_t::flight_state</a>, <a class="el" href="flight__control_8h_source.html#l00040">MAIN</a>, <a class="el" href="flight__control_8h_source.html#l00075">flight_fsm_t::memory</a>, <a class="el" href="flight__control_8h_source.html#l00041">TOUCHDOWN</a>, <a class="el" href="_f_l_i_g_h_t___p_a_r_a_m_e_t_e_r_s___c_o_n_f_i_g_8h_source.html#l00063">TOUCHDOWN_SAFETY_COUNTER</a>, <a class="el" href="flight__control_8h_source.html#l00060">estimation_output_t::velocity</a>, and <a class="el" href="_f_l_i_g_h_t___p_a_r_a_m_e_t_e_r_s___c_o_n_f_i_g_8h_source.html#l00049">VELOCITY_BOUND_TOUCHDOWN</a>.</p>

<p class="reference">Referenced by <a class="el" href="flight__control_8c_source.html#l00017">check_flight_phase()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="flight__control_8h_a1fbe66f19e588fd4bf4a6ed29ddc8a3b_cgraph.png" border="0" usemap="#aflight__control_8h_a1fbe66f19e588fd4bf4a6ed29ddc8a3b_cgraph" alt=""/></div>
<map name="aflight__control_8h_a1fbe66f19e588fd4bf4a6ed29ddc8a3b_cgraph" id="aflight__control_8h_a1fbe66f19e588fd4bf4a6ed29ddc8a3b_cgraph">
<area shape="rect" title="Handler for the MAIN state (descent under main parachute)." alt="" coords="5,5,139,32"/>
<area shape="rect" href="flight__control_8c.html#ac501a7c6c60c2b8c9cd9d0e7d328c80c" title="Handles the mechanics of a state transition." alt="" coords="187,5,304,32"/>
<area shape="poly" title=" " alt="" coords="139,16,171,16,171,21,139,21"/>
<area shape="rect" href="flight__control_8c.html#a2453e798beaa2b27f6468db201f7861a" title=" " alt="" coords="352,5,484,32"/>
<area shape="poly" title=" " alt="" coords="304,16,336,16,336,21,304,21"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="flight__control_8h_a1fbe66f19e588fd4bf4a6ed29ddc8a3b_icgraph.png" border="0" usemap="#aflight__control_8h_a1fbe66f19e588fd4bf4a6ed29ddc8a3b_icgraph" alt=""/></div>
<map name="aflight__control_8h_a1fbe66f19e588fd4bf4a6ed29ddc8a3b_icgraph" id="aflight__control_8h_a1fbe66f19e588fd4bf4a6ed29ddc8a3b_icgraph">
<area shape="rect" title="Handler for the MAIN state (descent under main parachute)." alt="" coords="409,5,543,32"/>
<area shape="rect" href="flight__control_8c.html#a47306eb52262845f0284a01226c787ca" title="Main FSM router function that delegates to the current state&#39;s handler." alt="" coords="228,5,361,32"/>
<area shape="poly" title=" " alt="" coords="394,21,362,21,362,16,394,16"/>
<area shape="rect" href="group___r_t_o_s___tasks.html#ga958596a1a00c9ec7bce777e773465f45" title="Function implementing the FSM thread." alt="" coords="103,5,180,32"/>
<area shape="poly" title=" " alt="" coords="212,21,180,21,180,16,212,16"/>
<area shape="rect" href="main_8c.html#a840291bc02cba5474a4cb46a9b9566fe" title="The application entry point." alt="" coords="5,5,55,32"/>
<area shape="poly" title=" " alt="" coords="87,21,55,21,55,16,87,16"/>
</map>
</div>

</div>
</div>
<a id="ae3697dd1ba93efbdbcf9d9aee78707cd" name="ae3697dd1ba93efbdbcf9d9aee78707cd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae3697dd1ba93efbdbcf9d9aee78707cd">&#9670;&#160;</a></span>check_Touchdown_phase()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void check_Touchdown_phase </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structflight__fsm__t.html">flight_fsm_t</a> *&#160;</td>
          <td class="paramname"><em>fsm_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structestimation__output__t.html">estimation_output_t</a>&#160;</td>
          <td class="paramname"><em>MotionData</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structlinear__acceleration__t.html">linear_acceleration_t</a>&#160;</td>
          <td class="paramname"><em>acc_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handler for the TOUCHDOWN state. </p>
<p>This is a terminal state. The function performs any necessary post-landing actions, such as disabling pyros or saving final data. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">fsm_state</td><td>Pointer to the FSM state object. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">MotionData</td><td>Filtered estimation data (altitude, velocity). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">acc_data</td><td>Raw linear acceleration data from the IMU. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_74665e7a93125a1b96de8fab7d5a3847.html">Davinci_2</a></li><li class="navelem"><a class="el" href="dir_2270421e09f92bb67b3cc59e68204e53.html">Core</a></li><li class="navelem"><a class="el" href="dir_8953985c8f7f8178c476555601a95ec2.html">Inc</a></li><li class="navelem"><a class="el" href="flight__control_8h.html">flight_control.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
