<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Marconi Firmware: E220 Driver Functions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="PRT-logo-horizontal-dark-resized.png"/></td>
  <td id="projectalign">
   <div id="projectname">Marconi Firmware<span id="projectnumber">&#160;1</span>
   </div>
   <div id="projectbrief">Firmware for the Maroni-DV rocket avionics board.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('group___e220___functions.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">E220 Driver Functions<div class="ingroups"><a class="el" href="group___core.html">System Core</a> &raquo; <a class="el" href="group___telemetry.html">Telemetry</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>Public functions for controlling the E220 LoRa module.  
<a href="#details">More...</a></p>
<div class="dynheader">
Collaboration diagram for E220 Driver Functions:</div>
<div class="dyncontent">
<div class="center"><img src="group___e220___functions.png" border="0" usemap="#agroup______e220______functions" alt=""/></div>
<map name="agroup______e220______functions" id="agroup______e220______functions">
<area shape="rect" title="Public functions for controlling the E220 LoRa module." alt="" coords="132,5,283,32"/>
<area shape="rect" href="group___telemetry.html" title="Communication with the Ground Station." alt="" coords="5,5,84,32"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga5186d6d328aac24762acef26c46744a3"><td class="memItemLeft" align="right" valign="top">HAL_StatusTypeDef&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___e220___functions.html#ga5186d6d328aac24762acef26c46744a3">E220_WaitAuxHigh</a> (uint32_t timeout)</td></tr>
<tr class="memdesc:ga5186d6d328aac24762acef26c46744a3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Waits for the E220's AUX pin to go to a HIGH state.  <br /></td></tr>
<tr class="separator:ga5186d6d328aac24762acef26c46744a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga97cfb0193d1ed6cd807cfb3750a3706b"><td class="memItemLeft" align="right" valign="top">HAL_StatusTypeDef&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___e220___functions.html#ga97cfb0193d1ed6cd807cfb3750a3706b">SetConfiguration</a> (uint8_t channel, uint8_t persistence)</td></tr>
<tr class="memdesc:ga97cfb0193d1ed6cd807cfb3750a3706b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the module's channel and persistence using a direct register command.  <br /></td></tr>
<tr class="separator:ga97cfb0193d1ed6cd807cfb3750a3706b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga85eb0844ac1fa6958cc1d33e216c22a4"><td class="memItemLeft" align="right" valign="top">HAL_StatusTypeDef&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___e220___functions.html#ga85eb0844ac1fa6958cc1d33e216c22a4">E220_SendATCommand</a> (const char *command, UART_HandleTypeDef huart)</td></tr>
<tr class="memdesc:ga85eb0844ac1fa6958cc1d33e216c22a4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends an AT command string to the E220 module via UART DMA.  <br /></td></tr>
<tr class="separator:ga85eb0844ac1fa6958cc1d33e216c22a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaacc524f6ca0831f6e5e603b79254430c"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___e220___functions.html#gaacc524f6ca0831f6e5e603b79254430c">E220_WaitForResponse</a> (uint32_t timeout_ms)</td></tr>
<tr class="memdesc:gaacc524f6ca0831f6e5e603b79254430c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Waits for a response from the E220 module after sending an AT command.  <br /></td></tr>
<tr class="separator:gaacc524f6ca0831f6e5e603b79254430c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga86dc5a312335e4578acbace6165ae9bb"><td class="memItemLeft" align="right" valign="top">HAL_StatusTypeDef&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___e220___functions.html#ga86dc5a312335e4578acbace6165ae9bb">E220_Init_AT</a> (const <a class="el" href="struct_e220___config___a_t__t.html">E220_Config_AT_t</a> *config, uint8_t operating_mode, UART_HandleTypeDef huart)</td></tr>
<tr class="memdesc:ga86dc5a312335e4578acbace6165ae9bb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the E220 LoRa module using AT commands.  <br /></td></tr>
<tr class="separator:ga86dc5a312335e4578acbace6165ae9bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9505f517c8ff3613aa6222c6fad705b7"><td class="memItemLeft" align="right" valign="top">HAL_StatusTypeDef&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___e220___functions.html#ga9505f517c8ff3613aa6222c6fad705b7">E220_Change_Channel</a> (uint8_t channel, UART_HandleTypeDef huart)</td></tr>
<tr class="memdesc:ga9505f517c8ff3613aa6222c6fad705b7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Changes the E220's operating channel using an AT command.  <br /></td></tr>
<tr class="separator:ga9505f517c8ff3613aa6222c6fad705b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gade15c0ad644c38f7c962a45d21bf52f9"><td class="memItemLeft" align="right" valign="top">HAL_StatusTypeDef&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___e220___functions.html#gade15c0ad644c38f7c962a45d21bf52f9">E220_SetConfiguration_RegisterMode</a> (const <a class="el" href="struct_e220___module_config___register__t.html">E220_ModuleConfig_Register_t</a> *config, UART_HandleTypeDef *huart)</td></tr>
<tr class="memdesc:gade15c0ad644c38f7c962a45d21bf52f9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the E220 configuration using direct register writes.  <br /></td></tr>
<tr class="separator:gade15c0ad644c38f7c962a45d21bf52f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga48dabee77440c9bce39d6f67542b476e"><td class="memItemLeft" align="right" valign="top">HAL_StatusTypeDef&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___e220___functions.html#ga48dabee77440c9bce39d6f67542b476e">E220_ReadConfiguration_RegisterMode</a> (<a class="el" href="struct_e220___module_config___register__t.html">E220_ModuleConfig_Register_t</a> *config, UART_HandleTypeDef *huart)</td></tr>
<tr class="memdesc:ga48dabee77440c9bce39d6f67542b476e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads the E220 module configuration using direct register reads.  <br /></td></tr>
<tr class="separator:ga48dabee77440c9bce39d6f67542b476e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Public functions for controlling the E220 LoRa module. </p>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga9505f517c8ff3613aa6222c6fad705b7" name="ga9505f517c8ff3613aa6222c6fad705b7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga9505f517c8ff3613aa6222c6fad705b7">&#9670;&#160;</a></span>E220_Change_Channel()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HAL_StatusTypeDef E220_Change_Channel </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>channel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">UART_HandleTypeDef&#160;</td>
          <td class="paramname"><em>huart</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Changes the E220's operating channel using an AT command. </p>
<p>Convenience function to send the 'AT+CHANNEL=...' command. Handles mode switching. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">channel</td><td>The new RF channel to set. </td></tr>
    <tr><td class="paramname">huart</td><td>The UART handle to use for communication. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">HAL_OK</td><td>Command sent successfully. </td></tr>
    <tr><td class="paramname">HAL_ERROR</td><td>Failed to send command. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="e220_8c_source.html#l00118">118</a> of file <a class="el" href="e220_8c_source.html">e220.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  118</span>                                                                                {</div>
<div class="line"><span class="lineno">  119</span>    HAL_StatusTypeDef status = HAL_ERROR;</div>
<div class="line"><span class="lineno">  120</span>    <span class="keywordtype">char</span> cmd_buffer[64]; <span class="comment">// Buffer to build AT command strings</span></div>
<div class="line"><span class="lineno">  121</span> </div>
<div class="line"><span class="lineno">  122</span>    HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf7fc5de46146a2b743ff5ec05be23550">E220_M0_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#ga75fd9bd265fb1038ec7dac3fb0d56d21">E220_M0_Pin</a>, GPIO_PIN_SET);</div>
<div class="line"><span class="lineno">  123</span>    HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf3cb0f47757e60d6887ddef28b414d0e">E220_M1_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaa9e756161b6c36fa79f6bdb124d3ad7d">E220_M1_Pin</a>, GPIO_PIN_SET);</div>
<div class="line"><span class="lineno">  124</span>    HAL_Delay(20);</div>
<div class="line"><span class="lineno">  125</span> </div>
<div class="line"><span class="lineno">  126</span>    <span class="keywordflow">while</span>(HAL_GPIO_ReadPin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#ga3ccf7e62c9aaa0d395afa89698ed3f3e">E220_AUX_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gacabcedcefba600a75d3bda90a597f8fa">E220_AUX_Pin</a>) == GPIO_PIN_RESET);</div>
<div class="line"><span class="lineno">  127</span>    HAL_Delay(2);</div>
<div class="line"><span class="lineno">  128</span> </div>
<div class="line"><span class="lineno">  129</span> </div>
<div class="line"><span class="lineno">  130</span> </div>
<div class="line"><span class="lineno">  131</span>    snprintf(cmd_buffer, <span class="keyword">sizeof</span>(cmd_buffer), <span class="stringliteral">&quot;AT+CHANNEL=%d&quot;</span>, channel);</div>
<div class="line"><span class="lineno">  132</span>    status = <a class="code hl_function" href="group___e220___functions.html#ga85eb0844ac1fa6958cc1d33e216c22a4">E220_SendATCommand</a>(cmd_buffer,huart);</div>
<div class="line"><span class="lineno">  133</span>    <span class="keywordflow">if</span> (status != HAL_OK) <span class="keywordflow">return</span> status;</div>
<div class="line"><span class="lineno">  134</span>    HAL_Delay(50); <span class="comment">// Wait for response</span></div>
<div class="line"><span class="lineno">  135</span>    <span class="comment">// TODO: TRY TO READ THE RESPONSE AND EVALUATE IF IT CAN BE WORTHY TO IMPLEMENT E220_WaitForResponse</span></div>
<div class="line"><span class="lineno">  136</span>    HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf7fc5de46146a2b743ff5ec05be23550">E220_M0_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#ga75fd9bd265fb1038ec7dac3fb0d56d21">E220_M0_Pin</a>, GPIO_PIN_RESET);</div>
<div class="line"><span class="lineno">  137</span>    HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf3cb0f47757e60d6887ddef28b414d0e">E220_M1_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaa9e756161b6c36fa79f6bdb124d3ad7d">E220_M1_Pin</a>, GPIO_PIN_RESET);</div>
<div class="line"><span class="lineno">  138</span>    HAL_Delay(20);</div>
<div class="line"><span class="lineno">  139</span> </div>
<div class="line"><span class="lineno">  140</span>    <span class="keywordflow">while</span>(HAL_GPIO_ReadPin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#ga3ccf7e62c9aaa0d395afa89698ed3f3e">E220_AUX_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gacabcedcefba600a75d3bda90a597f8fa">E220_AUX_Pin</a>) == GPIO_PIN_RESET);</div>
<div class="line"><span class="lineno">  141</span>    HAL_Delay(2);</div>
<div class="line"><span class="lineno">  142</span> </div>
<div class="line"><span class="lineno">  143</span>    <span class="keywordflow">return</span> HAL_OK;</div>
<div class="line"><span class="lineno">  144</span> </div>
<div class="line"><span class="lineno">  145</span> </div>
<div class="line"><span class="lineno">  146</span>}</div>
<div class="ttc" id="agroup___e220___functions_html_ga85eb0844ac1fa6958cc1d33e216c22a4"><div class="ttname"><a href="group___e220___functions.html#ga85eb0844ac1fa6958cc1d33e216c22a4">E220_SendATCommand</a></div><div class="ttdeci">HAL_StatusTypeDef E220_SendATCommand(const char *command, UART_HandleTypeDef huart)</div><div class="ttdoc">Sends an AT command string to the E220 module via UART DMA.</div><div class="ttdef"><b>Definition</b> <a href="e220_8c_source.html#l00077">e220.c:77</a></div></div>
<div class="ttc" id="agroup___e220___g_p_i_o___definitions_html_ga3ccf7e62c9aaa0d395afa89698ed3f3e"><div class="ttname"><a href="group___e220___g_p_i_o___definitions.html#ga3ccf7e62c9aaa0d395afa89698ed3f3e">E220_AUX_GPIO_Port</a></div><div class="ttdeci">#define E220_AUX_GPIO_Port</div><div class="ttdoc">GPIO Port for Auxiliary (busy/ready) pin.</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00037">e220.h:37</a></div></div>
<div class="ttc" id="agroup___e220___g_p_i_o___definitions_html_ga75fd9bd265fb1038ec7dac3fb0d56d21"><div class="ttname"><a href="group___e220___g_p_i_o___definitions.html#ga75fd9bd265fb1038ec7dac3fb0d56d21">E220_M0_Pin</a></div><div class="ttdeci">#define E220_M0_Pin</div><div class="ttdoc">GPIO Pin for Mode control pin M0.</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00034">e220.h:34</a></div></div>
<div class="ttc" id="agroup___e220___g_p_i_o___definitions_html_gaa9e756161b6c36fa79f6bdb124d3ad7d"><div class="ttname"><a href="group___e220___g_p_i_o___definitions.html#gaa9e756161b6c36fa79f6bdb124d3ad7d">E220_M1_Pin</a></div><div class="ttdeci">#define E220_M1_Pin</div><div class="ttdoc">GPIO Pin for Mode control pin M1.</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00036">e220.h:36</a></div></div>
<div class="ttc" id="agroup___e220___g_p_i_o___definitions_html_gacabcedcefba600a75d3bda90a597f8fa"><div class="ttname"><a href="group___e220___g_p_i_o___definitions.html#gacabcedcefba600a75d3bda90a597f8fa">E220_AUX_Pin</a></div><div class="ttdeci">#define E220_AUX_Pin</div><div class="ttdoc">GPIO Pin for Auxiliary (busy/ready) pin.</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00038">e220.h:38</a></div></div>
<div class="ttc" id="agroup___e220___g_p_i_o___definitions_html_gaf3cb0f47757e60d6887ddef28b414d0e"><div class="ttname"><a href="group___e220___g_p_i_o___definitions.html#gaf3cb0f47757e60d6887ddef28b414d0e">E220_M1_GPIO_Port</a></div><div class="ttdeci">#define E220_M1_GPIO_Port</div><div class="ttdoc">GPIO Port for Mode control pin M1.</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00035">e220.h:35</a></div></div>
<div class="ttc" id="agroup___e220___g_p_i_o___definitions_html_gaf7fc5de46146a2b743ff5ec05be23550"><div class="ttname"><a href="group___e220___g_p_i_o___definitions.html#gaf7fc5de46146a2b743ff5ec05be23550">E220_M0_GPIO_Port</a></div><div class="ttdeci">#define E220_M0_GPIO_Port</div><div class="ttdoc">GPIO Port for Mode control pin M0.</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00033">e220.h:33</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="e220_8h_source.html#l00037">E220_AUX_GPIO_Port</a>, <a class="el" href="e220_8h_source.html#l00038">E220_AUX_Pin</a>, <a class="el" href="e220_8h_source.html#l00033">E220_M0_GPIO_Port</a>, <a class="el" href="e220_8h_source.html#l00034">E220_M0_Pin</a>, <a class="el" href="e220_8h_source.html#l00035">E220_M1_GPIO_Port</a>, <a class="el" href="e220_8h_source.html#l00036">E220_M1_Pin</a>, and <a class="el" href="e220_8c_source.html#l00077">E220_SendATCommand()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group___e220___functions_ga9505f517c8ff3613aa6222c6fad705b7_cgraph.png" border="0" usemap="#agroup___e220___functions_ga9505f517c8ff3613aa6222c6fad705b7_cgraph" alt=""/></div>
<map name="agroup___e220___functions_ga9505f517c8ff3613aa6222c6fad705b7_cgraph" id="agroup___e220___functions_ga9505f517c8ff3613aa6222c6fad705b7_cgraph">
<area shape="rect" title="Changes the E220&#39;s operating channel using an AT command." alt="" coords="5,5,164,32"/>
<area shape="rect" href="group___e220___functions.html#ga85eb0844ac1fa6958cc1d33e216c22a4" title="Sends an AT command string to the E220 module via UART DMA." alt="" coords="212,5,376,32"/>
<area shape="poly" title=" " alt="" coords="164,16,196,16,196,21,164,21"/>
</map>
</div>

</div>
</div>
<a id="ga86dc5a312335e4578acbace6165ae9bb" name="ga86dc5a312335e4578acbace6165ae9bb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga86dc5a312335e4578acbace6165ae9bb">&#9670;&#160;</a></span>E220_Init_AT()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HAL_StatusTypeDef E220_Init_AT </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_e220___config___a_t__t.html">E220_Config_AT_t</a> *&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>operating_mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">UART_HandleTypeDef&#160;</td>
          <td class="paramname"><em>huart</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes the E220 LoRa module using AT commands. </p>
<p>This function enters configuration mode (M0=1, M1=1), sends a series of AT commands based on the <code>config</code> struct, and then switches to the specified <code>operating_mode</code>. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">config</td><td>Pointer to the <code><a class="el" href="struct_e220___config___a_t__t.html" title="Represents the E220 module&#39;s configuration based on AT command parameters.">E220_Config_AT_t</a></code> structure with desired settings. </td></tr>
    <tr><td class="paramname">operating_mode</td><td>Desired final mode (0:Normal, 1:WOR Sending, 2:WOR Receiving, 3:Deep Sleep). </td></tr>
    <tr><td class="paramname">huart</td><td>The UART handle to use for communication. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">HAL_OK</td><td>Configuration commands were sent successfully. </td></tr>
    <tr><td class="paramname">HAL_ERROR</td><td>An invalid parameter or transmission error occurred. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="e220_8c_source.html#l00150">150</a> of file <a class="el" href="e220_8c_source.html">e220.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  151</span>{</div>
<div class="line"><span class="lineno">  152</span>    HAL_StatusTypeDef status = HAL_ERROR;</div>
<div class="line"><span class="lineno">  153</span>    <span class="keywordtype">char</span> cmd_buffer[64]; <span class="comment">// Buffer to build AT command strings</span></div>
<div class="line"><span class="lineno">  154</span> </div>
<div class="line"><span class="lineno">  155</span>    <span class="comment">// --- Step 1: Enter Configuration Mode (M1=1, M0=1) ---</span></div>
<div class="line"><span class="lineno">  156</span>    <span class="comment">// Ensure M0 and M1 are configured as output GPIOs in your .ioc file.</span></div>
<div class="line"><span class="lineno">  157</span>    HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf7fc5de46146a2b743ff5ec05be23550">E220_M0_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#ga75fd9bd265fb1038ec7dac3fb0d56d21">E220_M0_Pin</a>, GPIO_PIN_SET);</div>
<div class="line"><span class="lineno">  158</span>    HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf3cb0f47757e60d6887ddef28b414d0e">E220_M1_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaa9e756161b6c36fa79f6bdb124d3ad7d">E220_M1_Pin</a>, GPIO_PIN_SET);</div>
<div class="line"><span class="lineno">  159</span> </div>
<div class="line"><span class="lineno">  160</span>    <span class="comment">// Wait for the module to enter configuration mode.</span></div>
<div class="line"><span class="lineno">  161</span>    <span class="comment">// Datasheet suggests ~9-11ms for mode switching. Waiting for AUX rising edge is best.</span></div>
<div class="line"><span class="lineno">  162</span>    <span class="comment">// For simplicity in this template, we&#39;ll use a delay.</span></div>
<div class="line"><span class="lineno">  163</span>    HAL_Delay(20); <span class="comment">// Adjust delay based on testing if needed</span></div>
<div class="line"><span class="lineno">  164</span> </div>
<div class="line"><span class="lineno">  165</span>    <span class="comment">//wait for AUX to go high:</span></div>
<div class="line"><span class="lineno">  166</span>    <span class="keywordflow">while</span>(HAL_GPIO_ReadPin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#ga3ccf7e62c9aaa0d395afa89698ed3f3e">E220_AUX_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gacabcedcefba600a75d3bda90a597f8fa">E220_AUX_Pin</a>) == GPIO_PIN_RESET);</div>
<div class="line"><span class="lineno">  167</span>    HAL_Delay(2); <span class="comment">// Additional delay after AUX rising edge as per datasheet suggestion</span></div>
<div class="line"><span class="lineno">  168</span> </div>
<div class="line"><span class="lineno">  169</span>    <span class="comment">// In configuration mode, the UART baud rate is fixed at 9600 8N1 for AT commands.</span></div>
<div class="line"><span class="lineno">  170</span>    <span class="comment">// Ensure your microcontroller&#39;s UART is configured to 9600 8N1 before sending AT commands.</span></div>
<div class="line"><span class="lineno">  171</span> </div>
<div class="line"><span class="lineno">  172</span>    <span class="comment">// --- Step 2: Send AT Commands to Configure Parameters ---</span></div>
<div class="line"><span class="lineno">  173</span> </div>
<div class="line"><span class="lineno">  174</span>    <span class="comment">// Send AT+RESET (Optional, but good practice to start from a known state)</span></div>
<div class="line"><span class="lineno">  175</span>    status = <a class="code hl_function" href="group___e220___functions.html#ga85eb0844ac1fa6958cc1d33e216c22a4">E220_SendATCommand</a>(<span class="stringliteral">&quot;AT+RESET&quot;</span>,huart);</div>
<div class="line"><span class="lineno">  176</span>    <span class="keywordflow">if</span> (status != HAL_OK) <span class="keywordflow">return</span> status;</div>
<div class="line"><span class="lineno">  177</span>    <span class="comment">// Wait for module reset and response. Reset might take longer than other commands.</span></div>
<div class="line"><span class="lineno">  178</span>    <a class="code hl_function" href="group___e220___functions.html#gaacc524f6ca0831f6e5e603b79254430c">E220_WaitForResponse</a>(100);</div>
<div class="line"><span class="lineno">  179</span> </div>
<div class="line"><span class="lineno">  180</span>    <span class="comment">// Send AT+UART=baud,parity</span></div>
<div class="line"><span class="lineno">  181</span>    snprintf(cmd_buffer, <span class="keyword">sizeof</span>(cmd_buffer), <span class="stringliteral">&quot;AT+UART=%d,%d&quot;</span>, config-&gt;<a class="code hl_variable" href="struct_e220___config___a_t__t.html#aee3cb15c7bfe770c4b7f017b38ca9995">uart_baud_rate</a>, config-&gt;<a class="code hl_variable" href="struct_e220___config___a_t__t.html#a15c1b3eda867d78efd70f0a188ac8c1d">uart_parity</a>);</div>
<div class="line"><span class="lineno">  182</span>    status = <a class="code hl_function" href="group___e220___functions.html#ga85eb0844ac1fa6958cc1d33e216c22a4">E220_SendATCommand</a>(cmd_buffer,huart);</div>
<div class="line"><span class="lineno">  183</span>    <span class="keywordflow">if</span> (status != HAL_OK) <span class="keywordflow">return</span> status;</div>
<div class="line"><span class="lineno">  184</span>    <a class="code hl_function" href="group___e220___functions.html#gaacc524f6ca0831f6e5e603b79254430c">E220_WaitForResponse</a>(50); <span class="comment">// Wait for response</span></div>
<div class="line"><span class="lineno">  185</span> </div>
<div class="line"><span class="lineno">  186</span>    <span class="comment">// Send AT+RATE=rate</span></div>
<div class="line"><span class="lineno">  187</span>    snprintf(cmd_buffer, <span class="keyword">sizeof</span>(cmd_buffer), <span class="stringliteral">&quot;AT+RATE=%d&quot;</span>, config-&gt;<a class="code hl_variable" href="struct_e220___config___a_t__t.html#a2fd350c9448f81a4c8e85941b4829d63">air_data_rate</a>);</div>
<div class="line"><span class="lineno">  188</span>    status = <a class="code hl_function" href="group___e220___functions.html#ga85eb0844ac1fa6958cc1d33e216c22a4">E220_SendATCommand</a>(cmd_buffer,huart);</div>
<div class="line"><span class="lineno">  189</span>    <span class="keywordflow">if</span> (status != HAL_OK) <span class="keywordflow">return</span> status;</div>
<div class="line"><span class="lineno">  190</span>    <a class="code hl_function" href="group___e220___functions.html#gaacc524f6ca0831f6e5e603b79254430c">E220_WaitForResponse</a>(50); <span class="comment">// Wait for response</span></div>
<div class="line"><span class="lineno">  191</span> </div>
<div class="line"><span class="lineno">  192</span>    <span class="comment">// Send AT+PACKET=packet</span></div>
<div class="line"><span class="lineno">  193</span>    snprintf(cmd_buffer, <span class="keyword">sizeof</span>(cmd_buffer), <span class="stringliteral">&quot;AT+PACKET=%d&quot;</span>, config-&gt;<a class="code hl_variable" href="struct_e220___config___a_t__t.html#afe6dbd4989ff36ea5334a275e8082be5">sub_packet_setting</a>);</div>
<div class="line"><span class="lineno">  194</span>    status = <a class="code hl_function" href="group___e220___functions.html#ga85eb0844ac1fa6958cc1d33e216c22a4">E220_SendATCommand</a>(cmd_buffer,huart);</div>
<div class="line"><span class="lineno">  195</span>    <span class="keywordflow">if</span> (status != HAL_OK) <span class="keywordflow">return</span> status;</div>
<div class="line"><span class="lineno">  196</span>    <a class="code hl_function" href="group___e220___functions.html#gaacc524f6ca0831f6e5e603b79254430c">E220_WaitForResponse</a>(50); <span class="comment">// Wait for response</span></div>
<div class="line"><span class="lineno">  197</span> </div>
<div class="line"><span class="lineno">  198</span>    <span class="comment">// Send AT+WTIME=wtime</span></div>
<div class="line"><span class="lineno">  199</span>    snprintf(cmd_buffer, <span class="keyword">sizeof</span>(cmd_buffer), <span class="stringliteral">&quot;AT+WTIME=%d&quot;</span>, config-&gt;<a class="code hl_variable" href="struct_e220___config___a_t__t.html#aba81df8a0fa68c77860e7c63d8ab642f">wor_cycle</a>);</div>
<div class="line"><span class="lineno">  200</span>    status = <a class="code hl_function" href="group___e220___functions.html#ga85eb0844ac1fa6958cc1d33e216c22a4">E220_SendATCommand</a>(cmd_buffer,huart);</div>
<div class="line"><span class="lineno">  201</span>    <span class="keywordflow">if</span> (status != HAL_OK) <span class="keywordflow">return</span> status;</div>
<div class="line"><span class="lineno">  202</span>    <a class="code hl_function" href="group___e220___functions.html#gaacc524f6ca0831f6e5e603b79254430c">E220_WaitForResponse</a>(50); <span class="comment">// Wait for response</span></div>
<div class="line"><span class="lineno">  203</span> </div>
<div class="line"><span class="lineno">  204</span>    <span class="comment">// Send AT+POWER=power</span></div>
<div class="line"><span class="lineno">  205</span>    snprintf(cmd_buffer, <span class="keyword">sizeof</span>(cmd_buffer), <span class="stringliteral">&quot;AT+POWER=%d&quot;</span>, config-&gt;<a class="code hl_variable" href="struct_e220___config___a_t__t.html#ab97ec3fce2177ef3da0bc763616016cf">transmitting_power</a>);</div>
<div class="line"><span class="lineno">  206</span>    status = <a class="code hl_function" href="group___e220___functions.html#ga85eb0844ac1fa6958cc1d33e216c22a4">E220_SendATCommand</a>(cmd_buffer,huart);</div>
<div class="line"><span class="lineno">  207</span>    <span class="keywordflow">if</span> (status != HAL_OK) <span class="keywordflow">return</span> status;</div>
<div class="line"><span class="lineno">  208</span>    <a class="code hl_function" href="group___e220___functions.html#gaacc524f6ca0831f6e5e603b79254430c">E220_WaitForResponse</a>(50); <span class="comment">// Wait for response</span></div>
<div class="line"><span class="lineno">  209</span> </div>
<div class="line"><span class="lineno">  210</span>    <span class="comment">// Send AT+CHANNEL=channel</span></div>
<div class="line"><span class="lineno">  211</span>    snprintf(cmd_buffer, <span class="keyword">sizeof</span>(cmd_buffer), <span class="stringliteral">&quot;AT+CHANNEL=%d&quot;</span>, config-&gt;<a class="code hl_variable" href="struct_e220___config___a_t__t.html#ad52f46ff7e5b3191d61355837ee8911d">channel</a>);</div>
<div class="line"><span class="lineno">  212</span>    status = <a class="code hl_function" href="group___e220___functions.html#ga85eb0844ac1fa6958cc1d33e216c22a4">E220_SendATCommand</a>(cmd_buffer,huart);</div>
<div class="line"><span class="lineno">  213</span>    <span class="keywordflow">if</span> (status != HAL_OK) <span class="keywordflow">return</span> status;</div>
<div class="line"><span class="lineno">  214</span>    <a class="code hl_function" href="group___e220___functions.html#gaacc524f6ca0831f6e5e603b79254430c">E220_WaitForResponse</a>(50); <span class="comment">// Wait for response</span></div>
<div class="line"><span class="lineno">  215</span> </div>
<div class="line"><span class="lineno">  216</span>    <span class="comment">// Send AT+DRSSI=data_rssi</span></div>
<div class="line"><span class="lineno">  217</span>    snprintf(cmd_buffer, <span class="keyword">sizeof</span>(cmd_buffer), <span class="stringliteral">&quot;AT+DRSSI=%d&quot;</span>, config-&gt;<a class="code hl_variable" href="struct_e220___config___a_t__t.html#a766ca310bf13f66f10f3875c5d17f289">rssi_byte_enable</a> ? 1 : 0);</div>
<div class="line"><span class="lineno">  218</span>    status = <a class="code hl_function" href="group___e220___functions.html#ga85eb0844ac1fa6958cc1d33e216c22a4">E220_SendATCommand</a>(cmd_buffer,huart);</div>
<div class="line"><span class="lineno">  219</span>    <span class="keywordflow">if</span> (status != HAL_OK) <span class="keywordflow">return</span> status;</div>
<div class="line"><span class="lineno">  220</span>    <a class="code hl_function" href="group___e220___functions.html#gaacc524f6ca0831f6e5e603b79254430c">E220_WaitForResponse</a>(50); <span class="comment">// Wait for response</span></div>
<div class="line"><span class="lineno">  221</span> </div>
<div class="line"><span class="lineno">  222</span>    <span class="comment">// Send AT+TRANS=trans</span></div>
<div class="line"><span class="lineno">  223</span>    snprintf(cmd_buffer, <span class="keyword">sizeof</span>(cmd_buffer), <span class="stringliteral">&quot;AT+TRANS=%d&quot;</span>, config-&gt;<a class="code hl_variable" href="struct_e220___config___a_t__t.html#a723299e3bfe38cb987f8126bc7e28c1b">transmission_method</a> ? 1 : 0);</div>
<div class="line"><span class="lineno">  224</span>    status = <a class="code hl_function" href="group___e220___functions.html#ga85eb0844ac1fa6958cc1d33e216c22a4">E220_SendATCommand</a>(cmd_buffer,huart);</div>
<div class="line"><span class="lineno">  225</span>    <span class="keywordflow">if</span> (status != HAL_OK) <span class="keywordflow">return</span> status;</div>
<div class="line"><span class="lineno">  226</span>    <a class="code hl_function" href="group___e220___functions.html#gaacc524f6ca0831f6e5e603b79254430c">E220_WaitForResponse</a>(50); <span class="comment">// Wait for response</span></div>
<div class="line"><span class="lineno">  227</span> </div>
<div class="line"><span class="lineno">  228</span>    <span class="comment">// Send AT+LBT=lbt</span></div>
<div class="line"><span class="lineno">  229</span>    snprintf(cmd_buffer, <span class="keyword">sizeof</span>(cmd_buffer), <span class="stringliteral">&quot;AT+LBT=%d&quot;</span>, config-&gt;<a class="code hl_variable" href="struct_e220___config___a_t__t.html#a610be3c587060b3bae292da534fc9504">lbt_enable</a> ? 1 : 0);</div>
<div class="line"><span class="lineno">  230</span>    status = <a class="code hl_function" href="group___e220___functions.html#ga85eb0844ac1fa6958cc1d33e216c22a4">E220_SendATCommand</a>(cmd_buffer,huart);</div>
<div class="line"><span class="lineno">  231</span>    <span class="keywordflow">if</span> (status != HAL_OK) <span class="keywordflow">return</span> status;</div>
<div class="line"><span class="lineno">  232</span>    <a class="code hl_function" href="group___e220___functions.html#gaacc524f6ca0831f6e5e603b79254430c">E220_WaitForResponse</a>(50); <span class="comment">// Wait for response</span></div>
<div class="line"><span class="lineno">  233</span> </div>
<div class="line"><span class="lineno">  234</span>    <span class="comment">// Send AT+ADDR=addr</span></div>
<div class="line"><span class="lineno">  235</span>    snprintf(cmd_buffer, <span class="keyword">sizeof</span>(cmd_buffer), <span class="stringliteral">&quot;AT+ADDR=%d&quot;</span>, config-&gt;<a class="code hl_variable" href="struct_e220___config___a_t__t.html#a01b17bdb5a2f349bd3408eea389df19f">address</a>);</div>
<div class="line"><span class="lineno">  236</span>    status = <a class="code hl_function" href="group___e220___functions.html#ga85eb0844ac1fa6958cc1d33e216c22a4">E220_SendATCommand</a>(cmd_buffer,huart);</div>
<div class="line"><span class="lineno">  237</span>    <span class="keywordflow">if</span> (status != HAL_OK) <span class="keywordflow">return</span> status;</div>
<div class="line"><span class="lineno">  238</span>    <a class="code hl_function" href="group___e220___functions.html#gaacc524f6ca0831f6e5e603b79254430c">E220_WaitForResponse</a>(50); <span class="comment">// Wait for response</span></div>
<div class="line"><span class="lineno">  239</span> </div>
<div class="line"><span class="lineno">  240</span>    <span class="comment">// Send AT+KEY=key</span></div>
<div class="line"><span class="lineno">  241</span>    snprintf(cmd_buffer, <span class="keyword">sizeof</span>(cmd_buffer), <span class="stringliteral">&quot;AT+KEY=%d&quot;</span>, config-&gt;<a class="code hl_variable" href="struct_e220___config___a_t__t.html#aaab1236db8f8a20065753d54c6ccbf24">crypt_key</a>);</div>
<div class="line"><span class="lineno">  242</span>    status = <a class="code hl_function" href="group___e220___functions.html#ga85eb0844ac1fa6958cc1d33e216c22a4">E220_SendATCommand</a>(cmd_buffer,huart);</div>
<div class="line"><span class="lineno">  243</span>    <span class="keywordflow">if</span> (status != HAL_OK) <span class="keywordflow">return</span> status;</div>
<div class="line"><span class="lineno">  244</span>    <a class="code hl_function" href="group___e220___functions.html#gaacc524f6ca0831f6e5e603b79254430c">E220_WaitForResponse</a>(50); <span class="comment">// Wait for response</span></div>
<div class="line"><span class="lineno">  245</span> </div>
<div class="line"><span class="lineno">  246</span>    <span class="comment">// Send AT+DELAY=delay</span></div>
<div class="line"><span class="lineno">  247</span>    snprintf(cmd_buffer, <span class="keyword">sizeof</span>(cmd_buffer), <span class="stringliteral">&quot;AT+DELAY=%d&quot;</span>, config-&gt;<a class="code hl_variable" href="struct_e220___config___a_t__t.html#adb2ed4242d245054299e1ce57f1821f5">wor_delay</a>);</div>
<div class="line"><span class="lineno">  248</span>    status = <a class="code hl_function" href="group___e220___functions.html#ga85eb0844ac1fa6958cc1d33e216c22a4">E220_SendATCommand</a>(cmd_buffer,huart);</div>
<div class="line"><span class="lineno">  249</span>    <span class="keywordflow">if</span> (status != HAL_OK) <span class="keywordflow">return</span> status;</div>
<div class="line"><span class="lineno">  250</span>    <a class="code hl_function" href="group___e220___functions.html#gaacc524f6ca0831f6e5e603b79254430c">E220_WaitForResponse</a>(50); <span class="comment">// Wait for response</span></div>
<div class="line"><span class="lineno">  251</span> </div>
<div class="line"><span class="lineno">  252</span>    <span class="comment">// Send AT+SWITCH=switch</span></div>
<div class="line"><span class="lineno">  253</span>    snprintf(cmd_buffer, <span class="keyword">sizeof</span>(cmd_buffer), <span class="stringliteral">&quot;AT+SWITCH=%d&quot;</span>, config-&gt;<a class="code hl_variable" href="struct_e220___config___a_t__t.html#a0af34004ac64c4bbeb778933499699d4">software_switching_enable</a> ? 1 : 0);</div>
<div class="line"><span class="lineno">  254</span>    status = <a class="code hl_function" href="group___e220___functions.html#ga85eb0844ac1fa6958cc1d33e216c22a4">E220_SendATCommand</a>(cmd_buffer,huart);</div>
<div class="line"><span class="lineno">  255</span>    <span class="keywordflow">if</span> (status != HAL_OK) <span class="keywordflow">return</span> status;</div>
<div class="line"><span class="lineno">  256</span>    <a class="code hl_function" href="group___e220___functions.html#gaacc524f6ca0831f6e5e603b79254430c">E220_WaitForResponse</a>(50); <span class="comment">// Wait for response</span></div>
<div class="line"><span class="lineno">  257</span> </div>
<div class="line"><span class="lineno">  258</span>    <span class="comment">// Send AT+UAUX=uaux</span></div>
<div class="line"><span class="lineno">  259</span>    snprintf(cmd_buffer, <span class="keyword">sizeof</span>(cmd_buffer), <span class="stringliteral">&quot;AT+UAUX=%d&quot;</span>, config-&gt;<a class="code hl_variable" href="struct_e220___config___a_t__t.html#aefe299e04076667a96ff168f1f8fb6a7">aux_indication_mode</a>);</div>
<div class="line"><span class="lineno">  260</span>    status = <a class="code hl_function" href="group___e220___functions.html#ga85eb0844ac1fa6958cc1d33e216c22a4">E220_SendATCommand</a>(cmd_buffer,huart);</div>
<div class="line"><span class="lineno">  261</span>    <span class="keywordflow">if</span> (status != HAL_OK) <span class="keywordflow">return</span> status;</div>
<div class="line"><span class="lineno">  262</span>    <a class="code hl_function" href="group___e220___functions.html#gaacc524f6ca0831f6e5e603b79254430c">E220_WaitForResponse</a>(50); <span class="comment">// Wait for response</span></div>
<div class="line"><span class="lineno">  263</span> </div>
<div class="line"><span class="lineno">  264</span> </div>
<div class="line"><span class="lineno">  265</span>    <span class="comment">// --- Step 3: Exit Configuration Mode and Enter Desired Operating Mode ---</span></div>
<div class="line"><span class="lineno">  266</span>    <span class="comment">// Set M0 and M1 to the desired operating mode.</span></div>
<div class="line"><span class="lineno">  267</span>    <span class="comment">// 0: Normal (M0=0, M1=0)</span></div>
<div class="line"><span class="lineno">  268</span>    <span class="comment">// 1: WOR Sending (M0=0, M1=1)</span></div>
<div class="line"><span class="lineno">  269</span>    <span class="comment">// 2: WOR Receiving (M0=1, M1=0)</span></div>
<div class="line"><span class="lineno">  270</span>    <span class="comment">// 3: Deep Sleep (M0=1, M1=1)</span></div>
<div class="line"><span class="lineno">  271</span> </div>
<div class="line"><span class="lineno">  272</span>    GPIO_PinState m0_state = GPIO_PIN_RESET;</div>
<div class="line"><span class="lineno">  273</span>    GPIO_PinState m1_state = GPIO_PIN_RESET;</div>
<div class="line"><span class="lineno">  274</span> </div>
<div class="line"><span class="lineno">  275</span>    <span class="keywordflow">switch</span>(operating_mode)</div>
<div class="line"><span class="lineno">  276</span>    {</div>
<div class="line"><span class="lineno">  277</span>        <span class="keywordflow">case</span> 0: <span class="comment">// Normal Mode (M0=0, M1=0)</span></div>
<div class="line"><span class="lineno">  278</span>            m0_state = GPIO_PIN_RESET;</div>
<div class="line"><span class="lineno">  279</span>            m1_state = GPIO_PIN_RESET;</div>
<div class="line"><span class="lineno">  280</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  281</span>        <span class="keywordflow">case</span> 1: <span class="comment">// WOR Sending Mode (M0=0, M1=1)</span></div>
<div class="line"><span class="lineno">  282</span>            m0_state = GPIO_PIN_RESET;</div>
<div class="line"><span class="lineno">  283</span>            m1_state = GPIO_PIN_SET;</div>
<div class="line"><span class="lineno">  284</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  285</span>        <span class="keywordflow">case</span> 2: <span class="comment">// WOR Receiving Mode (M0=1, M1=0)</span></div>
<div class="line"><span class="lineno">  286</span>            m0_state = GPIO_PIN_SET;</div>
<div class="line"><span class="lineno">  287</span>            m1_state = GPIO_PIN_RESET;</div>
<div class="line"><span class="lineno">  288</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  289</span>        <span class="keywordflow">case</span> 3: <span class="comment">// Deep Sleep Mode (M0=1, M1=1)</span></div>
<div class="line"><span class="lineno">  290</span>            m0_state = GPIO_PIN_SET;</div>
<div class="line"><span class="lineno">  291</span>            m1_state = GPIO_PIN_SET;</div>
<div class="line"><span class="lineno">  292</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  293</span>        <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  294</span>            <span class="comment">// Invalid operating mode, handle error</span></div>
<div class="line"><span class="lineno">  295</span>            <span class="keywordflow">return</span> HAL_ERROR;</div>
<div class="line"><span class="lineno">  296</span>    }</div>
<div class="line"><span class="lineno">  297</span> </div>
<div class="line"><span class="lineno">  298</span>    HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf7fc5de46146a2b743ff5ec05be23550">E220_M0_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#ga75fd9bd265fb1038ec7dac3fb0d56d21">E220_M0_Pin</a>, m0_state);</div>
<div class="line"><span class="lineno">  299</span>    HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf3cb0f47757e60d6887ddef28b414d0e">E220_M1_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaa9e756161b6c36fa79f6bdb124d3ad7d">E220_M1_Pin</a>, m1_state);</div>
<div class="line"><span class="lineno">  300</span> </div>
<div class="line"><span class="lineno">  301</span>    <span class="comment">// Wait for the module to switch modes (wait for AUX rising edge).</span></div>
<div class="line"><span class="lineno">  302</span>    <span class="keywordflow">while</span>(HAL_GPIO_ReadPin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#ga3ccf7e62c9aaa0d395afa89698ed3f3e">E220_AUX_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gacabcedcefba600a75d3bda90a597f8fa">E220_AUX_Pin</a>) == GPIO_PIN_RESET);</div>
<div class="line"><span class="lineno">  303</span>    HAL_Delay(2); <span class="comment">// Additional delay after AUX rising edge</span></div>
<div class="line"><span class="lineno">  304</span> </div>
<div class="line"><span class="lineno">  305</span>    <span class="keywordflow">return</span> HAL_OK; <span class="comment">// Indicate commands were sent (response success not verified in this template)</span></div>
<div class="line"><span class="lineno">  306</span>}</div>
<div class="ttc" id="agroup___e220___functions_html_gaacc524f6ca0831f6e5e603b79254430c"><div class="ttname"><a href="group___e220___functions.html#gaacc524f6ca0831f6e5e603b79254430c">E220_WaitForResponse</a></div><div class="ttdeci">bool E220_WaitForResponse(uint32_t timeout_ms)</div><div class="ttdoc">Waits for a response from the E220 module after sending an AT command.</div><div class="ttdef"><b>Definition</b> <a href="e220_8c_source.html#l00099">e220.c:99</a></div></div>
<div class="ttc" id="astruct_e220___config___a_t__t_html_a01b17bdb5a2f349bd3408eea389df19f"><div class="ttname"><a href="struct_e220___config___a_t__t.html#a01b17bdb5a2f349bd3408eea389df19f">E220_Config_AT_t::address</a></div><div class="ttdeci">uint16_t address</div><div class="ttdoc">Module Address (0-65535) (AT+ADDR).</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00104">e220.h:104</a></div></div>
<div class="ttc" id="astruct_e220___config___a_t__t_html_a0af34004ac64c4bbeb778933499699d4"><div class="ttname"><a href="struct_e220___config___a_t__t.html#a0af34004ac64c4bbeb778933499699d4">E220_Config_AT_t::software_switching_enable</a></div><div class="ttdeci">bool software_switching_enable</div><div class="ttdoc">Software Switching Mode (0:off, 1:on) (AT+SWITCH).</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00117">e220.h:117</a></div></div>
<div class="ttc" id="astruct_e220___config___a_t__t_html_a15c1b3eda867d78efd70f0a188ac8c1d"><div class="ttname"><a href="struct_e220___config___a_t__t.html#a15c1b3eda867d78efd70f0a188ac8c1d">E220_Config_AT_t::uart_parity</a></div><div class="ttdeci">uint8_t uart_parity</div><div class="ttdoc">UART Parity Bit index (0-3) (AT+UART).</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00106">e220.h:106</a></div></div>
<div class="ttc" id="astruct_e220___config___a_t__t_html_a2fd350c9448f81a4c8e85941b4829d63"><div class="ttname"><a href="struct_e220___config___a_t__t.html#a2fd350c9448f81a4c8e85941b4829d63">E220_Config_AT_t::air_data_rate</a></div><div class="ttdeci">uint8_t air_data_rate</div><div class="ttdoc">Air Data Rate index (0-7) (AT+RATE).</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00107">e220.h:107</a></div></div>
<div class="ttc" id="astruct_e220___config___a_t__t_html_a610be3c587060b3bae292da534fc9504"><div class="ttname"><a href="struct_e220___config___a_t__t.html#a610be3c587060b3bae292da534fc9504">E220_Config_AT_t::lbt_enable</a></div><div class="ttdeci">bool lbt_enable</div><div class="ttdoc">LBT Enable (0:off, 1:on) (AT+LBT).</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00114">e220.h:114</a></div></div>
<div class="ttc" id="astruct_e220___config___a_t__t_html_a723299e3bfe38cb987f8126bc7e28c1b"><div class="ttname"><a href="struct_e220___config___a_t__t.html#a723299e3bfe38cb987f8126bc7e28c1b">E220_Config_AT_t::transmission_method</a></div><div class="ttdeci">bool transmission_method</div><div class="ttdoc">Transmission Method (0:transparent, 1:fixed) (AT+TRANS).</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00113">e220.h:113</a></div></div>
<div class="ttc" id="astruct_e220___config___a_t__t_html_a766ca310bf13f66f10f3875c5d17f289"><div class="ttname"><a href="struct_e220___config___a_t__t.html#a766ca310bf13f66f10f3875c5d17f289">E220_Config_AT_t::rssi_byte_enable</a></div><div class="ttdeci">bool rssi_byte_enable</div><div class="ttdoc">Enable RSSI Byte (0:off, 1:on) (AT+DRSSI).</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00112">e220.h:112</a></div></div>
<div class="ttc" id="astruct_e220___config___a_t__t_html_aaab1236db8f8a20065753d54c6ccbf24"><div class="ttname"><a href="struct_e220___config___a_t__t.html#aaab1236db8f8a20065753d54c6ccbf24">E220_Config_AT_t::crypt_key</a></div><div class="ttdeci">uint16_t crypt_key</div><div class="ttdoc">Communication encryption key (0-65535) (AT+KEY).</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00115">e220.h:115</a></div></div>
<div class="ttc" id="astruct_e220___config___a_t__t_html_ab97ec3fce2177ef3da0bc763616016cf"><div class="ttname"><a href="struct_e220___config___a_t__t.html#ab97ec3fce2177ef3da0bc763616016cf">E220_Config_AT_t::transmitting_power</a></div><div class="ttdeci">uint8_t transmitting_power</div><div class="ttdoc">Transmitting Power index (0-3) (AT+POWER).</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00110">e220.h:110</a></div></div>
<div class="ttc" id="astruct_e220___config___a_t__t_html_aba81df8a0fa68c77860e7c63d8ab642f"><div class="ttname"><a href="struct_e220___config___a_t__t.html#aba81df8a0fa68c77860e7c63d8ab642f">E220_Config_AT_t::wor_cycle</a></div><div class="ttdeci">uint8_t wor_cycle</div><div class="ttdoc">WOR Cycle index (0-7) (AT+WTIME).</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00109">e220.h:109</a></div></div>
<div class="ttc" id="astruct_e220___config___a_t__t_html_ad52f46ff7e5b3191d61355837ee8911d"><div class="ttname"><a href="struct_e220___config___a_t__t.html#ad52f46ff7e5b3191d61355837ee8911d">E220_Config_AT_t::channel</a></div><div class="ttdeci">uint8_t channel</div><div class="ttdoc">Channel Control (0-83) (AT+CHANNEL).</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00111">e220.h:111</a></div></div>
<div class="ttc" id="astruct_e220___config___a_t__t_html_adb2ed4242d245054299e1ce57f1821f5"><div class="ttname"><a href="struct_e220___config___a_t__t.html#adb2ed4242d245054299e1ce57f1821f5">E220_Config_AT_t::wor_delay</a></div><div class="ttdeci">uint16_t wor_delay</div><div class="ttdoc">WOR delayed sleep time (0-65535) (AT+DELAY).</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00116">e220.h:116</a></div></div>
<div class="ttc" id="astruct_e220___config___a_t__t_html_aee3cb15c7bfe770c4b7f017b38ca9995"><div class="ttname"><a href="struct_e220___config___a_t__t.html#aee3cb15c7bfe770c4b7f017b38ca9995">E220_Config_AT_t::uart_baud_rate</a></div><div class="ttdeci">uint8_t uart_baud_rate</div><div class="ttdoc">UART Baud Rate index (0-7) (AT+UART).</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00105">e220.h:105</a></div></div>
<div class="ttc" id="astruct_e220___config___a_t__t_html_aefe299e04076667a96ff168f1f8fb6a7"><div class="ttname"><a href="struct_e220___config___a_t__t.html#aefe299e04076667a96ff168f1f8fb6a7">E220_Config_AT_t::aux_indication_mode</a></div><div class="ttdeci">uint8_t aux_indication_mode</div><div class="ttdoc">AUX indication mode (0:Serial buffer empty, 1:TX complete) (AT+UAUX).</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00118">e220.h:118</a></div></div>
<div class="ttc" id="astruct_e220___config___a_t__t_html_afe6dbd4989ff36ea5334a275e8082be5"><div class="ttname"><a href="struct_e220___config___a_t__t.html#afe6dbd4989ff36ea5334a275e8082be5">E220_Config_AT_t::sub_packet_setting</a></div><div class="ttdeci">uint8_t sub_packet_setting</div><div class="ttdoc">Sub-Packet Setting index (0-3) (AT+PACKET).</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00108">e220.h:108</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="e220_8h_source.html#l00104">E220_Config_AT_t::address</a>, <a class="el" href="e220_8h_source.html#l00107">E220_Config_AT_t::air_data_rate</a>, <a class="el" href="e220_8h_source.html#l00118">E220_Config_AT_t::aux_indication_mode</a>, <a class="el" href="e220_8h_source.html#l00111">E220_Config_AT_t::channel</a>, <a class="el" href="e220_8h_source.html#l00115">E220_Config_AT_t::crypt_key</a>, <a class="el" href="e220_8h_source.html#l00037">E220_AUX_GPIO_Port</a>, <a class="el" href="e220_8h_source.html#l00038">E220_AUX_Pin</a>, <a class="el" href="e220_8h_source.html#l00033">E220_M0_GPIO_Port</a>, <a class="el" href="e220_8h_source.html#l00034">E220_M0_Pin</a>, <a class="el" href="e220_8h_source.html#l00035">E220_M1_GPIO_Port</a>, <a class="el" href="e220_8h_source.html#l00036">E220_M1_Pin</a>, <a class="el" href="e220_8c_source.html#l00077">E220_SendATCommand()</a>, <a class="el" href="e220_8c_source.html#l00099">E220_WaitForResponse()</a>, <a class="el" href="e220_8h_source.html#l00114">E220_Config_AT_t::lbt_enable</a>, <a class="el" href="e220_8h_source.html#l00112">E220_Config_AT_t::rssi_byte_enable</a>, <a class="el" href="e220_8h_source.html#l00117">E220_Config_AT_t::software_switching_enable</a>, <a class="el" href="e220_8h_source.html#l00108">E220_Config_AT_t::sub_packet_setting</a>, <a class="el" href="e220_8h_source.html#l00113">E220_Config_AT_t::transmission_method</a>, <a class="el" href="e220_8h_source.html#l00110">E220_Config_AT_t::transmitting_power</a>, <a class="el" href="e220_8h_source.html#l00105">E220_Config_AT_t::uart_baud_rate</a>, <a class="el" href="e220_8h_source.html#l00106">E220_Config_AT_t::uart_parity</a>, <a class="el" href="e220_8h_source.html#l00109">E220_Config_AT_t::wor_cycle</a>, and <a class="el" href="e220_8h_source.html#l00116">E220_Config_AT_t::wor_delay</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group___e220___functions_ga86dc5a312335e4578acbace6165ae9bb_cgraph.png" border="0" usemap="#agroup___e220___functions_ga86dc5a312335e4578acbace6165ae9bb_cgraph" alt=""/></div>
<map name="agroup___e220___functions_ga86dc5a312335e4578acbace6165ae9bb_cgraph" id="agroup___e220___functions_ga86dc5a312335e4578acbace6165ae9bb_cgraph">
<area shape="rect" title="Initializes the E220 LoRa module using AT commands." alt="" coords="5,31,105,57"/>
<area shape="rect" href="group___e220___functions.html#ga85eb0844ac1fa6958cc1d33e216c22a4" title="Sends an AT command string to the E220 module via UART DMA." alt="" coords="153,5,317,32"/>
<area shape="poly" title=" " alt="" coords="105,34,137,30,137,35,106,40"/>
<area shape="rect" href="group___e220___functions.html#gaacc524f6ca0831f6e5e603b79254430c" title="Waits for a response from the E220 module after sending an AT command." alt="" coords="154,56,316,83"/>
<area shape="poly" title=" " alt="" coords="106,48,139,53,138,58,105,54"/>
</map>
</div>

</div>
</div>
<a id="ga48dabee77440c9bce39d6f67542b476e" name="ga48dabee77440c9bce39d6f67542b476e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga48dabee77440c9bce39d6f67542b476e">&#9670;&#160;</a></span>E220_ReadConfiguration_RegisterMode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HAL_StatusTypeDef E220_ReadConfiguration_RegisterMode </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_e220___module_config___register__t.html">E220_ModuleConfig_Register_t</a> *&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">UART_HandleTypeDef *&#160;</td>
          <td class="paramname"><em>huart</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reads the E220 module configuration using direct register reads. </p>
<p>Handles switching to config mode, sending the 0xC1 read command, parsing the response into the <code>config</code> struct, and returning to normal mode. </p><dl class="section note"><dt>Note</dt><dd>Assumes UART is 9600 8N1 during config. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">config</td><td>Pointer to a structure where the read configuration will be stored. </td></tr>
    <tr><td class="paramname">huart</td><td>Pointer to the UART handle for communication. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">HAL_OK</td><td>on success, HAL_ERROR or HAL_TIMEOUT on failure. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="e220_8c_source.html#l00438">438</a> of file <a class="el" href="e220_8c_source.html">e220.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  438</span>                                                                                                                       {</div>
<div class="line"><span class="lineno">  439</span>    <span class="keywordflow">if</span> (config == NULL || huart == NULL) {</div>
<div class="line"><span class="lineno">  440</span>        <span class="keywordflow">return</span> HAL_ERROR; <span class="comment">// Invalid arguments</span></div>
<div class="line"><span class="lineno">  441</span>    }</div>
<div class="line"><span class="lineno">  442</span> </div>
<div class="line"><span class="lineno">  443</span>    HAL_StatusTypeDef status = HAL_OK;</div>
<div class="line"><span class="lineno">  444</span>    uint8_t command_buffer[3]; <span class="comment">// CMD, StartAddr, Length</span></div>
<div class="line"><span class="lineno">  445</span>    uint8_t response_buffer[3 + <a class="code hl_define" href="group___e220___register___addresses.html#gad567441046080b4943635a6940e29b80">E220_CONFIG_REGS_LENGTH</a>]; <span class="comment">// Expected: C1, StartAddr, Length, Data...</span></div>
<div class="line"><span class="lineno">  446</span> </div>
<div class="line"><span class="lineno">  447</span>    <span class="comment">// --- Step 1: Enter Configuration Mode (M0=1, M1=1) ---</span></div>
<div class="line"><span class="lineno">  448</span>    HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf7fc5de46146a2b743ff5ec05be23550">E220_M0_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#ga75fd9bd265fb1038ec7dac3fb0d56d21">E220_M0_Pin</a>, GPIO_PIN_SET);</div>
<div class="line"><span class="lineno">  449</span>    HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf3cb0f47757e60d6887ddef28b414d0e">E220_M1_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaa9e756161b6c36fa79f6bdb124d3ad7d">E220_M1_Pin</a>, GPIO_PIN_SET);</div>
<div class="line"><span class="lineno">  450</span><span class="preprocessor">#if defined(USE_FREERTOS) &amp;&amp; USE_FREERTOS == 1</span></div>
<div class="line"><span class="lineno">  451</span>    osDelay(10);</div>
<div class="line"><span class="lineno">  452</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  453</span>    HAL_Delay(10);</div>
<div class="line"><span class="lineno">  454</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  455</span> </div>
<div class="line"><span class="lineno">  456</span>    status = <a class="code hl_function" href="group___e220___functions.html#ga5186d6d328aac24762acef26c46744a3">E220_WaitAuxHigh</a>(1000);</div>
<div class="line"><span class="lineno">  457</span>    <span class="keywordflow">if</span> (status != HAL_OK) {</div>
<div class="line"><span class="lineno">  458</span>        HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf7fc5de46146a2b743ff5ec05be23550">E220_M0_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#ga75fd9bd265fb1038ec7dac3fb0d56d21">E220_M0_Pin</a>, GPIO_PIN_RESET);</div>
<div class="line"><span class="lineno">  459</span>        HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf3cb0f47757e60d6887ddef28b414d0e">E220_M1_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaa9e756161b6c36fa79f6bdb124d3ad7d">E220_M1_Pin</a>, GPIO_PIN_RESET);</div>
<div class="line"><span class="lineno">  460</span>        <span class="keywordflow">return</span> status;</div>
<div class="line"><span class="lineno">  461</span>    }</div>
<div class="line"><span class="lineno">  462</span><span class="preprocessor">#if defined(USE_FREERTOS) &amp;&amp; USE_FREERTOS == 1</span></div>
<div class="line"><span class="lineno">  463</span>    osDelay(2);</div>
<div class="line"><span class="lineno">  464</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  465</span>    HAL_Delay(2);</div>
<div class="line"><span class="lineno">  466</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  467</span> </div>
<div class="line"><span class="lineno">  468</span>    <span class="comment">// --- Step 2: Prepare Read Command ---</span></div>
<div class="line"><span class="lineno">  469</span>    command_buffer[0] = 0xC1; <span class="comment">// Read parameters command</span></div>
<div class="line"><span class="lineno">  470</span>    command_buffer[1] = <a class="code hl_define" href="group___e220___register___addresses.html#ga0237a21d465ee9418149a1f59bb30bb8">E220_CONFIG_REGS_START_ADDR</a>;</div>
<div class="line"><span class="lineno">  471</span>    command_buffer[2] = <a class="code hl_define" href="group___e220___register___addresses.html#gad567441046080b4943635a6940e29b80">E220_CONFIG_REGS_LENGTH</a>;</div>
<div class="line"><span class="lineno">  472</span> </div>
<div class="line"><span class="lineno">  473</span>    <span class="comment">// --- Step 3: Transmit Read Command ---</span></div>
<div class="line"><span class="lineno">  474</span><span class="preprocessor">#if defined(USE_FREERTOS) &amp;&amp; USE_FREERTOS == 1</span></div>
<div class="line"><span class="lineno">  475</span>    osDelay(2);</div>
<div class="line"><span class="lineno">  476</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  477</span>    HAL_Delay(2);</div>
<div class="line"><span class="lineno">  478</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  479</span>    status = HAL_UART_Transmit(huart, command_buffer, <span class="keyword">sizeof</span>(command_buffer), 100);</div>
<div class="line"><span class="lineno">  480</span>    <span class="keywordflow">if</span> (status != HAL_OK) {</div>
<div class="line"><span class="lineno">  481</span>        HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf7fc5de46146a2b743ff5ec05be23550">E220_M0_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#ga75fd9bd265fb1038ec7dac3fb0d56d21">E220_M0_Pin</a>, GPIO_PIN_RESET);</div>
<div class="line"><span class="lineno">  482</span>        HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf3cb0f47757e60d6887ddef28b414d0e">E220_M1_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaa9e756161b6c36fa79f6bdb124d3ad7d">E220_M1_Pin</a>, GPIO_PIN_RESET);</div>
<div class="line"><span class="lineno">  483</span>        <span class="keywordflow">return</span> status;</div>
<div class="line"><span class="lineno">  484</span>    }</div>
<div class="line"><span class="lineno">  485</span> </div>
<div class="line"><span class="lineno">  486</span>    <span class="comment">// --- Step 4: Wait for AUX High (Module processes command and prepares data) ---</span></div>
<div class="line"><span class="lineno">  487</span>    status = <a class="code hl_function" href="group___e220___functions.html#ga5186d6d328aac24762acef26c46744a3">E220_WaitAuxHigh</a>(1000);</div>
<div class="line"><span class="lineno">  488</span>    <span class="keywordflow">if</span> (status != HAL_OK) {</div>
<div class="line"><span class="lineno">  489</span>        HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf7fc5de46146a2b743ff5ec05be23550">E220_M0_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#ga75fd9bd265fb1038ec7dac3fb0d56d21">E220_M0_Pin</a>, GPIO_PIN_RESET);</div>
<div class="line"><span class="lineno">  490</span>        HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf3cb0f47757e60d6887ddef28b414d0e">E220_M1_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaa9e756161b6c36fa79f6bdb124d3ad7d">E220_M1_Pin</a>, GPIO_PIN_RESET);</div>
<div class="line"><span class="lineno">  491</span>        <span class="keywordflow">return</span> status;</div>
<div class="line"><span class="lineno">  492</span>    }</div>
<div class="line"><span class="lineno">  493</span><span class="preprocessor">#if defined(USE_FREERTOS) &amp;&amp; USE_FREERTOS == 1</span></div>
<div class="line"><span class="lineno">  494</span>    osDelay(2);</div>
<div class="line"><span class="lineno">  495</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  496</span>    HAL_Delay(2);</div>
<div class="line"><span class="lineno">  497</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  498</span> </div>
<div class="line"><span class="lineno">  499</span>    <span class="comment">// --- Step 5: Receive Response ---</span></div>
<div class="line"><span class="lineno">  500</span>    status = HAL_UART_Receive(huart, response_buffer, <span class="keyword">sizeof</span>(response_buffer), 100);</div>
<div class="line"><span class="lineno">  501</span>    <span class="keywordflow">if</span> (status != HAL_OK) {</div>
<div class="line"><span class="lineno">  502</span>        HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf7fc5de46146a2b743ff5ec05be23550">E220_M0_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#ga75fd9bd265fb1038ec7dac3fb0d56d21">E220_M0_Pin</a>, GPIO_PIN_RESET);</div>
<div class="line"><span class="lineno">  503</span>        HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf3cb0f47757e60d6887ddef28b414d0e">E220_M1_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaa9e756161b6c36fa79f6bdb124d3ad7d">E220_M1_Pin</a>, GPIO_PIN_RESET);</div>
<div class="line"><span class="lineno">  504</span>        <span class="keywordflow">return</span> status;</div>
<div class="line"><span class="lineno">  505</span>    }</div>
<div class="line"><span class="lineno">  506</span> </div>
<div class="line"><span class="lineno">  507</span>    <span class="comment">// --- Step 6: Validate and Parse Response ---</span></div>
<div class="line"><span class="lineno">  508</span>    <span class="keywordflow">if</span> (response_buffer[0] != 0xC1 || response_buffer[1] != <a class="code hl_define" href="group___e220___register___addresses.html#ga0237a21d465ee9418149a1f59bb30bb8">E220_CONFIG_REGS_START_ADDR</a> || response_buffer[2] != <a class="code hl_define" href="group___e220___register___addresses.html#gad567441046080b4943635a6940e29b80">E220_CONFIG_REGS_LENGTH</a>) {</div>
<div class="line"><span class="lineno">  509</span>        HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf7fc5de46146a2b743ff5ec05be23550">E220_M0_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#ga75fd9bd265fb1038ec7dac3fb0d56d21">E220_M0_Pin</a>, GPIO_PIN_RESET);</div>
<div class="line"><span class="lineno">  510</span>        HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf3cb0f47757e60d6887ddef28b414d0e">E220_M1_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaa9e756161b6c36fa79f6bdb124d3ad7d">E220_M1_Pin</a>, GPIO_PIN_RESET);</div>
<div class="line"><span class="lineno">  511</span>        <span class="keywordflow">return</span> HAL_ERROR; <span class="comment">// Response header mismatch</span></div>
<div class="line"><span class="lineno">  512</span>    }</div>
<div class="line"><span class="lineno">  513</span> </div>
<div class="line"><span class="lineno">  514</span>    <span class="comment">// Parse data into config struct</span></div>
<div class="line"><span class="lineno">  515</span>    uint8_t* data = &amp;response_buffer[3];</div>
<div class="line"><span class="lineno">  516</span>    config-&gt;<a class="code hl_variable" href="struct_e220___module_config___register__t.html#a5f8cd7bbe7a2abdf7ed56abb77610450">address</a> = ((uint16_t)data[0] &lt;&lt; 8) | data[1]; <span class="comment">// ADDH, ADDL</span></div>
<div class="line"><span class="lineno">  517</span> </div>
<div class="line"><span class="lineno">  518</span>    <span class="comment">// REG0</span></div>
<div class="line"><span class="lineno">  519</span>    config-&gt;<a class="code hl_variable" href="struct_e220___module_config___register__t.html#a6728b3f588c68c77baa88dfc4da757a6">uart_baud_rate_idx</a> = (data[2] &gt;&gt; 5) &amp; 0x07;</div>
<div class="line"><span class="lineno">  520</span>    config-&gt;<a class="code hl_variable" href="struct_e220___module_config___register__t.html#a95c32f30a20ffd67d7b4e0c0b5b7e98d">uart_parity_idx</a>    = (data[2] &gt;&gt; 3) &amp; 0x03;</div>
<div class="line"><span class="lineno">  521</span>    config-&gt;<a class="code hl_variable" href="struct_e220___module_config___register__t.html#a8df261cfdee903df1d83219ee3fefd57">air_data_rate_idx</a>  = data[2] &amp; 0x07;</div>
<div class="line"><span class="lineno">  522</span> </div>
<div class="line"><span class="lineno">  523</span>    <span class="comment">// REG1</span></div>
<div class="line"><span class="lineno">  524</span>    config-&gt;<a class="code hl_variable" href="struct_e220___module_config___register__t.html#ad59bca7cf3264f23f6bb641a595ccf07">subpacket_size_idx</a>        = (data[3] &gt;&gt; 6) &amp; 0x03;</div>
<div class="line"><span class="lineno">  525</span>    config-&gt;<a class="code hl_variable" href="struct_e220___module_config___register__t.html#a67361d0110965c8b6dd5e240588ccceb">rssi_ambient_noise_enable</a> = (data[3] &gt;&gt; 5) &amp; 0x01;</div>
<div class="line"><span class="lineno">  526</span>    <span class="comment">// Bit 4 is reserved</span></div>
<div class="line"><span class="lineno">  527</span>    config-&gt;<a class="code hl_variable" href="struct_e220___module_config___register__t.html#a0e7cc25817153244848a0b587872c884">transmitting_power_idx</a>    = data[3] &amp; 0x03;</div>
<div class="line"><span class="lineno">  528</span> </div>
<div class="line"><span class="lineno">  529</span>    <span class="comment">// REG2</span></div>
<div class="line"><span class="lineno">  530</span>    <span class="comment">// Bit 7 is reserved</span></div>
<div class="line"><span class="lineno">  531</span>    config-&gt;<a class="code hl_variable" href="struct_e220___module_config___register__t.html#a80f505c49efdedd9ff2bc8cdc17db033">channel</a> = data[4] &amp; 0x7F;</div>
<div class="line"><span class="lineno">  532</span> </div>
<div class="line"><span class="lineno">  533</span>    <span class="comment">// REG3</span></div>
<div class="line"><span class="lineno">  534</span>    config-&gt;<a class="code hl_variable" href="struct_e220___module_config___register__t.html#a6023ebc3ccf973dc82d9d5627e4c885a">rssi_byte_enable</a>        = (data[5] &gt;&gt; 7) &amp; 0x01;</div>
<div class="line"><span class="lineno">  535</span>    config-&gt;<a class="code hl_variable" href="struct_e220___module_config___register__t.html#ad943465bd6e4557a8ba1917a46871823">transmission_method</a>     = (data[5] &gt;&gt; 6) &amp; 0x01;</div>
<div class="line"><span class="lineno">  536</span>    config-&gt;<a class="code hl_variable" href="struct_e220___module_config___register__t.html#a29546f5415a1cc454fe5cd23e60f4e06">repeater_enable</a>         = (data[5] &gt;&gt; 5) &amp; 0x01;</div>
<div class="line"><span class="lineno">  537</span>    config-&gt;<a class="code hl_variable" href="struct_e220___module_config___register__t.html#ad1fad4b7e2d5eaf528fc4c7f67b16547">lbt_enable</a>              = (data[5] &gt;&gt; 4) &amp; 0x01;</div>
<div class="line"><span class="lineno">  538</span>    config-&gt;<a class="code hl_variable" href="struct_e220___module_config___register__t.html#a3e57874e6952d042cee9d6119c6af07f">wor_transmitter_control</a> = (data[5] &gt;&gt; 3) &amp; 0x01;</div>
<div class="line"><span class="lineno">  539</span>    config-&gt;<a class="code hl_variable" href="struct_e220___module_config___register__t.html#a80d061f00c2e1ad65c0730dbf91afc41">wor_cycle_idx</a>           = data[5] &amp; 0x07;</div>
<div class="line"><span class="lineno">  540</span> </div>
<div class="line"><span class="lineno">  541</span>    config-&gt;<a class="code hl_variable" href="struct_e220___module_config___register__t.html#aed106281d8b312cb752058abc9673771">net_id</a> = data[6];</div>
<div class="line"><span class="lineno">  542</span> </div>
<div class="line"><span class="lineno">  543</span>    <span class="comment">// --- Step 7: Exit Configuration Mode (Return to Normal Mode M0=0, M1=0) ---</span></div>
<div class="line"><span class="lineno">  544</span>    HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf7fc5de46146a2b743ff5ec05be23550">E220_M0_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#ga75fd9bd265fb1038ec7dac3fb0d56d21">E220_M0_Pin</a>, GPIO_PIN_RESET);</div>
<div class="line"><span class="lineno">  545</span>    HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf3cb0f47757e60d6887ddef28b414d0e">E220_M1_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaa9e756161b6c36fa79f6bdb124d3ad7d">E220_M1_Pin</a>, GPIO_PIN_RESET);</div>
<div class="line"><span class="lineno">  546</span><span class="preprocessor">#if defined(USE_FREERTOS) &amp;&amp; USE_FREERTOS == 1</span></div>
<div class="line"><span class="lineno">  547</span>    osDelay(10);</div>
<div class="line"><span class="lineno">  548</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  549</span>    HAL_Delay(10);</div>
<div class="line"><span class="lineno">  550</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  551</span> </div>
<div class="line"><span class="lineno">  552</span>    status = <a class="code hl_function" href="group___e220___functions.html#ga5186d6d328aac24762acef26c46744a3">E220_WaitAuxHigh</a>(1000);</div>
<div class="line"><span class="lineno">  553</span><span class="preprocessor">#if defined(USE_FREERTOS) &amp;&amp; USE_FREERTOS == 1</span></div>
<div class="line"><span class="lineno">  554</span>    osDelay(2);</div>
<div class="line"><span class="lineno">  555</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  556</span>    HAL_Delay(2);</div>
<div class="line"><span class="lineno">  557</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  558</span>    <span class="keywordflow">return</span> status;</div>
<div class="line"><span class="lineno">  559</span>}</div>
<div class="ttc" id="agroup___e220___functions_html_ga5186d6d328aac24762acef26c46744a3"><div class="ttname"><a href="group___e220___functions.html#ga5186d6d328aac24762acef26c46744a3">E220_WaitAuxHigh</a></div><div class="ttdeci">HAL_StatusTypeDef E220_WaitAuxHigh(uint32_t timeout)</div><div class="ttdoc">Waits for the E220's AUX pin to go to a HIGH state.</div><div class="ttdef"><b>Definition</b> <a href="e220_8c_source.html#l00020">e220.c:20</a></div></div>
<div class="ttc" id="agroup___e220___register___addresses_html_ga0237a21d465ee9418149a1f59bb30bb8"><div class="ttname"><a href="group___e220___register___addresses.html#ga0237a21d465ee9418149a1f59bb30bb8">E220_CONFIG_REGS_START_ADDR</a></div><div class="ttdeci">#define E220_CONFIG_REGS_START_ADDR</div><div class="ttdoc">Starting address for a full config block read/write.</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00056">e220.h:56</a></div></div>
<div class="ttc" id="agroup___e220___register___addresses_html_gad567441046080b4943635a6940e29b80"><div class="ttname"><a href="group___e220___register___addresses.html#gad567441046080b4943635a6940e29b80">E220_CONFIG_REGS_LENGTH</a></div><div class="ttdeci">#define E220_CONFIG_REGS_LENGTH</div><div class="ttdoc">Total length of the config register block (7 bytes).</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00057">e220.h:57</a></div></div>
<div class="ttc" id="astruct_e220___module_config___register__t_html_a0e7cc25817153244848a0b587872c884"><div class="ttname"><a href="struct_e220___module_config___register__t.html#a0e7cc25817153244848a0b587872c884">E220_ModuleConfig_Register_t::transmitting_power_idx</a></div><div class="ttdeci">uint8_t transmitting_power_idx</div><div class="ttdoc">Transmitting power index (0-3). See datasheet (e.g., 0: 30dBm).</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00081">e220.h:81</a></div></div>
<div class="ttc" id="astruct_e220___module_config___register__t_html_a29546f5415a1cc454fe5cd23e60f4e06"><div class="ttname"><a href="struct_e220___module_config___register__t.html#a29546f5415a1cc454fe5cd23e60f4e06">E220_ModuleConfig_Register_t::repeater_enable</a></div><div class="ttdeci">uint8_t repeater_enable</div><div class="ttdoc">Enable repeater mode (0:Disable, 1:Enable).</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00089">e220.h:89</a></div></div>
<div class="ttc" id="astruct_e220___module_config___register__t_html_a3e57874e6952d042cee9d6119c6af07f"><div class="ttname"><a href="struct_e220___module_config___register__t.html#a3e57874e6952d042cee9d6119c6af07f">E220_ModuleConfig_Register_t::wor_transmitter_control</a></div><div class="ttdeci">uint8_t wor_transmitter_control</div><div class="ttdoc">WOR control (0: Normal/WOR Receiver, 1: WOR Transmitter).</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00091">e220.h:91</a></div></div>
<div class="ttc" id="astruct_e220___module_config___register__t_html_a5f8cd7bbe7a2abdf7ed56abb77610450"><div class="ttname"><a href="struct_e220___module_config___register__t.html#a5f8cd7bbe7a2abdf7ed56abb77610450">E220_ModuleConfig_Register_t::address</a></div><div class="ttdeci">uint16_t address</div><div class="ttdoc">Module address (0-65535).</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00070">e220.h:70</a></div></div>
<div class="ttc" id="astruct_e220___module_config___register__t_html_a6023ebc3ccf973dc82d9d5627e4c885a"><div class="ttname"><a href="struct_e220___module_config___register__t.html#a6023ebc3ccf973dc82d9d5627e4c885a">E220_ModuleConfig_Register_t::rssi_byte_enable</a></div><div class="ttdeci">uint8_t rssi_byte_enable</div><div class="ttdoc">Enable RSSI byte in data packet (0:Disable, 1:Enable).</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00087">e220.h:87</a></div></div>
<div class="ttc" id="astruct_e220___module_config___register__t_html_a6728b3f588c68c77baa88dfc4da757a6"><div class="ttname"><a href="struct_e220___module_config___register__t.html#a6728b3f588c68c77baa88dfc4da757a6">E220_ModuleConfig_Register_t::uart_baud_rate_idx</a></div><div class="ttdeci">uint8_t uart_baud_rate_idx</div><div class="ttdoc">UART Baud Rate index (0-7). See datasheet (e.g., 7: 115200).</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00074">e220.h:74</a></div></div>
<div class="ttc" id="astruct_e220___module_config___register__t_html_a67361d0110965c8b6dd5e240588ccceb"><div class="ttname"><a href="struct_e220___module_config___register__t.html#a67361d0110965c8b6dd5e240588ccceb">E220_ModuleConfig_Register_t::rssi_ambient_noise_enable</a></div><div class="ttdeci">uint8_t rssi_ambient_noise_enable</div><div class="ttdoc">Enable RSSI ambient noise (0:Disable, 1:Enable).</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00080">e220.h:80</a></div></div>
<div class="ttc" id="astruct_e220___module_config___register__t_html_a80d061f00c2e1ad65c0730dbf91afc41"><div class="ttname"><a href="struct_e220___module_config___register__t.html#a80d061f00c2e1ad65c0730dbf91afc41">E220_ModuleConfig_Register_t::wor_cycle_idx</a></div><div class="ttdeci">uint8_t wor_cycle_idx</div><div class="ttdoc">WOR cycle index (0-7). See datasheet (e.g., 0: 500ms).</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00092">e220.h:92</a></div></div>
<div class="ttc" id="astruct_e220___module_config___register__t_html_a80f505c49efdedd9ff2bc8cdc17db033"><div class="ttname"><a href="struct_e220___module_config___register__t.html#a80f505c49efdedd9ff2bc8cdc17db033">E220_ModuleConfig_Register_t::channel</a></div><div class="ttdeci">uint8_t channel</div><div class="ttdoc">RF Channel (e.g., 0-83 for 900M).</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00084">e220.h:84</a></div></div>
<div class="ttc" id="astruct_e220___module_config___register__t_html_a8df261cfdee903df1d83219ee3fefd57"><div class="ttname"><a href="struct_e220___module_config___register__t.html#a8df261cfdee903df1d83219ee3fefd57">E220_ModuleConfig_Register_t::air_data_rate_idx</a></div><div class="ttdeci">uint8_t air_data_rate_idx</div><div class="ttdoc">Air Data Rate index (0-7). See datasheet (e.g., 7: 62.5k).</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00076">e220.h:76</a></div></div>
<div class="ttc" id="astruct_e220___module_config___register__t_html_a95c32f30a20ffd67d7b4e0c0b5b7e98d"><div class="ttname"><a href="struct_e220___module_config___register__t.html#a95c32f30a20ffd67d7b4e0c0b5b7e98d">E220_ModuleConfig_Register_t::uart_parity_idx</a></div><div class="ttdeci">uint8_t uart_parity_idx</div><div class="ttdoc">UART Parity index (0-2). (e.g., 0: 8N1).</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00075">e220.h:75</a></div></div>
<div class="ttc" id="astruct_e220___module_config___register__t_html_ad1fad4b7e2d5eaf528fc4c7f67b16547"><div class="ttname"><a href="struct_e220___module_config___register__t.html#ad1fad4b7e2d5eaf528fc4c7f67b16547">E220_ModuleConfig_Register_t::lbt_enable</a></div><div class="ttdeci">uint8_t lbt_enable</div><div class="ttdoc">Enable Listen Before Talk (LBT) (0:Disable, 1:Enable).</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00090">e220.h:90</a></div></div>
<div class="ttc" id="astruct_e220___module_config___register__t_html_ad59bca7cf3264f23f6bb641a595ccf07"><div class="ttname"><a href="struct_e220___module_config___register__t.html#ad59bca7cf3264f23f6bb641a595ccf07">E220_ModuleConfig_Register_t::subpacket_size_idx</a></div><div class="ttdeci">uint8_t subpacket_size_idx</div><div class="ttdoc">Subpacket size index (0-3). (e.g., 0: 240B/200B).</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00079">e220.h:79</a></div></div>
<div class="ttc" id="astruct_e220___module_config___register__t_html_ad943465bd6e4557a8ba1917a46871823"><div class="ttname"><a href="struct_e220___module_config___register__t.html#ad943465bd6e4557a8ba1917a46871823">E220_ModuleConfig_Register_t::transmission_method</a></div><div class="ttdeci">uint8_t transmission_method</div><div class="ttdoc">Transmission method (0:Transparent, 1:Fixed/Direct).</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00088">e220.h:88</a></div></div>
<div class="ttc" id="astruct_e220___module_config___register__t_html_aed106281d8b312cb752058abc9673771"><div class="ttname"><a href="struct_e220___module_config___register__t.html#aed106281d8b312cb752058abc9673771">E220_ModuleConfig_Register_t::net_id</a></div><div class="ttdeci">uint8_t net_id</div><div class="ttdoc">Network ID (0-255).</div><div class="ttdef"><b>Definition</b> <a href="e220_8h_source.html#l00071">e220.h:71</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="e220_8h_source.html#l00070">E220_ModuleConfig_Register_t::address</a>, <a class="el" href="e220_8h_source.html#l00076">E220_ModuleConfig_Register_t::air_data_rate_idx</a>, <a class="el" href="e220_8h_source.html#l00084">E220_ModuleConfig_Register_t::channel</a>, <a class="el" href="e220_8h_source.html#l00057">E220_CONFIG_REGS_LENGTH</a>, <a class="el" href="e220_8h_source.html#l00056">E220_CONFIG_REGS_START_ADDR</a>, <a class="el" href="e220_8h_source.html#l00033">E220_M0_GPIO_Port</a>, <a class="el" href="e220_8h_source.html#l00034">E220_M0_Pin</a>, <a class="el" href="e220_8h_source.html#l00035">E220_M1_GPIO_Port</a>, <a class="el" href="e220_8h_source.html#l00036">E220_M1_Pin</a>, <a class="el" href="e220_8c_source.html#l00020">E220_WaitAuxHigh()</a>, <a class="el" href="e220_8h_source.html#l00090">E220_ModuleConfig_Register_t::lbt_enable</a>, <a class="el" href="e220_8h_source.html#l00071">E220_ModuleConfig_Register_t::net_id</a>, <a class="el" href="e220_8h_source.html#l00089">E220_ModuleConfig_Register_t::repeater_enable</a>, <a class="el" href="e220_8h_source.html#l00080">E220_ModuleConfig_Register_t::rssi_ambient_noise_enable</a>, <a class="el" href="e220_8h_source.html#l00087">E220_ModuleConfig_Register_t::rssi_byte_enable</a>, <a class="el" href="e220_8h_source.html#l00079">E220_ModuleConfig_Register_t::subpacket_size_idx</a>, <a class="el" href="e220_8h_source.html#l00088">E220_ModuleConfig_Register_t::transmission_method</a>, <a class="el" href="e220_8h_source.html#l00081">E220_ModuleConfig_Register_t::transmitting_power_idx</a>, <a class="el" href="e220_8h_source.html#l00074">E220_ModuleConfig_Register_t::uart_baud_rate_idx</a>, <a class="el" href="e220_8h_source.html#l00075">E220_ModuleConfig_Register_t::uart_parity_idx</a>, <a class="el" href="e220_8h_source.html#l00092">E220_ModuleConfig_Register_t::wor_cycle_idx</a>, and <a class="el" href="e220_8h_source.html#l00091">E220_ModuleConfig_Register_t::wor_transmitter_control</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group___e220___functions_ga48dabee77440c9bce39d6f67542b476e_cgraph.png" border="0" usemap="#agroup___e220___functions_ga48dabee77440c9bce39d6f67542b476e_cgraph" alt=""/></div>
<map name="agroup___e220___functions_ga48dabee77440c9bce39d6f67542b476e_cgraph" id="agroup___e220___functions_ga48dabee77440c9bce39d6f67542b476e_cgraph">
<area shape="rect" title="Reads the E220 module configuration using direct register reads." alt="" coords="5,5,172,48"/>
<area shape="rect" href="group___e220___functions.html#ga5186d6d328aac24762acef26c46744a3" title="Waits for the E220&#39;s AUX pin to go to a HIGH state." alt="" coords="220,13,354,40"/>
<area shape="poly" title=" " alt="" coords="172,24,204,24,204,29,172,29"/>
</map>
</div>

</div>
</div>
<a id="ga85eb0844ac1fa6958cc1d33e216c22a4" name="ga85eb0844ac1fa6958cc1d33e216c22a4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga85eb0844ac1fa6958cc1d33e216c22a4">&#9670;&#160;</a></span>E220_SendATCommand()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HAL_StatusTypeDef E220_SendATCommand </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>command</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">UART_HandleTypeDef&#160;</td>
          <td class="paramname"><em>huart</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sends an AT command string to the E220 module via UART DMA. </p>
<p>Assumes module is in AT command mode (M0=1, M1=1) and UART is 9600 8N1. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">command</td><td>Null-terminated string containing the AT command (e.g., "AT+RESET"). </td></tr>
    <tr><td class="paramname">huart</td><td>The UART handle to use for transmission. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">HAL_StatusTypeDef</td><td>Status of the HAL_UART_Transmit_DMA operation. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="e220_8c_source.html#l00077">77</a> of file <a class="el" href="e220_8c_source.html">e220.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   78</span>{</div>
<div class="line"><span class="lineno">   79</span>    <span class="comment">// AT commands typically end with CR+LF (\r\n)</span></div>
<div class="line"><span class="lineno">   80</span>    <span class="keywordtype">char</span> cmd_buffer[64]; <span class="comment">// Adjust size as needed for longest command + termination</span></div>
<div class="line"><span class="lineno">   81</span>    <span class="keywordtype">int</span> len = snprintf(cmd_buffer, <span class="keyword">sizeof</span>(cmd_buffer), <span class="stringliteral">&quot;%s&quot;</span>, command);</div>
<div class="line"><span class="lineno">   82</span> </div>
<div class="line"><span class="lineno">   83</span>    <span class="keywordflow">if</span> (len &lt; 0 || len &gt;= <span class="keyword">sizeof</span>(cmd_buffer))</div>
<div class="line"><span class="lineno">   84</span>    {</div>
<div class="line"><span class="lineno">   85</span>        <span class="comment">// Handle buffer overflow or encoding error</span></div>
<div class="line"><span class="lineno">   86</span>        <span class="keywordflow">return</span> HAL_ERROR;</div>
<div class="line"><span class="lineno">   87</span>    }</div>
<div class="line"><span class="lineno">   88</span> </div>
<div class="line"><span class="lineno">   89</span>    <span class="comment">// Send the command buffer using DMA</span></div>
<div class="line"><span class="lineno">   90</span>    <span class="comment">// This is non-blocking. You would typically wait for TX completion</span></div>
<div class="line"><span class="lineno">   91</span>    <span class="comment">// and/or the module&#39;s response after calling this.</span></div>
<div class="line"><span class="lineno">   92</span>    <span class="keywordflow">return</span> HAL_UART_Transmit_DMA(&amp;huart, (uint8_t*)cmd_buffer, len);</div>
<div class="line"><span class="lineno">   93</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="e220_8c_source.html#l00118">E220_Change_Channel()</a>, and <a class="el" href="e220_8c_source.html#l00150">E220_Init_AT()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group___e220___functions_ga85eb0844ac1fa6958cc1d33e216c22a4_icgraph.png" border="0" usemap="#agroup___e220___functions_ga85eb0844ac1fa6958cc1d33e216c22a4_icgraph" alt=""/></div>
<map name="agroup___e220___functions_ga85eb0844ac1fa6958cc1d33e216c22a4_icgraph" id="agroup___e220___functions_ga85eb0844ac1fa6958cc1d33e216c22a4_icgraph">
<area shape="rect" title="Sends an AT command string to the E220 module via UART DMA." alt="" coords="212,31,376,57"/>
<area shape="rect" href="group___e220___functions.html#ga9505f517c8ff3613aa6222c6fad705b7" title="Changes the E220&#39;s operating channel using an AT command." alt="" coords="5,5,164,32"/>
<area shape="poly" title=" " alt="" coords="196,35,164,31,165,26,197,30"/>
<area shape="rect" href="group___e220___functions.html#ga86dc5a312335e4578acbace6165ae9bb" title="Initializes the E220 LoRa module using AT commands." alt="" coords="35,56,134,83"/>
<area shape="poly" title=" " alt="" coords="197,58,135,66,134,61,196,53"/>
</map>
</div>

</div>
</div>
<a id="gade15c0ad644c38f7c962a45d21bf52f9" name="gade15c0ad644c38f7c962a45d21bf52f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gade15c0ad644c38f7c962a45d21bf52f9">&#9670;&#160;</a></span>E220_SetConfiguration_RegisterMode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HAL_StatusTypeDef E220_SetConfiguration_RegisterMode </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_e220___module_config___register__t.html">E220_ModuleConfig_Register_t</a> *&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">UART_HandleTypeDef *&#160;</td>
          <td class="paramname"><em>huart</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets the E220 configuration using direct register writes. </p>
<p>Handles switching to config mode, sending the 0xC0 write command with data from the <code>config</code> struct, and returning to normal mode. </p><dl class="section note"><dt>Note</dt><dd>Assumes UART is 9600 8N1 during config. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">config</td><td>Pointer to the <code><a class="el" href="struct_e220___module_config___register__t.html" title="Represents the E220 module&#39;s configuration based on its direct register map.">E220_ModuleConfig_Register_t</a></code> structure with desired settings. </td></tr>
    <tr><td class="paramname">huart</td><td>Pointer to the UART handle for communication. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">HAL_OK</td><td>Configuration written and verified successfully. </td></tr>
    <tr><td class="paramname">HAL_ERROR</td><td>or <code>HAL_TIMEOUT</code> Failed to write, verify, or time out. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="e220_8c_source.html#l00309">309</a> of file <a class="el" href="e220_8c_source.html">e220.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  309</span>                                                                                                                            {</div>
<div class="line"><span class="lineno">  310</span>    <span class="keywordflow">if</span> (config == NULL || huart == NULL) {</div>
<div class="line"><span class="lineno">  311</span>        <span class="keywordflow">return</span> HAL_ERROR; <span class="comment">// Invalid arguments</span></div>
<div class="line"><span class="lineno">  312</span>    }</div>
<div class="line"><span class="lineno">  313</span> </div>
<div class="line"><span class="lineno">  314</span>    HAL_StatusTypeDef status = HAL_OK;</div>
<div class="line"><span class="lineno">  315</span>    uint8_t command_buffer[3 + <a class="code hl_define" href="group___e220___register___addresses.html#gad567441046080b4943635a6940e29b80">E220_CONFIG_REGS_LENGTH</a>]; <span class="comment">// CMD, ADDR, LEN + Data</span></div>
<div class="line"><span class="lineno">  316</span>    uint8_t response_buffer[3 + <a class="code hl_define" href="group___e220___register___addresses.html#gad567441046080b4943635a6940e29b80">E220_CONFIG_REGS_LENGTH</a>];</div>
<div class="line"><span class="lineno">  317</span> </div>
<div class="line"><span class="lineno">  318</span>    <span class="comment">// --- Step 1: Enter Configuration Mode (M0=1, M1=1) ---</span></div>
<div class="line"><span class="lineno">  319</span>    HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf7fc5de46146a2b743ff5ec05be23550">E220_M0_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#ga75fd9bd265fb1038ec7dac3fb0d56d21">E220_M0_Pin</a>, GPIO_PIN_SET);</div>
<div class="line"><span class="lineno">  320</span>    HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf3cb0f47757e60d6887ddef28b414d0e">E220_M1_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaa9e756161b6c36fa79f6bdb124d3ad7d">E220_M1_Pin</a>, GPIO_PIN_SET);</div>
<div class="line"><span class="lineno">  321</span><span class="preprocessor">#if defined(USE_FREERTOS) &amp;&amp; USE_FREERTOS == 1</span></div>
<div class="line"><span class="lineno">  322</span>    osDelay(10); <span class="comment">// Allow time for pins to settle and module to react (e.g. 4ms + buffer)</span></div>
<div class="line"><span class="lineno">  323</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  324</span>    HAL_Delay(10);</div>
<div class="line"><span class="lineno">  325</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  326</span> </div>
<div class="line"><span class="lineno">  327</span>    status = <a class="code hl_function" href="group___e220___functions.html#ga5186d6d328aac24762acef26c46744a3">E220_WaitAuxHigh</a>(1000);</div>
<div class="line"><span class="lineno">  328</span>    <span class="keywordflow">if</span> (status != HAL_OK) {</div>
<div class="line"><span class="lineno">  329</span>        <span class="comment">// Failed to enter config mode or AUX not responding</span></div>
<div class="line"><span class="lineno">  330</span>        HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf7fc5de46146a2b743ff5ec05be23550">E220_M0_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#ga75fd9bd265fb1038ec7dac3fb0d56d21">E220_M0_Pin</a>, GPIO_PIN_RESET); <span class="comment">// Revert to Normal Mode</span></div>
<div class="line"><span class="lineno">  331</span>        HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf3cb0f47757e60d6887ddef28b414d0e">E220_M1_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaa9e756161b6c36fa79f6bdb124d3ad7d">E220_M1_Pin</a>, GPIO_PIN_RESET);</div>
<div class="line"><span class="lineno">  332</span>        <span class="keywordflow">return</span> status; <span class="comment">// HAL_TIMEOUT or other error</span></div>
<div class="line"><span class="lineno">  333</span>    }</div>
<div class="line"><span class="lineno">  334</span><span class="preprocessor">#if defined(USE_FREERTOS) &amp;&amp; USE_FREERTOS == 1</span></div>
<div class="line"><span class="lineno">  335</span>    osDelay(2); <span class="comment">// Short delay after AUX high</span></div>
<div class="line"><span class="lineno">  336</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  337</span>    HAL_Delay(2);</div>
<div class="line"><span class="lineno">  338</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  339</span> </div>
<div class="line"><span class="lineno">  340</span>    <span class="comment">// --- Step 2: Prepare Command Buffer ---</span></div>
<div class="line"><span class="lineno">  341</span>    <span class="comment">// Command: 0xC0, StartAddr (0x00), Length (0x07), Data...</span></div>
<div class="line"><span class="lineno">  342</span>    command_buffer[0] = 0xC0; <span class="comment">// Write parameters and save to EEPROM</span></div>
<div class="line"><span class="lineno">  343</span>    command_buffer[1] = <a class="code hl_define" href="group___e220___register___addresses.html#ga0237a21d465ee9418149a1f59bb30bb8">E220_CONFIG_REGS_START_ADDR</a>;</div>
<div class="line"><span class="lineno">  344</span>    command_buffer[2] = <a class="code hl_define" href="group___e220___register___addresses.html#gad567441046080b4943635a6940e29b80">E220_CONFIG_REGS_LENGTH</a>;</div>
<div class="line"><span class="lineno">  345</span> </div>
<div class="line"><span class="lineno">  346</span>    command_buffer[3] = (config-&gt;<a class="code hl_variable" href="struct_e220___module_config___register__t.html#a5f8cd7bbe7a2abdf7ed56abb77610450">address</a> &gt;&gt; 8) &amp; 0xFF; <span class="comment">// ADDH</span></div>
<div class="line"><span class="lineno">  347</span>    command_buffer[4] = config-&gt;<a class="code hl_variable" href="struct_e220___module_config___register__t.html#a5f8cd7bbe7a2abdf7ed56abb77610450">address</a> &amp; 0xFF;        <span class="comment">// ADDL</span></div>
<div class="line"><span class="lineno">  348</span> </div>
<div class="line"><span class="lineno">  349</span>    <span class="comment">// REG0 (UART Baud, Parity, Air Data Rate)</span></div>
<div class="line"><span class="lineno">  350</span>    command_buffer[5] = (config-&gt;<a class="code hl_variable" href="struct_e220___module_config___register__t.html#a6728b3f588c68c77baa88dfc4da757a6">uart_baud_rate_idx</a> &lt;&lt; 5) |</div>
<div class="line"><span class="lineno">  351</span>                        (config-&gt;<a class="code hl_variable" href="struct_e220___module_config___register__t.html#a95c32f30a20ffd67d7b4e0c0b5b7e98d">uart_parity_idx</a> &lt;&lt; 3)    |</div>
<div class="line"><span class="lineno">  352</span>                        (config-&gt;<a class="code hl_variable" href="struct_e220___module_config___register__t.html#a8df261cfdee903df1d83219ee3fefd57">air_data_rate_idx</a> &amp; 0x07);</div>
<div class="line"><span class="lineno">  353</span> </div>
<div class="line"><span class="lineno">  354</span>    <span class="comment">// REG1 (Subpacket, RSSI Noise Enable, Tx Power - Bit 4 is reserved, assumed 0)</span></div>
<div class="line"><span class="lineno">  355</span>    command_buffer[6] = (config-&gt;<a class="code hl_variable" href="struct_e220___module_config___register__t.html#ad59bca7cf3264f23f6bb641a595ccf07">subpacket_size_idx</a> &lt;&lt; 6)        |</div>
<div class="line"><span class="lineno">  356</span>                        (config-&gt;<a class="code hl_variable" href="struct_e220___module_config___register__t.html#a67361d0110965c8b6dd5e240588ccceb">rssi_ambient_noise_enable</a> &lt;&lt; 5) |</div>
<div class="line"><span class="lineno">  357</span>                        <span class="comment">// Bit 4 is reserved (keep 0 as per most datasheets)</span></div>
<div class="line"><span class="lineno">  358</span>                        (config-&gt;<a class="code hl_variable" href="struct_e220___module_config___register__t.html#a0e7cc25817153244848a0b587872c884">transmitting_power_idx</a> &amp; 0x03);</div>
<div class="line"><span class="lineno">  359</span> </div>
<div class="line"><span class="lineno">  360</span>    <span class="comment">// REG2 (Channel - Bit 7 is reserved, assumed 0)</span></div>
<div class="line"><span class="lineno">  361</span>    command_buffer[7] = (config-&gt;<a class="code hl_variable" href="struct_e220___module_config___register__t.html#a80f505c49efdedd9ff2bc8cdc17db033">channel</a> &amp; 0x7F); <span class="comment">// Bit 7 reserved</span></div>
<div class="line"><span class="lineno">  362</span> </div>
<div class="line"><span class="lineno">  363</span>    <span class="comment">// REG3 (RSSI Enable, Tx Method, Repeater, LBT, WOR Control, WOR Cycle)</span></div>
<div class="line"><span class="lineno">  364</span>    command_buffer[8] = (config-&gt;<a class="code hl_variable" href="struct_e220___module_config___register__t.html#a6023ebc3ccf973dc82d9d5627e4c885a">rssi_byte_enable</a> &lt;&lt; 7)        |</div>
<div class="line"><span class="lineno">  365</span>                        (config-&gt;<a class="code hl_variable" href="struct_e220___module_config___register__t.html#ad943465bd6e4557a8ba1917a46871823">transmission_method</a> &lt;&lt; 6)     |</div>
<div class="line"><span class="lineno">  366</span>                        (config-&gt;<a class="code hl_variable" href="struct_e220___module_config___register__t.html#a29546f5415a1cc454fe5cd23e60f4e06">repeater_enable</a> &lt;&lt; 5)         |</div>
<div class="line"><span class="lineno">  367</span>                        (config-&gt;<a class="code hl_variable" href="struct_e220___module_config___register__t.html#ad1fad4b7e2d5eaf528fc4c7f67b16547">lbt_enable</a> &lt;&lt; 4)              |</div>
<div class="line"><span class="lineno">  368</span>                        (config-&gt;<a class="code hl_variable" href="struct_e220___module_config___register__t.html#a3e57874e6952d042cee9d6119c6af07f">wor_transmitter_control</a> &lt;&lt; 3) |</div>
<div class="line"><span class="lineno">  369</span>                        (config-&gt;<a class="code hl_variable" href="struct_e220___module_config___register__t.html#a80d061f00c2e1ad65c0730dbf91afc41">wor_cycle_idx</a> &amp; 0x07);</div>
<div class="line"><span class="lineno">  370</span> </div>
<div class="line"><span class="lineno">  371</span>    command_buffer[9] = config-&gt;<a class="code hl_variable" href="struct_e220___module_config___register__t.html#aed106281d8b312cb752058abc9673771">net_id</a>; <span class="comment">// NETID</span></div>
<div class="line"><span class="lineno">  372</span> </div>
<div class="line"><span class="lineno">  373</span>    <span class="comment">// --- Step 3: Transmit Command ---</span></div>
<div class="line"><span class="lineno">  374</span>    <span class="comment">// Ensure UART is 9600 8N1 for Configuration Mode. This is caller&#39;s responsibility</span></div>
<div class="line"><span class="lineno">  375</span>    <span class="comment">// or reconfigure UART here if necessary.</span></div>
<div class="line"><span class="lineno">  376</span><span class="preprocessor">#if defined(USE_FREERTOS) &amp;&amp; USE_FREERTOS == 1</span></div>
<div class="line"><span class="lineno">  377</span>    osDelay(2); <span class="comment">// Small delay before transmission</span></div>
<div class="line"><span class="lineno">  378</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  379</span>    HAL_Delay(2);</div>
<div class="line"><span class="lineno">  380</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  381</span>    status = HAL_UART_Transmit(huart, command_buffer, <span class="keyword">sizeof</span>(command_buffer), 100);</div>
<div class="line"><span class="lineno">  382</span>    <span class="keywordflow">if</span> (status != HAL_OK) {</div>
<div class="line"><span class="lineno">  383</span>        HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf7fc5de46146a2b743ff5ec05be23550">E220_M0_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#ga75fd9bd265fb1038ec7dac3fb0d56d21">E220_M0_Pin</a>, GPIO_PIN_RESET); <span class="comment">// Revert to Normal Mode</span></div>
<div class="line"><span class="lineno">  384</span>        HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf3cb0f47757e60d6887ddef28b414d0e">E220_M1_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaa9e756161b6c36fa79f6bdb124d3ad7d">E220_M1_Pin</a>, GPIO_PIN_RESET);</div>
<div class="line"><span class="lineno">  385</span>        <span class="keywordflow">return</span> status;</div>
<div class="line"><span class="lineno">  386</span>    }</div>
<div class="line"><span class="lineno">  387</span> </div>
<div class="line"><span class="lineno">  388</span>    <span class="comment">// --- Step 4: Wait for AUX High (Module processes and saves to EEPROM) ---</span></div>
<div class="line"><span class="lineno">  389</span>    status = <a class="code hl_function" href="group___e220___functions.html#ga5186d6d328aac24762acef26c46744a3">E220_WaitAuxHigh</a>(1000); <span class="comment">// Saving to EEPROM can take longer</span></div>
<div class="line"><span class="lineno">  390</span>    <span class="keywordflow">if</span> (status != HAL_OK) {</div>
<div class="line"><span class="lineno">  391</span>        HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf7fc5de46146a2b743ff5ec05be23550">E220_M0_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#ga75fd9bd265fb1038ec7dac3fb0d56d21">E220_M0_Pin</a>, GPIO_PIN_RESET); <span class="comment">// Revert to Normal Mode</span></div>
<div class="line"><span class="lineno">  392</span>        HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf3cb0f47757e60d6887ddef28b414d0e">E220_M1_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaa9e756161b6c36fa79f6bdb124d3ad7d">E220_M1_Pin</a>, GPIO_PIN_RESET);</div>
<div class="line"><span class="lineno">  393</span>        <span class="keywordflow">return</span> status;</div>
<div class="line"><span class="lineno">  394</span>    }</div>
<div class="line"><span class="lineno">  395</span><span class="preprocessor">#if defined(USE_FREERTOS) &amp;&amp; USE_FREERTOS == 1</span></div>
<div class="line"><span class="lineno">  396</span>    osDelay(2); <span class="comment">// Short delay after AUX high</span></div>
<div class="line"><span class="lineno">  397</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  398</span>    HAL_Delay(2);</div>
<div class="line"><span class="lineno">  399</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  400</span> </div>
<div class="line"><span class="lineno">  401</span>    <span class="comment">// --- Step 5: Receive Response ---</span></div>
<div class="line"><span class="lineno">  402</span>    status = HAL_UART_Receive(huart, response_buffer, <span class="keyword">sizeof</span>(response_buffer), 100);</div>
<div class="line"><span class="lineno">  403</span>    <span class="keywordflow">if</span> (status != HAL_OK) {</div>
<div class="line"><span class="lineno">  404</span>        HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf7fc5de46146a2b743ff5ec05be23550">E220_M0_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#ga75fd9bd265fb1038ec7dac3fb0d56d21">E220_M0_Pin</a>, GPIO_PIN_RESET); <span class="comment">// Revert to Normal Mode</span></div>
<div class="line"><span class="lineno">  405</span>        HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf3cb0f47757e60d6887ddef28b414d0e">E220_M1_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaa9e756161b6c36fa79f6bdb124d3ad7d">E220_M1_Pin</a>, GPIO_PIN_RESET);</div>
<div class="line"><span class="lineno">  406</span>        <span class="keywordflow">return</span> status;</div>
<div class="line"><span class="lineno">  407</span>    }</div>
<div class="line"><span class="lineno">  408</span> </div>
<div class="line"><span class="lineno">  409</span>    <span class="comment">// --- Step 6: Validate Response ---</span></div>
<div class="line"><span class="lineno">  410</span>    <span class="comment">// Expected: C1 &lt;same StartAddr&gt; &lt;same Length&gt; &lt;same Data...&gt;</span></div>
<div class="line"><span class="lineno">  411</span>    <span class="keywordflow">if</span> (response_buffer[0] != 0xC1 || memcmp(&amp;response_buffer[1], &amp;command_buffer[1], <span class="keyword">sizeof</span>(command_buffer) - 1) != 0) {</div>
<div class="line"><span class="lineno">  412</span>        HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf7fc5de46146a2b743ff5ec05be23550">E220_M0_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#ga75fd9bd265fb1038ec7dac3fb0d56d21">E220_M0_Pin</a>, GPIO_PIN_RESET); <span class="comment">// Revert to Normal Mode</span></div>
<div class="line"><span class="lineno">  413</span>        HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf3cb0f47757e60d6887ddef28b414d0e">E220_M1_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaa9e756161b6c36fa79f6bdb124d3ad7d">E220_M1_Pin</a>, GPIO_PIN_RESET);</div>
<div class="line"><span class="lineno">  414</span>        <span class="keywordflow">return</span> HAL_ERROR; <span class="comment">// Response mismatch</span></div>
<div class="line"><span class="lineno">  415</span>    }</div>
<div class="line"><span class="lineno">  416</span> </div>
<div class="line"><span class="lineno">  417</span>    <span class="comment">// --- Step 7: Exit Configuration Mode (Return to Normal Mode M0=0, M1=0) ---</span></div>
<div class="line"><span class="lineno">  418</span>    HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf7fc5de46146a2b743ff5ec05be23550">E220_M0_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#ga75fd9bd265fb1038ec7dac3fb0d56d21">E220_M0_Pin</a>, GPIO_PIN_RESET);</div>
<div class="line"><span class="lineno">  419</span>    HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf3cb0f47757e60d6887ddef28b414d0e">E220_M1_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaa9e756161b6c36fa79f6bdb124d3ad7d">E220_M1_Pin</a>, GPIO_PIN_RESET);</div>
<div class="line"><span class="lineno">  420</span><span class="preprocessor">#if defined(USE_FREERTOS) &amp;&amp; USE_FREERTOS == 1</span></div>
<div class="line"><span class="lineno">  421</span>    osDelay(10); <span class="comment">// Allow time for mode switch (e.g. 4ms + buffer)</span></div>
<div class="line"><span class="lineno">  422</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  423</span>    HAL_Delay(10);</div>
<div class="line"><span class="lineno">  424</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  425</span> </div>
<div class="line"><span class="lineno">  426</span>    status = <a class="code hl_function" href="group___e220___functions.html#ga5186d6d328aac24762acef26c46744a3">E220_WaitAuxHigh</a>(1000); <span class="comment">// Wait for AUX to confirm mode switch</span></div>
<div class="line"><span class="lineno">  427</span><span class="preprocessor">#if defined(USE_FREERTOS) &amp;&amp; USE_FREERTOS == 1</span></div>
<div class="line"><span class="lineno">  428</span>    osDelay(2); <span class="comment">// Short delay after AUX high</span></div>
<div class="line"><span class="lineno">  429</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  430</span>    HAL_Delay(2);</div>
<div class="line"><span class="lineno">  431</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  432</span>    <span class="comment">// If E220_WaitAuxHigh failed, status will be HAL_TIMEOUT.</span></div>
<div class="line"><span class="lineno">  433</span>    <span class="comment">// If it was OK, status is HAL_OK.</span></div>
<div class="line"><span class="lineno">  434</span>    <span class="keywordflow">return</span> status;</div>
<div class="line"><span class="lineno">  435</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="e220_8h_source.html#l00070">E220_ModuleConfig_Register_t::address</a>, <a class="el" href="e220_8h_source.html#l00076">E220_ModuleConfig_Register_t::air_data_rate_idx</a>, <a class="el" href="e220_8h_source.html#l00084">E220_ModuleConfig_Register_t::channel</a>, <a class="el" href="e220_8h_source.html#l00057">E220_CONFIG_REGS_LENGTH</a>, <a class="el" href="e220_8h_source.html#l00056">E220_CONFIG_REGS_START_ADDR</a>, <a class="el" href="e220_8h_source.html#l00033">E220_M0_GPIO_Port</a>, <a class="el" href="e220_8h_source.html#l00034">E220_M0_Pin</a>, <a class="el" href="e220_8h_source.html#l00035">E220_M1_GPIO_Port</a>, <a class="el" href="e220_8h_source.html#l00036">E220_M1_Pin</a>, <a class="el" href="e220_8c_source.html#l00020">E220_WaitAuxHigh()</a>, <a class="el" href="e220_8h_source.html#l00090">E220_ModuleConfig_Register_t::lbt_enable</a>, <a class="el" href="e220_8h_source.html#l00071">E220_ModuleConfig_Register_t::net_id</a>, <a class="el" href="e220_8h_source.html#l00089">E220_ModuleConfig_Register_t::repeater_enable</a>, <a class="el" href="e220_8h_source.html#l00080">E220_ModuleConfig_Register_t::rssi_ambient_noise_enable</a>, <a class="el" href="e220_8h_source.html#l00087">E220_ModuleConfig_Register_t::rssi_byte_enable</a>, <a class="el" href="e220_8h_source.html#l00079">E220_ModuleConfig_Register_t::subpacket_size_idx</a>, <a class="el" href="e220_8h_source.html#l00088">E220_ModuleConfig_Register_t::transmission_method</a>, <a class="el" href="e220_8h_source.html#l00081">E220_ModuleConfig_Register_t::transmitting_power_idx</a>, <a class="el" href="e220_8h_source.html#l00074">E220_ModuleConfig_Register_t::uart_baud_rate_idx</a>, <a class="el" href="e220_8h_source.html#l00075">E220_ModuleConfig_Register_t::uart_parity_idx</a>, <a class="el" href="e220_8h_source.html#l00092">E220_ModuleConfig_Register_t::wor_cycle_idx</a>, and <a class="el" href="e220_8h_source.html#l00091">E220_ModuleConfig_Register_t::wor_transmitter_control</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group___e220___functions_gade15c0ad644c38f7c962a45d21bf52f9_cgraph.png" border="0" usemap="#agroup___e220___functions_gade15c0ad644c38f7c962a45d21bf52f9_cgraph" alt=""/></div>
<map name="agroup___e220___functions_gade15c0ad644c38f7c962a45d21bf52f9_cgraph" id="agroup___e220___functions_gade15c0ad644c38f7c962a45d21bf52f9_cgraph">
<area shape="rect" title="Sets the E220 configuration using direct register writes." alt="" coords="5,5,161,48"/>
<area shape="rect" href="group___e220___functions.html#ga5186d6d328aac24762acef26c46744a3" title="Waits for the E220&#39;s AUX pin to go to a HIGH state." alt="" coords="209,13,343,40"/>
<area shape="poly" title=" " alt="" coords="161,24,193,24,193,29,161,29"/>
</map>
</div>

</div>
</div>
<a id="ga5186d6d328aac24762acef26c46744a3" name="ga5186d6d328aac24762acef26c46744a3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga5186d6d328aac24762acef26c46744a3">&#9670;&#160;</a></span>E220_WaitAuxHigh()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HAL_StatusTypeDef E220_WaitAuxHigh </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>timeout</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Waits for the E220's AUX pin to go to a HIGH state. </p>
<p>The AUX pin signals when the module is ready (e.g., finished processing a command or booting). This function polls the pin with an RTOS-aware delay. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">timeout</td><td>Maximum time to wait in milliseconds. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">HAL_OK</td><td>AUX pin went HIGH within the timeout. </td></tr>
    <tr><td class="paramname">HAL_ERROR</td><td>Timed out waiting for AUX pin. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="e220_8c_source.html#l00020">20</a> of file <a class="el" href="e220_8c_source.html">e220.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   20</span>                                                    {</div>
<div class="line"><span class="lineno">   21</span>    uint32_t start_time = HAL_GetTick();</div>
<div class="line"><span class="lineno">   22</span>    <span class="keywordflow">while</span>(HAL_GPIO_ReadPin( <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#ga3ccf7e62c9aaa0d395afa89698ed3f3e">E220_AUX_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gacabcedcefba600a75d3bda90a597f8fa">E220_AUX_Pin</a>) == GPIO_PIN_RESET){</div>
<div class="line"><span class="lineno">   23</span>        <span class="keywordflow">if</span>(HAL_GetTick() - start_time &gt; timeout){</div>
<div class="line"><span class="lineno">   24</span>            <span class="keywordflow">return</span> HAL_ERROR;</div>
<div class="line"><span class="lineno">   25</span>        }</div>
<div class="line"><span class="lineno">   26</span>        osDelay(1);</div>
<div class="line"><span class="lineno">   27</span>    }</div>
<div class="line"><span class="lineno">   28</span>    <span class="keywordflow">return</span> HAL_OK;</div>
<div class="line"><span class="lineno">   29</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="e220_8h_source.html#l00037">E220_AUX_GPIO_Port</a>, and <a class="el" href="e220_8h_source.html#l00038">E220_AUX_Pin</a>.</p>

<p class="reference">Referenced by <a class="el" href="e220_8c_source.html#l00438">E220_ReadConfiguration_RegisterMode()</a>, <a class="el" href="e220_8c_source.html#l00309">E220_SetConfiguration_RegisterMode()</a>, <a class="el" href="e220_8c_source.html#l00031">SetConfiguration()</a>, and <a class="el" href="main_8c_source.html#l01657">StartLoRaTransmitTask()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group___e220___functions_ga5186d6d328aac24762acef26c46744a3_icgraph.png" border="0" usemap="#agroup___e220___functions_ga5186d6d328aac24762acef26c46744a3_icgraph" alt=""/></div>
<map name="agroup___e220___functions_ga5186d6d328aac24762acef26c46744a3_icgraph" id="agroup___e220___functions_ga5186d6d328aac24762acef26c46744a3_icgraph">
<area shape="rect" title="Waits for the E220&#39;s AUX pin to go to a HIGH state." alt="" coords="909,109,1043,136"/>
<area shape="rect" href="group___e220___functions.html#ga48dabee77440c9bce39d6f67542b476e" title="Reads the E220 module configuration using direct register reads." alt="" coords="695,5,861,48"/>
<area shape="poly" title=" " alt="" coords="938,104,860,62,834,51,837,46,862,58,940,99"/>
<area shape="rect" href="group___e220___functions.html#gade15c0ad644c38f7c962a45d21bf52f9" title="Sets the E220 configuration using direct register writes." alt="" coords="700,72,856,115"/>
<area shape="poly" title=" " alt="" coords="893,113,856,108,857,102,894,108"/>
<area shape="rect" href="group___e220___functions.html#ga97cfb0193d1ed6cd807cfb3750a3706b" title="Sets the module&#39;s channel and persistence using a direct register command." alt="" coords="719,139,837,165"/>
<area shape="poly" title=" " alt="" coords="894,137,838,146,837,141,893,132"/>
<area shape="rect" href="group___core.html#ga695c3eac45169a6f5615a358d57f67da" title="RTOS Task: LoRa Transmit Task." alt="" coords="487,189,647,216"/>
<area shape="poly" title=" " alt="" coords="940,146,903,165,862,180,807,192,750,200,647,206,647,201,750,195,806,187,860,175,901,160,938,142"/>
<area shape="rect" href="group___telemetry.html#ga29a04c6a560438bbd2874f3cf0fb5d64" title="Sets the LoRa module&#39;s RF channel using a register write." alt="" coords="503,139,631,165"/>
<area shape="poly" title=" " alt="" coords="703,155,631,155,631,149,703,149"/>
<area shape="rect" href="group___telemetry.html#ga2ce37527b36ed84f1501d5868e93e126" title="Processes incoming commands from the Ground Station." alt="" coords="319,139,439,165"/>
<area shape="poly" title=" " alt="" coords="488,155,440,155,440,149,488,149"/>
<area shape="rect" href="group___core.html#ga00a499fcbb90d3ab74786272380a3472" title="RTOS Task: LoRa Command Task." alt="" coords="103,139,271,165"/>
<area shape="poly" title=" " alt="" coords="303,155,271,155,271,149,303,149"/>
<area shape="rect" href="group___core.html#ga840291bc02cba5474a4cb46a9b9566fe" title="The application entry point." alt="" coords="5,164,55,191"/>
<area shape="poly" title=" " alt="" coords="88,171,55,176,55,171,87,166"/>
<area shape="poly" title=" " alt="" coords="472,201,55,181,55,176,472,196"/>
</map>
</div>

</div>
</div>
<a id="gaacc524f6ca0831f6e5e603b79254430c" name="gaacc524f6ca0831f6e5e603b79254430c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaacc524f6ca0831f6e5e603b79254430c">&#9670;&#160;</a></span>E220_WaitForResponse()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool E220_WaitForResponse </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>timeout_ms</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Waits for a response from the E220 module after sending an AT command. </p>
<p>This is a placeholder function. A real implementation would involve UART RX (DMA or IT) and response parsing (e.g., 'OK', 'ERR'). </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">timeout_ms</td><td>Timeout in milliseconds to wait for a response. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">true</td><td>Placeholder, indicates 'OK' was (theoretically) received. </td></tr>
    <tr><td class="paramname">false</td><td>Placeholder, indicates timeout or 'ERR'. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="e220_8c_source.html#l00099">99</a> of file <a class="el" href="e220_8c_source.html">e220.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  100</span>{</div>
<div class="line"><span class="lineno">  101</span>    <span class="comment">// --- PLACEHOLDER IMPLEMENTATION ---</span></div>
<div class="line"><span class="lineno">  102</span>    <span class="comment">// In a real system, you would:</span></div>
<div class="line"><span class="lineno">  103</span>    <span class="comment">// 1. Ensure UART RX is enabled (e.g., HAL_UART_Receive_DMA or IT).</span></div>
<div class="line"><span class="lineno">  104</span>    <span class="comment">// 2. Have a buffer to store incoming UART data.</span></div>
<div class="line"><span class="lineno">  105</span>    <span class="comment">// 3. In your UART RX callback, append received bytes to the buffer.</span></div>
<div class="line"><span class="lineno">  106</span>    <span class="comment">// 4. In this function, wait (with a timeout) for the buffer to contain</span></div>
<div class="line"><span class="lineno">  107</span>    <span class="comment">//    the expected response string (&quot;Command = OK&quot;, &quot;=ERR&quot;, etc.).</span></div>
<div class="line"><span class="lineno">  108</span>    <span class="comment">// 5. Parse the buffer content.</span></div>
<div class="line"><span class="lineno">  109</span> </div>
<div class="line"><span class="lineno">  110</span>    <span class="comment">// For now, we&#39;ll just use a delay as a simplified placeholder.</span></div>
<div class="line"><span class="lineno">  111</span>    <span class="comment">// This is NOT reliable for production code.</span></div>
<div class="line"><span class="lineno">  112</span>    HAL_Delay(timeout_ms);</div>
<div class="line"><span class="lineno">  113</span> </div>
<div class="line"><span class="lineno">  114</span>    <span class="comment">// Assume success for the placeholder</span></div>
<div class="line"><span class="lineno">  115</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// Assume OK response received after delay</span></div>
<div class="line"><span class="lineno">  116</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="e220_8c_source.html#l00150">E220_Init_AT()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group___e220___functions_gaacc524f6ca0831f6e5e603b79254430c_icgraph.png" border="0" usemap="#agroup___e220___functions_gaacc524f6ca0831f6e5e603b79254430c_icgraph" alt=""/></div>
<map name="agroup___e220___functions_gaacc524f6ca0831f6e5e603b79254430c_icgraph" id="agroup___e220___functions_gaacc524f6ca0831f6e5e603b79254430c_icgraph">
<area shape="rect" title="Waits for a response from the E220 module after sending an AT command." alt="" coords="153,5,315,32"/>
<area shape="rect" href="group___e220___functions.html#ga86dc5a312335e4578acbace6165ae9bb" title="Initializes the E220 LoRa module using AT commands." alt="" coords="5,5,105,32"/>
<area shape="poly" title=" " alt="" coords="137,21,105,21,105,16,137,16"/>
</map>
</div>

</div>
</div>
<a id="ga97cfb0193d1ed6cd807cfb3750a3706b" name="ga97cfb0193d1ed6cd807cfb3750a3706b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga97cfb0193d1ed6cd807cfb3750a3706b">&#9670;&#160;</a></span>SetConfiguration()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HAL_StatusTypeDef SetConfiguration </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>channel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>persistence</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets the module's channel and persistence using a direct register command. </p>
<p>This function sends a specific command to write to the channel register. It handles entering/exiting config mode. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">channel</td><td>The RF channel to set (e.g., 0-83). </td></tr>
    <tr><td class="paramname">persistence</td><td>The command byte (e.g., 0xC0 to save, 0xC2 for temporary). </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">HAL_OK</td><td>Command sent successfully. </td></tr>
    <tr><td class="paramname">HAL_ERROR</td><td>Failed to send command or wait for AUX. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="e220_8c_source.html#l00031">31</a> of file <a class="el" href="e220_8c_source.html">e220.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   31</span>                                                                       {</div>
<div class="line"><span class="lineno">   32</span>    HAL_StatusTypeDef status = HAL_OK;</div>
<div class="line"><span class="lineno">   33</span>    uint8_t command_buffer[] = {persistence, 0x04, 0x01, channel};</div>
<div class="line"><span class="lineno">   34</span> </div>
<div class="line"><span class="lineno">   35</span>    HAL_GPIO_WritePin(<a class="code hl_define" href="group___pin___definitions.html#ga8753e713db3ed1f199ca366ffbd44dfc">GPIO_LoRa_M0_GPIO_Port</a>, <a class="code hl_define" href="group___pin___definitions.html#ga4bbd73446ec69230979adbd0db23d8c9">GPIO_LoRa_M0_Pin</a>, GPIO_PIN_SET);</div>
<div class="line"><span class="lineno">   36</span>    HAL_GPIO_WritePin(<a class="code hl_define" href="group___pin___definitions.html#ga8f2ea8684ac42c1eff82fa766bba5e6c">GPIO_LoRa_M1_GPIO_Port</a>, <a class="code hl_define" href="group___pin___definitions.html#ga1538c4df65cf28808a08539465b8f790">GPIO_LoRa_M1_Pin</a>, GPIO_PIN_SET);</div>
<div class="line"><span class="lineno">   37</span>    osDelay(10);</div>
<div class="line"><span class="lineno">   38</span><span class="comment">//  HAL_Delay(10);</span></div>
<div class="line"><span class="lineno">   39</span> </div>
<div class="line"><span class="lineno">   40</span>    status = <a class="code hl_function" href="group___e220___functions.html#ga5186d6d328aac24762acef26c46744a3">E220_WaitAuxHigh</a>(1000);</div>
<div class="line"><span class="lineno">   41</span>    <span class="keywordflow">if</span> (status != HAL_OK) {</div>
<div class="line"><span class="lineno">   42</span>       HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf7fc5de46146a2b743ff5ec05be23550">E220_M0_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#ga75fd9bd265fb1038ec7dac3fb0d56d21">E220_M0_Pin</a>, GPIO_PIN_RESET);</div>
<div class="line"><span class="lineno">   43</span>       HAL_GPIO_WritePin(<a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaf3cb0f47757e60d6887ddef28b414d0e">E220_M1_GPIO_Port</a>, <a class="code hl_define" href="group___e220___g_p_i_o___definitions.html#gaa9e756161b6c36fa79f6bdb124d3ad7d">E220_M1_Pin</a>, GPIO_PIN_RESET);</div>
<div class="line"><span class="lineno">   44</span>       <span class="keywordflow">return</span> status;</div>
<div class="line"><span class="lineno">   45</span>    }</div>
<div class="line"><span class="lineno">   46</span>    osDelay(5);</div>
<div class="line"><span class="lineno">   47</span><span class="comment">//  HAL_Delay(10);</span></div>
<div class="line"><span class="lineno">   48</span>    HAL_StatusTypeDef sts = HAL_UART_Transmit(&amp;<a class="code hl_variable" href="group___core.html#gae273feb3e0dc44e38892650faa58fced">huart4</a>, (uint8_t*)command_buffer, <span class="keyword">sizeof</span>(command_buffer),200);</div>
<div class="line"><span class="lineno">   49</span>    <span class="keywordflow">if</span> (sts != HAL_OK){</div>
<div class="line"><span class="lineno">   50</span>        HAL_GPIO_WritePin(<a class="code hl_define" href="group___pin___definitions.html#ga8753e713db3ed1f199ca366ffbd44dfc">GPIO_LoRa_M0_GPIO_Port</a>, <a class="code hl_define" href="group___pin___definitions.html#ga4bbd73446ec69230979adbd0db23d8c9">GPIO_LoRa_M0_Pin</a>, GPIO_PIN_RESET);</div>
<div class="line"><span class="lineno">   51</span>        HAL_GPIO_WritePin(<a class="code hl_define" href="group___pin___definitions.html#ga8f2ea8684ac42c1eff82fa766bba5e6c">GPIO_LoRa_M1_GPIO_Port</a>, <a class="code hl_define" href="group___pin___definitions.html#ga1538c4df65cf28808a08539465b8f790">GPIO_LoRa_M1_Pin</a>, GPIO_PIN_RESET);</div>
<div class="line"><span class="lineno">   52</span>        osDelay(10);</div>
<div class="line"><span class="lineno">   53</span><span class="comment">//      HAL_Delay(10);</span></div>
<div class="line"><span class="lineno">   54</span>        <span class="keywordflow">return</span> HAL_ERROR;</div>
<div class="line"><span class="lineno">   55</span>    }</div>
<div class="line"><span class="lineno">   56</span><span class="comment">//  HAL_StatusTypeDef sts_2 = HAL_UART_Receive(&amp;huart4, (uint8_t*) response, sizeof(response),100);</span></div>
<div class="line"><span class="lineno">   57</span><span class="comment">//  if (sts_2 != HAL_OK){</span></div>
<div class="line"><span class="lineno">   58</span><span class="comment">//         HAL_GPIO_WritePin(GPIO_LoRa_M0_GPIO_Port, GPIO_LoRa_M0_Pin, GPIO_PIN_RESET);</span></div>
<div class="line"><span class="lineno">   59</span><span class="comment">//         HAL_GPIO_WritePin(GPIO_LoRa_M1_GPIO_Port, GPIO_LoRa_M1_Pin, GPIO_PIN_RESET);</span></div>
<div class="line"><span class="lineno">   60</span><span class="comment">//         osDelay(10);</span></div>
<div class="line"><span class="lineno">   61</span><span class="comment">//         return HAL_ERROR;</span></div>
<div class="line"><span class="lineno">   62</span><span class="comment">//  }</span></div>
<div class="line"><span class="lineno">   63</span>   HAL_GPIO_WritePin(<a class="code hl_define" href="group___pin___definitions.html#ga8753e713db3ed1f199ca366ffbd44dfc">GPIO_LoRa_M0_GPIO_Port</a>, <a class="code hl_define" href="group___pin___definitions.html#ga4bbd73446ec69230979adbd0db23d8c9">GPIO_LoRa_M0_Pin</a>, GPIO_PIN_RESET);</div>
<div class="line"><span class="lineno">   64</span>   HAL_GPIO_WritePin(<a class="code hl_define" href="group___pin___definitions.html#ga8f2ea8684ac42c1eff82fa766bba5e6c">GPIO_LoRa_M1_GPIO_Port</a>, <a class="code hl_define" href="group___pin___definitions.html#ga1538c4df65cf28808a08539465b8f790">GPIO_LoRa_M1_Pin</a>, GPIO_PIN_RESET);</div>
<div class="line"><span class="lineno">   65</span>   osDelay(50);</div>
<div class="line"><span class="lineno">   66</span><span class="comment">//   HAL_Delay(50);</span></div>
<div class="line"><span class="lineno">   67</span> </div>
<div class="line"><span class="lineno">   68</span> </div>
<div class="line"><span class="lineno">   69</span>    <span class="keywordflow">return</span> status;</div>
<div class="line"><span class="lineno">   70</span> </div>
<div class="line"><span class="lineno">   71</span>}</div>
<div class="ttc" id="agroup___core_html_gae273feb3e0dc44e38892650faa58fced"><div class="ttname"><a href="group___core.html#gae273feb3e0dc44e38892650faa58fced">huart4</a></div><div class="ttdeci">UART_HandleTypeDef huart4</div><div class="ttdoc">HAL UART handle for UART4 (External XBEE).</div><div class="ttdef"><b>Definition</b> <a href="main_8c_source.html#l00128">main.c:128</a></div></div>
<div class="ttc" id="agroup___pin___definitions_html_ga1538c4df65cf28808a08539465b8f790"><div class="ttname"><a href="group___pin___definitions.html#ga1538c4df65cf28808a08539465b8f790">GPIO_LoRa_M1_Pin</a></div><div class="ttdeci">#define GPIO_LoRa_M1_Pin</div><div class="ttdoc">Pin for LoRa Mode Select 1.</div><div class="ttdef"><b>Definition</b> <a href="main_8h_source.html#l00171">main.h:171</a></div></div>
<div class="ttc" id="agroup___pin___definitions_html_ga4bbd73446ec69230979adbd0db23d8c9"><div class="ttname"><a href="group___pin___definitions.html#ga4bbd73446ec69230979adbd0db23d8c9">GPIO_LoRa_M0_Pin</a></div><div class="ttdeci">#define GPIO_LoRa_M0_Pin</div><div class="ttdoc">Pin for LoRa Mode Select 0.</div><div class="ttdef"><b>Definition</b> <a href="main_8h_source.html#l00167">main.h:167</a></div></div>
<div class="ttc" id="agroup___pin___definitions_html_ga8753e713db3ed1f199ca366ffbd44dfc"><div class="ttname"><a href="group___pin___definitions.html#ga8753e713db3ed1f199ca366ffbd44dfc">GPIO_LoRa_M0_GPIO_Port</a></div><div class="ttdeci">#define GPIO_LoRa_M0_GPIO_Port</div><div class="ttdef"><b>Definition</b> <a href="main_8h_source.html#l00168">main.h:168</a></div></div>
<div class="ttc" id="agroup___pin___definitions_html_ga8f2ea8684ac42c1eff82fa766bba5e6c"><div class="ttname"><a href="group___pin___definitions.html#ga8f2ea8684ac42c1eff82fa766bba5e6c">GPIO_LoRa_M1_GPIO_Port</a></div><div class="ttdeci">#define GPIO_LoRa_M1_GPIO_Port</div><div class="ttdef"><b>Definition</b> <a href="main_8h_source.html#l00172">main.h:172</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="e220_8h_source.html#l00033">E220_M0_GPIO_Port</a>, <a class="el" href="e220_8h_source.html#l00034">E220_M0_Pin</a>, <a class="el" href="e220_8h_source.html#l00035">E220_M1_GPIO_Port</a>, <a class="el" href="e220_8h_source.html#l00036">E220_M1_Pin</a>, <a class="el" href="e220_8c_source.html#l00020">E220_WaitAuxHigh()</a>, <a class="el" href="main_8h_source.html#l00168">GPIO_LoRa_M0_GPIO_Port</a>, <a class="el" href="main_8h_source.html#l00167">GPIO_LoRa_M0_Pin</a>, <a class="el" href="main_8h_source.html#l00172">GPIO_LoRa_M1_GPIO_Port</a>, <a class="el" href="main_8h_source.html#l00171">GPIO_LoRa_M1_Pin</a>, and <a class="el" href="main_8c_source.html#l00128">huart4</a>.</p>

<p class="reference">Referenced by <a class="el" href="main_8c_source.html#l00453">LoRa_SetChannel()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group___e220___functions_ga97cfb0193d1ed6cd807cfb3750a3706b_cgraph.png" border="0" usemap="#agroup___e220___functions_ga97cfb0193d1ed6cd807cfb3750a3706b_cgraph" alt=""/></div>
<map name="agroup___e220___functions_ga97cfb0193d1ed6cd807cfb3750a3706b_cgraph" id="agroup___e220___functions_ga97cfb0193d1ed6cd807cfb3750a3706b_cgraph">
<area shape="rect" title="Sets the module&#39;s channel and persistence using a direct register command." alt="" coords="5,5,124,32"/>
<area shape="rect" href="group___e220___functions.html#ga5186d6d328aac24762acef26c46744a3" title="Waits for the E220&#39;s AUX pin to go to a HIGH state." alt="" coords="172,5,306,32"/>
<area shape="poly" title=" " alt="" coords="124,16,156,16,156,21,124,21"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group___e220___functions_ga97cfb0193d1ed6cd807cfb3750a3706b_icgraph.png" border="0" usemap="#agroup___e220___functions_ga97cfb0193d1ed6cd807cfb3750a3706b_icgraph" alt=""/></div>
<map name="agroup___e220___functions_ga97cfb0193d1ed6cd807cfb3750a3706b_icgraph" id="agroup___e220___functions_ga97cfb0193d1ed6cd807cfb3750a3706b_icgraph">
<area shape="rect" title="Sets the module&#39;s channel and persistence using a direct register command." alt="" coords="663,5,781,32"/>
<area shape="rect" href="group___telemetry.html#ga29a04c6a560438bbd2874f3cf0fb5d64" title="Sets the LoRa module&#39;s RF channel using a register write." alt="" coords="487,5,615,32"/>
<area shape="poly" title=" " alt="" coords="647,21,615,21,615,16,647,16"/>
<area shape="rect" href="group___telemetry.html#ga2ce37527b36ed84f1501d5868e93e126" title="Processes incoming commands from the Ground Station." alt="" coords="319,5,439,32"/>
<area shape="poly" title=" " alt="" coords="472,21,440,21,440,16,472,16"/>
<area shape="rect" href="group___core.html#ga00a499fcbb90d3ab74786272380a3472" title="RTOS Task: LoRa Command Task." alt="" coords="103,5,271,32"/>
<area shape="poly" title=" " alt="" coords="303,21,271,21,271,16,303,16"/>
<area shape="rect" href="group___core.html#ga840291bc02cba5474a4cb46a9b9566fe" title="The application entry point." alt="" coords="5,5,55,32"/>
<area shape="poly" title=" " alt="" coords="87,21,55,21,55,16,87,16"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
